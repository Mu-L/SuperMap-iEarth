import{a as M}from"./chunk-77JEGE4I.js";import{a as E}from"./chunk-AMRCVYIA.js";import{a as B}from"./chunk-NLYLRNUA.js";import"./chunk-7TOCOFC3.js";import{a as k}from"./chunk-ZVKIUA3Y.js";import"./chunk-3HZNWEV7.js";import{a as O}from"./chunk-LBR6REQR.js";import"./chunk-GXFCHGTA.js";import"./chunk-UBHQMGET.js";import"./chunk-EDZQSM3T.js";import"./chunk-PJGSCWXZ.js";import"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var I={UNLOAD:0,LOADING:1,LOADED:2,VOLLOADED:3,PARSING:4,PARSED:5,TRANSFORMING:6,TRANSFORMED:7,LOST:8,LOADVOL:9,FAILED:10,VOLFAILED:11},R=Object.freeze(I);function N(a){for(var h=1;h<a;)h<<=1;return h}function G(a){var h=new O(1,255,65025);h=O.multiplyByScalar(h,a,h),h.x=h.x-Math.floor(h.x),h.y=h.y-Math.floor(h.y),h.z=h.z-Math.floor(h.z);var o=new O,r=new O(1/255,1/255,0);return o.x=h.y*r.x,o.y=h.z*r.y,o.z=h.z*r.z,h=O.subtract(h,o,h),h}function j(a,h,o,r){for(var s=4,y=a._nLength*a._nLength*s,d=new Array(y),w=o-h,S=h,l=-9999,_=0;_<a.cellDepth;_++)for(var f=parseInt(_/a._nSideBlockCount)*a._nBlockLength,i=_%a._nSideBlockCount*a._nBlockLength,g=-1;g<a._nBlockLength-1;g++)for(var t=-1;t<a._nBlockLength-1;t++){var n=Math.min(t,a.validWidth-1),D=Math.min(g,a.validHeight-1);n=Math.max(0,n),D=Math.max(0,D);var W=0;a.ySpan>0&&(W=a.validHeight-a.cellHeight);var c,A;if(n<a.cellWidth&&D>=W?(A=0,c=_*a.cellHeight*a.cellWidth+(a.validHeight-1-D)*a.cellWidth+n):n<a.cellWidth?(a.xSpan==0?A=1:A=2,c=_*a.cellHeight*a.cellWidth+(a.validHeight-a.cellHeight-1-D)*a.cellWidth+n):D>=W?(A=1,c=_*a.cellHeight*a.cellWidth+(a.validHeight-1-D)*a.cellWidth+n-a.cellWidth):(A=3,c=_*a.cellHeight*a.cellWidth+(a.validHeight-a.cellHeight-1-D)*a.cellWidth+n-a.cellWidth),!(c<0)){var H=r[A][c],p=new k(0,0,0,0);if(H!=l){H<h||H>o?H=S:S=H,H=(H-h)/w;var z=G(H);p.x=z.x,p.y=z.y,p.z=z.z,p.w=1}var m=p.x*255,b=p.y*255,F=p.z*255,C=p.w*255;c=(f+g)*a._nLength+i+t,d[4*c]=parseInt(m),d[4*c+1]=parseInt(b),d[4*c+2]=parseInt(F),d[4*c+3]=parseInt(C)}}return new Uint8Array(d,0,y)}function v(a,h,o,r,s,y,d){for(var w=a.length,S=[],l=0;l<w;l++)S.push(a[l]._arrayBuffer.slice(36,a[l]._arrayBuffer.byteLength));var _=4*h.cellWidth*h.cellHeight*h.cellDepth,f=a[0],i=a[w-1],g=h.cellWidth,t=h.cellHeight;d.EndCol-1==i._x&&(g=d.Width-i._x*g),d.EndRow-1==i._y&&(t=d.Height-i._y*t),h.startCol=f._x,h.startRow=f._y,h.endCol=i._x,h.endRow=i._y,h.ySpan=i._y-f._y,h.xSpan=i._x-f._x,h.ySpan>0&&(t=t+h.cellHeight),h.xSpan>0&&(g=g+h.cellWidth),h._nSideBlockCount=Math.ceil(Math.sqrt(h.cellDepth)),h._nBlockLength=Math.max(t,g)+2,h._nLength=N(h._nBlockLength*h._nSideBlockCount-2),h.validWidth=g,h.validHeight=t,h.bounds=new B(f._dataBounds.west,i._dataBounds.south,i._dataBounds.east,f._dataBounds.north);var n=new B(r.west,r.south,r.east,r.north);h.multiResolutionTranslation=new k((f._dataBounds.west-n.west)/n.width,(i._dataBounds.south-n.south)/n.height,n.width/h.bounds.width,n.height/h.bounds.height);for(var D=[],W=0;W<o;W++){for(var c=[],l=0;l<S.length;l++){var A=new Float32Array(S[l].slice(W*_,(W+1)*_));c.push(A)}D.push(j(h,s,y,c))}return D}function U(a,h){for(var o=a.arrayWork,r=[],s=0;s<o.length;s++)if(o[s]._s3mLoadState===R.LOADED){var y=o[s]._arrayBuffer.slice(16,o[s]._arrayBuffer.byteLength),d=M.inflate(y).buffer;o[s]._arrayBuffer=d,o[s]._s3mLoadState=R.TRANSFORMED,r.push({index:s,buffer:d})}var w=a.textureLevel,S=a._availableNode,l=a._time,_=a._layerBounds,f=a._minFiltration,i=a._maxFiltration;w.cellWidth=a._cellWidth,w.cellHeight=a._cellHeight,w.cellDepth=a._cellDepth;var g=v(o,w,l,_,f,i,S);return{textureLevel:w,imageDatas:g,unzipTile:r}}var V=E(U);export{V as default};
