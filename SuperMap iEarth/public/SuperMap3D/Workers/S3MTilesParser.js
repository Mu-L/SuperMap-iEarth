import{a as dt}from"./chunk-H6N4J6TN.js";import{a as Oe}from"./chunk-PKPCOH7K.js";import{a as ft}from"./chunk-77JEGE4I.js";import{a as vt}from"./chunk-X2INLI3M.js";import{a as ht}from"./chunk-AMRCVYIA.js";import{a as Se}from"./chunk-44AFRGCG.js";import{a as pt}from"./chunk-F5UB2CPM.js";import{a as I}from"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import"./chunk-KJYJTW2V.js";import"./chunk-6NA2GRXE.js";import{a as x}from"./chunk-EHDXVZQM.js";import"./chunk-ZVKIUA3Y.js";import{b as Xe}from"./chunk-3HZNWEV7.js";import{a as p}from"./chunk-LBR6REQR.js";import"./chunk-GXFCHGTA.js";import{a as V}from"./chunk-UBHQMGET.js";import{a as K}from"./chunk-EDZQSM3T.js";import{a as D}from"./chunk-PJGSCWXZ.js";import{a as S}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";//! Use DXT1 compression.
var et=1<<0;//! Use DXT3 compression.
var It=1<<1;//! Use DXT5 compression.
var Tt=1<<2;//! Use a very slow but very high quality colour compressor.
var Nr=1<<8;//! Use a slow but high quality colour compressor (the default).
var Lr=1<<3;//! Use a fast but low quality colour compressor.
var Sr=1<<4;//! Weight the colour by alpha during cluster fit (disabled by default).
var Ur=1<<7,Nt=1<<5;function Lt(e,r,a,n){var o=e|r<<8,E=o>>11&31,t=o>>5&63,s=o&31;return a[n+0]=E<<3|E>>2,a[n+1]=t<<2|t>>4,a[n+2]=s<<3|s>>2,a[n+3]=255,o}function Wt(e,r,a,n){for(var o=new Uint8Array(16),E=Lt(r[a+0],r[a+1],o,0),t=Lt(r[a+2],r[a+3],o,4),s=0;s<3;s++){var A=o[s],u=o[4+s];n&&E<=t?(o[8+s]=(A+u)/2,o[12+s]=0):(o[8+s]=(2*A+u)/3,o[12+s]=(A+2*u)/3)}o[8+3]=255,o[12+3]=n&&E<=t?0:255;for(var f=new Uint8Array(16),s=0;s<4;++s){var _=r[a+4+s];f[4*s+0]=_&3,f[4*s+1]=_>>2&3,f[4*s+2]=_>>4&3,f[4*s+3]=_>>6&3}for(var s=0;s<16;++s)for(var T=4*f[s],y=0;y<4;++y)e[4*s+y]=o[T+y]}function Kt(e,r,a){for(var n=0;n<8;++n){var o=bytes[a+n],E=o&15,t=o&240;e[8*n+3]=E|E<<4,e[8*n+7]=t|t>>4}}function Qt(e,r,A){var n=r[A+0],o=r[A+1],E=new Uint8Array(8);if(E[0]=n,E[1]=o,n<=o){for(var t=1;t<5;++t)E[1+t]=((5-t)*n+t*o)/5;E[6]=0,E[7]=255}else for(var t=1;t<7;++t)E[1+t]=((7-t)*n+t*o)/7;for(var s=new Uint8Array(16),A=A+2,u=0,t=0;t<2;++t){for(var f=0,_=0;_<3;++_){var T=r[A++];f|=T<<8*_}for(var _=0;_<8;++_){var y=f>>3*_&7;s[u++]=y}}for(var t=0;t<16;++t)e[4*t+3]=E[s[t]]}function qt(e,r,a,n){var o=0;(n&(It|Tt))!=0&&(o=8),Wt(e,r,a+o,(n&et)!=0),(n&It)!=0?Kt(e,r,a):(n&Tt)!=0&&Qt(e,r,a)}function Zt(e,r,a,n){for(var o=new Uint16Array(4),E=e,t=0,s=0,A=0,u=0,f=0,_=0,T=0,y=0,l=0,h=r/4,d=a/4,N=0;N<d;N++)for(var v=0;v<h;v++)A=4*((d-N)*h+v),o[0]=n[A],o[1]=n[A+1],u=o[0]&31,f=o[0]&2016,_=o[0]&63488,T=o[1]&31,y=o[1]&2016,l=o[1]&63488,o[2]=5*u+3*T>>3|5*f+3*y>>3&2016|5*_+3*l>>3&63488,o[3]=5*T+3*u>>3|5*y+3*f>>3&2016|5*l+3*_>>3&63488,t=n[A+2],s=N*4*r+v*4,E[s]=o[t&3],E[s+1]=o[t>>2&3],E[s+2]=o[t>>4&3],E[s+3]=o[t>>6&3],s+=r,E[s]=o[t>>8&3],E[s+1]=o[t>>10&3],E[s+2]=o[t>>12&3],E[s+3]=o[t>>14],t=n[A+3],s+=r,E[s]=o[t&3],E[s+1]=o[t>>2&3],E[s+2]=o[t>>4&3],E[s+3]=o[t>>6&3],s+=r,E[s]=o[t>>8&3],E[s+1]=o[t>>10&3],E[s+2]=o[t>>12&3],E[s+3]=o[t>>14];return E}/*! @brief Decompresses an image in memory.

 @param rgba		Storage for the decompressed pixels.
 @param width	The width of the source image.
 @param height	The height of the source image.
 @param blocks	The compressed DXT blocks.
 @param flags	Compression flags.

 The decompressed pixels will be written as a contiguous array of width*height
 16 rgba values, with each component as 1 byte each. In memory this is:

 { r1, g1, b1, a1, .... , rn, gn, bn, an } for n = width*height

 The flags parameter should specify either kDxt1, kDxt3 or kDxt5 compression,
 however, DXT1 will be used by default if none is specified. All other flags
 are ignored.

 Internally this function calls squish::Decompress for each block.
 */function Jt(e,r,a,n,o){for(var E=(o&et)!=0?8:16,t=0,s=0;s<a;s+=4)for(var A=0;A<r;A+=4){var u=new Uint8Array(64);qt(u,n,t,o);for(var f=0,_=0;_<4;++_)for(var T=0;T<4;++T){var y=A+T,l=s+_;if(y<r&&l<a)for(var h=4*(r*(a-l)+y),d=0;d<4;++d)e[h++]=u[f++];else f+=4}t+=E}}function St(e){}St.decode=function(e,r,a,n,o){if(!(e==null||n==null||a==0||r==0)){var E=0;o>Oe.BGR||o===Oe.LUMINANCE_ALPHA?E=Tt:E=et|Nt,E&et&&E&Nt?Zt(e,r,a,n):Jt(e,r,a,n,E)}};var Ut=St;var $t={encNONE:0,enrS3TCDXTN:14,enrPVRTPF_PVRTC2:19,enrPVRTPF_PVRTC:20,enrPVRTPF_PVRTC_4bpp:21,enrPVRTPF_ETC1:22},Bt=Object.freeze($t);function jt(){return!0}function kt(e,r){r=V(r,"This object was destroyed, i.e., destroy() was called.");function a(){throw new D(r)}for(var n in e)typeof e[n]=="function"&&(e[n]=a);e.isDestroyed=jt}var pe=kt;var tt={STREAM_DRAW:x.STREAM_DRAW,STATIC_DRAW:x.STATIC_DRAW,DYNAMIC_DRAW:x.DYNAMIC_DRAW,validate:function(e){return e===tt.STREAM_DRAW||e===tt.STATIC_DRAW||e===tt.DYNAMIC_DRAW}},ye=tt;var Ce={Texture:0,Geometry:1};function He(){this._memoryByType={}}He.prototype.allocateGPUMemory=function(e,r){let a=this._memoryByType[e];a||(a=this._memoryByType[e]=0),a+=r,this._memoryByType[e]=a};He.prototype.releaseGPUMemory=function(e,r){let a=this._memoryByType[e];a==null&&(a=this._memoryByType[e]=0),a-=r,a<0&&(console.log("memory cant less than 0."),a=0),this._memoryByType[e]=a};He.prototype.reset=function(){this._memoryByType={}};function Ve(){this._owners={},this.show=!1}Ve.prototype.allocateGPUMemory=function(e,r,a){if(!this.show)return;let n=this._owners[r];n||(n=this._owners[r]=new He),n.allocateGPUMemory(e,a)};Ve.prototype.releaseGPUMemory=function(e,r,a){if(!this.show)return;let n=this._owners[r];n||(n=this._owners[r]=new He),n.releaseGPUMemory(e,a)};Ve.prototype.reset=function(){this._owners={}};Ve.prototype.isDestroyed=function(){return!1};Ve.prototype.destroy=function(){return pe(this)};function he(e){if(e=V(e,V.EMPTY_OBJECT),K.defined("options.context",e.context),!S(e.typedArray)&&!S(e.sizeInBytes))throw new D("Either options.sizeInBytes or options.typedArray is required.");if(S(e.typedArray)&&S(e.sizeInBytes))throw new D("Cannot pass in both options.sizeInBytes and options.typedArray.");if(S(e.typedArray)&&(K.typeOf.object("options.typedArray",e.typedArray),K.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),!ye.validate(e.usage))throw new D("usage is invalid.");var r=e.context._gl,a=e.bufferTarget,n=e.typedArray,o=e.sizeInBytes,E=e.usage,t=S(n);t&&(o=n.byteLength),K.typeOf.number.greaterThan("sizeInBytes",o,0);var s=r.createBuffer();r.bindBuffer(a,s),r.bufferData(a,t?n:o,E),r.bindBuffer(a,null),this._gl=r,this._webgl2=e.context._webgl2,this._bufferTarget=a,this._sizeInBytes=o,this._usage=E,this._buffer=s,this.context=e.context,e.context.memorySize+=o,this._ownerName=e.owner,this.context.memoryAnalyzer.allocateGPUMemory(Ce.Geometry,e.owner,o)}Object.defineProperties(he.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}});he.prototype._getBuffer=function(){return this._buffer};he.prototype.copyFromArrayView=function(e,r){r=V(r,0),K.defined("arrayView",e),K.typeOf.number.lessThanOrEquals("offsetInBytes + arrayView.byteLength",r+e.byteLength,this._sizeInBytes);var a=this._gl,n=this._bufferTarget;a.bindBuffer(n,this._buffer),a.bufferSubData(n,r,e),a.bindBuffer(n,null)};he.prototype.copyFromBuffer=function(e,r,a,n){if(!this._webgl2)throw new D("A WebGL 2 context is required.");if(!S(e))throw new D("readBuffer must be defined.");if(!S(n)||n<=0)throw new D("sizeInBytes must be defined and be greater than zero.");if(!S(r)||r<0||r+n>e.sizeInBytes)throw new D("readOffset must be greater than or equal to zero and readOffset + sizeInBytes must be less than of equal to readBuffer.sizeInBytes.");if(!S(a)||a<0||a+n>this._sizeInBytes)throw new D("writeOffset must be greater than or equal to zero and writeOffset + sizeInBytes must be less than of equal to this.sizeInBytes.");if(this._buffer===e.buffer&&(a>=r&&a<r+n||r>a&&r<a+n))throw new D("When readBuffer is equal to this, the ranges [readOffset + sizeInBytes) and [writeOffset, writeOffset + sizeInBytes) must not overlap.");if(this._bufferTarget===x.ELEMENT_ARRAY_BUFFER&&e.bufferTarget!==x.ELEMENT_ARRAY_BUFFER||this._bufferTarget!==x.ELEMENT_ARRAY_BUFFER&&e.bufferTarget===x.ELEMENT_ARRAY_BUFFER)throw new D("Can not copy an index buffer into another buffer type.");var o=x.COPY_READ_BUFFER,E=x.COPY_WRITE_BUFFER,t=this._gl;t.bindBuffer(E,this._buffer),t.bindBuffer(o,e.buffer),t.copyBufferSubData(o,E,r,a,n),t.bindBuffer(E,null),t.bindBuffer(o,null)};he.prototype.getBufferData=function(e,r,a,n){if(r=V(r,0),a=V(a,0),!this._webgl2)throw new D("A WebGL 2 context is required.");if(!S(e))throw new D("arrayView is required.");var o,E,t=e.byteLength;if(S(n)?(o=n,S(t)?E=1:(t=e.length,E=e.BYTES_PER_ELEMENT)):S(t)?(o=t-a,E=1):(t=e.length,o=t-a,E=e.BYTES_PER_ELEMENT),a<0||a>t)throw new D("destinationOffset must be greater than zero and less than the arrayView length.");if(a+o>t)throw new D("destinationOffset + length must be less than or equal to the arrayViewLength.");if(r<0||r>this._sizeInBytes)throw new D("sourceOffset must be greater than zero and less than the buffers size.");if(r+o*E>this._sizeInBytes)throw new D("sourceOffset + length must be less than the buffers size.");var s=this._gl,A=x.COPY_READ_BUFFER;s.bindBuffer(A,this._buffer),s.getBufferSubData(A,r,e,a,n),s.bindBuffer(A,null)};he.prototype.isDestroyed=function(){return!1};he.prototype.destroy=function(){return!this.context._contextWasLost&&this._gl.deleteBuffer(this._buffer),this.context.memorySize-=this.sizeInBytes,this.context.memoryAnalyzer.releaseGPUMemory(Ce.Geometry,this._ownerName,this.sizeInBytes),pe(this)};var mt=he;function i(){}i.ALPHA_DISABLE=0;i.ALPHA_ADD=1;i.ALPHA_COMBINE=2;i.ALPHA_SUBTRACT=3;i.ALPHA_MULTIPLY=4;i.ALPHA_MAXIMIZED=5;i.ALPHA_ONEONE=6;i.ALPHA_PREMULTIPLIED=7;i.ALPHA_PREMULTIPLIED_PORTERDUFF=8;i.ALPHA_INTERPOLATE=9;i.ALPHA_SCREENMODE=10;i.ALPHA_ONEONE_ONEONE=11;i.ALPHA_ALPHATOCOLOR=12;i.ALPHA_REVERSEONEMINUS=13;i.ALPHA_SRC_DSTONEMINUSSRCALPHA=14;i.ALPHA_ONEONE_ONEZERO=15;i.ALPHA_EXCLUSION=16;i.ALPHA_LAYER_ACCUMULATE=17;i.ALPHA_EQUATION_ADD=0;i.ALPHA_EQUATION_SUBSTRACT=1;i.ALPHA_EQUATION_REVERSE_SUBTRACT=2;i.ALPHA_EQUATION_MAX=3;i.ALPHA_EQUATION_MIN=4;i.ALPHA_EQUATION_DARKEN=5;i.DELAYLOADSTATE_NONE=0;i.DELAYLOADSTATE_LOADED=1;i.DELAYLOADSTATE_LOADING=2;i.DELAYLOADSTATE_NOTLOADED=4;i.NEVER=512;i.ALWAYS=519;i.LESS=513;i.EQUAL=514;i.LEQUAL=515;i.GREATER=516;i.GEQUAL=518;i.NOTEQUAL=517;i.KEEP=7680;i.ZERO=0;i.REPLACE=7681;i.INCR=7682;i.DECR=7683;i.INVERT=5386;i.INCR_WRAP=34055;i.DECR_WRAP=34056;i.FRONT=0;i.BACK=1;i.TEXTURE_CLAMP_ADDRESSMODE=0;i.TEXTURE_WRAP_ADDRESSMODE=1;i.TEXTURE_MIRROR_ADDRESSMODE=2;i.TEXTURE_CREATIONFLAG_STORAGE=1;i.TEXTUREFORMAT_ALPHA=0;i.TEXTUREFORMAT_LUMINANCE=1;i.TEXTUREFORMAT_LUMINANCE_ALPHA=2;i.TEXTUREFORMAT_RGB=4;i.TEXTUREFORMAT_RGBA=5;i.TEXTUREFORMAT_RED=6;i.TEXTUREFORMAT_R=6;i.TEXTUREFORMAT_RG=7;i.TEXTUREFORMAT_RED_INTEGER=8;i.TEXTUREFORMAT_R_INTEGER=8;i.TEXTUREFORMAT_RG_INTEGER=9;i.TEXTUREFORMAT_RGB_INTEGER=10;i.TEXTUREFORMAT_RGBA_INTEGER=11;i.TEXTUREFORMAT_BGRA=12;i.TEXTUREFORMAT_DEPTH24_STENCIL8=13;i.TEXTUREFORMAT_DEPTH32_FLOAT=14;i.TEXTUREFORMAT_DEPTH16=15;i.TEXTUREFORMAT_DEPTH24=16;i.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17;i.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18;i.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492;i.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493;i.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495;i.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494;i.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779;i.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919;i.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778;i.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918;i.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777;i.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776;i.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917;i.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916;i.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808;i.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840;i.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196;i.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492;i.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493;i.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494;i.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495;i.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496;i.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497;i.TEXTURETYPE_UNSIGNED_BYTE=0;i.TEXTURETYPE_UNSIGNED_INT=0;i.TEXTURETYPE_FLOAT=1;i.TEXTURETYPE_HALF_FLOAT=2;i.TEXTURETYPE_BYTE=3;i.TEXTURETYPE_SHORT=4;i.TEXTURETYPE_UNSIGNED_SHORT=5;i.TEXTURETYPE_INT=6;i.TEXTURETYPE_UNSIGNED_INTEGER=7;i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8;i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9;i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10;i.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11;i.TEXTURETYPE_UNSIGNED_INT_24_8=12;i.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13;i.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14;i.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15;i.TEXTURETYPE_UNDEFINED=16;i.TEXTURE_NEAREST_SAMPLINGMODE=1;i.TEXTURE_NEAREST_NEAREST=1;i.TEXTURE_BILINEAR_SAMPLINGMODE=2;i.TEXTURE_LINEAR_LINEAR=2;i.TEXTURE_TRILINEAR_SAMPLINGMODE=3;i.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3;i.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4;i.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5;i.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6;i.TEXTURE_NEAREST_LINEAR=7;i.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8;i.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9;i.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10;i.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11;i.TEXTURE_LINEAR_NEAREST=12;i.TEXTURE_EXPLICIT_MODE=0;i.TEXTURE_SPHERICAL_MODE=1;i.TEXTURE_PLANAR_MODE=2;i.TEXTURE_CUBIC_MODE=3;i.TEXTURE_PROJECTION_MODE=4;i.TEXTURE_SKYBOX_MODE=5;i.TEXTURE_INVCUBIC_MODE=6;i.TEXTURE_EQUIRECTANGULAR_MODE=7;i.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8;i.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9;i.TEXTURE_FILTERING_QUALITY_OFFLINE=4096;i.TEXTURE_FILTERING_QUALITY_HIGH=64;i.TEXTURE_FILTERING_QUALITY_MEDIUM=16;i.TEXTURE_FILTERING_QUALITY_LOW=8;i.SCALEMODE_FLOOR=1;i.SCALEMODE_NEAREST=2;i.SCALEMODE_CEILING=3;i.MATERIAL_TextureDirtyFlag=1;i.MATERIAL_LightDirtyFlag=2;i.MATERIAL_FresnelDirtyFlag=4;i.MATERIAL_AttributesDirtyFlag=8;i.MATERIAL_MiscDirtyFlag=16;i.MATERIAL_PrePassDirtyFlag=32;i.MATERIAL_AllDirtyFlag=63;i.MATERIAL_TriangleFillMode=0;i.MATERIAL_WireFrameFillMode=1;i.MATERIAL_PointFillMode=2;i.MATERIAL_PointListDrawMode=3;i.MATERIAL_LineListDrawMode=4;i.MATERIAL_LineLoopDrawMode=5;i.MATERIAL_LineStripDrawMode=6;i.MATERIAL_TriangleStripDrawMode=7;i.MATERIAL_TriangleFanDrawMode=8;i.MATERIAL_ClockWiseSideOrientation=0;i.MATERIAL_CounterClockWiseSideOrientation=1;i.ACTION_NothingTrigger=0;i.ACTION_OnPickTrigger=1;i.ACTION_OnLeftPickTrigger=2;i.ACTION_OnRightPickTrigger=3;i.ACTION_OnCenterPickTrigger=4;i.ACTION_OnPickDownTrigger=5;i.ACTION_OnDoublePickTrigger=6;i.ACTION_OnPickUpTrigger=7;i.ACTION_OnPickOutTrigger=16;i.ACTION_OnLongPressTrigger=8;i.ACTION_OnPointerOverTrigger=9;i.ACTION_OnPointerOutTrigger=10;i.ACTION_OnEveryFrameTrigger=11;i.ACTION_OnIntersectionEnterTrigger=12;i.ACTION_OnIntersectionExitTrigger=13;i.ACTION_OnKeyDownTrigger=14;i.ACTION_OnKeyUpTrigger=15;i.PARTICLES_BILLBOARDMODE_Y=2;i.PARTICLES_BILLBOARDMODE_ALL=7;i.PARTICLES_BILLBOARDMODE_STRETCHED=8;i.MESHES_CULLINGSTRATEGY_STANDARD=0;i.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1;i.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2;i.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3;i.SCENELOADER_NO_LOGGING=0;i.SCENELOADER_MINIMAL_LOGGING=1;i.SCENELOADER_SUMMARY_LOGGING=2;i.SCENELOADER_DETAILED_LOGGING=3;i.PREPASS_IRRADIANCE_TEXTURE_TYPE=0;i.PREPASS_POSITION_TEXTURE_TYPE=1;i.PREPASS_VELOCITY_TEXTURE_TYPE=2;i.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3;i.PREPASS_COLOR_TEXTURE_TYPE=4;i.PREPASS_DEPTH_TEXTURE_TYPE=5;i.PREPASS_NORMAL_TEXTURE_TYPE=6;i.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7;i.BUFFER_CREATIONFLAG_READ=1;i.BUFFER_CREATIONFLAG_WRITE=2;i.BUFFER_CREATIONFLAG_READWRITE=3;i.BUFFER_CREATIONFLAG_UNIFORM=4;i.BUFFER_CREATIONFLAG_VERTEX=8;i.BUFFER_CREATIONFLAG_INDEX=16;i.BUFFER_CREATIONFLAG_STORAGE=32;i.RENDERPASS_MAIN=0;i.INPUT_ALT_KEY=18;i.INPUT_CTRL_KEY=17;i.INPUT_META_KEY1=91;i.INPUT_META_KEY2=92;i.INPUT_META_KEY3=93;i.INPUT_SHIFT_KEY=16;i.SNAPSHOTRENDERING_STANDARD=0;i.SNAPSHOTRENDERING_FAST=1;i.PERSPECTIVE_CAMERA=0;i.ORTHOGRAPHIC_CAMERA=1;i.FOVMODE_VERTICAL_FIXED=0;i.FOVMODE_HORIZONTAL_FIXED=1;i.RIG_MODE_NONE=0;i.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10;i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11;i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12;i.RIG_MODE_STEREOSCOPIC_OVERUNDER=13;i.RIG_MODE_STEREOSCOPIC_INTERLACED=14;i.RIG_MODE_VR=20;i.RIG_MODE_WEBVR=21;i.RIG_MODE_CUSTOM=22;i.MAX_SUPPORTED_UV_SETS=6;i.GL_ALPHA_EQUATION_ADD=32774;i.GL_ALPHA_EQUATION_MIN=32775;i.GL_ALPHA_EQUATION_MAX=32776;i.GL_ALPHA_EQUATION_SUBTRACT=32778;i.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779;i.GL_ALPHA_FUNCTION_SRC=768;i.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769;i.GL_ALPHA_FUNCTION_SRC_ALPHA=770;i.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771;i.GL_ALPHA_FUNCTION_DST_ALPHA=772;i.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773;i.GL_ALPHA_FUNCTION_DST_COLOR=774;i.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775;i.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776;i.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769;i.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770;i.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771;i.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772;i.SnippetUrl="";var Ue=i;function rt(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=rt._Counter++}Object.defineProperty(rt.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0});rt._Counter=0;var gt=rt;function Y(e,r,a,n,o,E,t,s){n===void 0&&(n=0),o===void 0&&(o=!1),E===void 0&&(E=!1),t===void 0&&(t=!1),this._isAlreadyOwned=!1,e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=a,this._instanced=E,this._divisor=s||1,r instanceof gt?(this._data=null,this._buffer=r):(this._data=r,this._buffer=null),this.byteStride=t?n:n*Float32Array.BYTES_PER_ELEMENT,o||this.create()}Y.prototype.createVertexBuffer=function(e,r,a,n,o,E,t){E===void 0&&(E=!1);var s=E?r:r*Float32Array.BYTES_PER_ELEMENT,A=n?E?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new c(this._engine,this,e,this._updatable,!0,A,o===void 0?this._instanced:o,s,a,void 0,void 0,!0,this._divisor||t)};Y.prototype.isUpdatable=function(){return this._updatable};Y.prototype.getData=function(){return this._data};Y.prototype.getBuffer=function(){return this._buffer};Y.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT};Y.prototype.create=function(e){e===void 0&&(e=null),!(!e&&this._buffer)&&(e=e||this._data,e&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e)))};Y.prototype._rebuild=function(){this._buffer=null,this.create(this._data)};Y.prototype.update=function(e){this.create(e)};Y.prototype.updateDirectly=function(e,r,a,n){n===void 0&&(n=!1),!!this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,n?r:r*Float32Array.BYTES_PER_ELEMENT,a?a*this.byteStride:void 0),r===0&&a===void 0?this._data=e:this._data=null)};Y.prototype._increaseReferences=function(){if(!!this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}};Y.prototype.dispose=function(){!this._buffer||this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)};function c(e,r,a,n,o,E,t,s,A,u,f,_,T,y){if(f===void 0&&(f=!1),_===void 0&&(_=!1),T===void 0&&(T=1),y===void 0&&(y=!1),r instanceof Y?(this._buffer=r,this._ownsBuffer=y):(this._buffer=new Y(e,r,n,E,o,t,_),this._ownsBuffer=!0),this.uniqueId=c._Counter++,this._kind=a,u==null){var l=this.getData();this.type=c.FLOAT,l instanceof Int8Array?this.type=c.BYTE:l instanceof Uint8Array?this.type=c.UNSIGNED_BYTE:l instanceof Int16Array?this.type=c.SHORT:l instanceof Uint16Array?this.type=c.UNSIGNED_SHORT:l instanceof Int32Array?this.type=c.INT:l instanceof Uint32Array&&(this.type=c.UNSIGNED_INT)}else this.type=u;var h=c.GetTypeByteLength(this.type);_?(this._size=A||(E?E/h:c.DeduceStride(a)),this.byteStride=E||this._buffer.byteStride||this._size*h,this.byteOffset=s||0):(this._size=A||E||c.DeduceStride(a),this.byteStride=E?E*h:this._buffer.byteStride||this._size*h,this.byteOffset=(s||0)*h),this.normalized=f,this._instanced=t!==void 0?t:!1,this._instanceDivisor=t?T:0,this._computeHashCode()}Object.defineProperty(c.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,e==0?this._instanced=!1:this._instanced=!0,this._computeHashCode()},enumerable:!1,configurable:!0});c.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)};c.prototype._rebuild=function(){!this._buffer||this._buffer._rebuild()};c.prototype.getKind=function(){return this._kind};c.prototype.isUpdatable=function(){return this._buffer.isUpdatable()};c.prototype.getData=function(){return this._buffer.getData()};c.prototype.getFloatData=function(e,r){var a=this.getData();if(!a)return null;var n=this.getSize()*c.GetTypeByteLength(this.type),o=e*this.getSize();if(this.type!==c.FLOAT||this.byteStride!==n){var E=new Float32Array(o);return this.forEach(o,function(f,_){return E[_]=f}),E}if(!(a instanceof Array||a instanceof Float32Array)||this.byteOffset!==0||a.length!==o)if(a instanceof Array){var t=this.byteOffset/4;return a.slice(t,t+o)}else{if(a instanceof ArrayBuffer)return new Float32Array(a,this.byteOffset,o);var t=a.byteOffset+this.byteOffset;if(r){var s=new Float32Array(o),A=new Float32Array(a.buffer,t,o);return s.set(A),s}var u=t%4;return u&&(t=Math.max(0,t-u)),new Float32Array(a.buffer,t,o)}return r?a.slice():a};c.prototype.getBuffer=function(){return this._buffer.getBuffer()};c.prototype.getStrideSize=function(){return this.byteStride/c.GetTypeByteLength(this.type)};c.prototype.getOffset=function(){return this.byteOffset/c.GetTypeByteLength(this.type)};c.prototype.getSize=function(e){return e===void 0&&(e=!1),e?this._size*c.GetTypeByteLength(this.type):this._size};c.prototype.getIsInstanced=function(){return this._instanced};c.prototype.getInstanceDivisor=function(){return this._instanceDivisor};c.prototype.create=function(e){this._buffer.create(e)};c.prototype.update=function(e){this._buffer.update(e)};c.prototype.updateDirectly=function(e,r,a){a===void 0&&(a=!1),this._buffer.updateDirectly(e,r,void 0,a)};c.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()};c.prototype.forEach=function(e,r){c.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,r)};c.DeduceStride=function(e){switch(e){case c.UVKind:case c.UV2Kind:case c.UV3Kind:case c.UV4Kind:case c.UV5Kind:case c.UV6Kind:return 2;case c.NormalKind:case c.PositionKind:return 3;case c.ColorKind:case c.MatricesIndicesKind:case c.MatricesIndicesExtraKind:case c.MatricesWeightsKind:case c.MatricesWeightsExtraKind:case c.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}};c.GetTypeByteLength=function(e){switch(e){case c.BYTE:case c.UNSIGNED_BYTE:return 1;case c.SHORT:case c.UNSIGNED_SHORT:return 2;case c.INT:case c.UNSIGNED_INT:case c.FLOAT:return 4;default:throw new Error("Invalid type '".concat(e,"'"))}};c.ForEach=function(e,r,a,n,o,E,t,s){if(e instanceof Array)for(var A=r/4,u=a/4,f=0;f<E;f+=n){for(var _=0;_<n;_++)s(e[A+_],f+_);A+=u}else for(var T=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),y=c.GetTypeByteLength(o),f=0;f<E;f+=n){for(var l=r,_=0;_<n;_++){var h=c._GetFloatValue(T,o,l,t);s(h,f+_),l+=y}r+=a}};c._GetFloatValue=function(e,r,a,n){switch(r){case c.BYTE:{var o=e.getInt8(a);return n&&(o=Math.max(o/127,-1)),o}case c.UNSIGNED_BYTE:{var o=e.getUint8(a);return n&&(o=o/255),o}case c.SHORT:{var o=e.getInt16(a,!0);return n&&(o=Math.max(o/32767,-1)),o}case c.UNSIGNED_SHORT:{var o=e.getUint16(a,!0);return n&&(o=o/65535),o}case c.INT:return e.getInt32(a,!0);case c.UNSIGNED_INT:return e.getUint32(a,!0);case c.FLOAT:return e.getFloat32(a,!0);default:throw new Error("Invalid component type ".concat(r))}};c._Counter=0;c.BYTE=5120;c.UNSIGNED_BYTE=5121;c.SHORT=5122;c.UNSIGNED_SHORT=5123;c.INT=5124;c.UNSIGNED_INT=5125;c.FLOAT=5126;c.PositionKind="position";c.NormalKind="normal";c.TangentKind="tangent";c.UVKind="uv";c.UV2Kind="uv2";c.UV3Kind="uv3";c.UV4Kind="uv4";c.UV5Kind="uv5";c.UV6Kind="uv6";c.ColorKind="color";c.ColorInstanceKind="instanceColor";c.MatricesIndicesKind="matricesIndices";c.MatricesWeightsKind="matricesWeights";c.MatricesIndicesExtraKind="matricesIndicesExtra";c.MatricesWeightsExtraKind="matricesWeightsExtra";function Be(e,r,a){a===void 0&&(a=Ue.BUFFER_CREATIONFLAG_READWRITE),this._engine=e,this._engine._storageBuffers.push(this),this._create(r,a)}Be.prototype._create=function(e,r){this._bufferSize=e,this._creationFlags=r,this._buffer=this._engine.createStorageBuffer(e,r)};Be.prototype._rebuild=function(){this._create(this._bufferSize,this._creationFlags)};Be.prototype.getBuffer=function(){return this._buffer};Be.prototype.update=function(e,r,a){!this._buffer||this._engine.updateStorageBuffer(this._buffer,e,r,a)};Be.prototype.read=function(e,r,a){return this._engine.readFromStorageBuffer(this._buffer,e,r,a)};Be.prototype.dispose=function(){var e=this._engine._storageBuffers,r=e.indexOf(this);r!==-1&&(e[r]=e[e.length-1],e.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null};var Pt=Be;function ve(e){e=V(e,V.EMPTY_OBJECT);var r=e.context,a=e.bufferTarget,n=e.typedArray,o=e.sizeInBytes,E=e.usage,t=S(n);t?o=n.byteLength:n=new Uint8Array(o);var s=Ue.BUFFER_CREATIONFLAG_STORAGE;S(E)&&(E==ye.STREAM_DRAW?s|=Ue.BUFFER_CREATIONFLAG_WRITE:E==ye.STATIC_DRAW?s|=Ue.BUFFER_CREATIONFLAG_WRITE:E==ye.DYNAMIC_DRAW&&(s|=Ue.BUFFER_CREATIONFLAG_READWRITE)),S(a)?a==x.ELEMENT_ARRAY_BUFFER?(n instanceof Uint8Array&&(e.indexDatatype==Se.UNSIGNED_INT?n=new Uint32Array(n.buffer,n.byteOffset,n.byteLength/4):e.indexDatatype==Se.UNSIGNED_SHORT&&(n=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2))),this._dataBuffer=r.engine.createIndexBuffer(n)):a==x.ARRAY_BUFFER?(this._dataBuffer=new Y(r.engine,n,!0),this._dataBuffer._data=null):console.log("BufferGPU not supported bufferTarget"):(this._dataBuffer=new Pt(r.engine,o,s),t&&this._dataBuffer.update(n,0,o)),this._bufferTarget=a,this._sizeInBytes=o,this._usage=E,this.context=e.context,e.context.memorySize+=o,this._ownerName=e.owner,this.context.memoryAnalyzer.allocateGPUMemory(Ce.Geometry,e.owner,o)}Object.defineProperties(ve.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}},dataBuffer:{get:function(){return this._dataBuffer}}});ve.prototype._getBuffer=function(){return console.log("BufferGPU.prototype._getBuffer"),this._dataBuffer};ve.prototype.copyFromArrayView=function(e,r){this._bufferTarget===x.ELEMENT_ARRAY_BUFFER?this.context.engine.updateDynamicIndexBuffer(this._dataBuffer,e):this._dataBuffer.updateDirectly(e,r,null,!0)};ve.prototype.copyFromBuffer=function(e,r,a,n){console.log("BufferGPU.prototype.copyFromBuffer")};ve.prototype.getBufferData=function(e,r,a,n){console.log("BufferGPU.prototype.getBufferData")};ve.prototype.isDestroyed=function(){return!1};ve.prototype.destroy=function(){return this._bufferTarget!==x.ELEMENT_ARRAY_BUFFER?this._dataBuffer.dispose():this.context._engine._releaseBuffer(this._dataBuffer),this.context.memorySize-=this.sizeInBytes,this.context.memoryAnalyzer.releaseGPUMemory(Ce.Geometry,this._ownerName,this.sizeInBytes),pe(this)};var Dt=ve;function er(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.random()*16|0,a=e==="x"?r:r&3|8;return a.toString(16)})}var Mt=er;function j(e){if(e=V(e,V.EMPTY_OBJECT),K.defined("options.context",e.context),!S(e.typedArray)&&!S(e.sizeInBytes))throw new D("Either options.sizeInBytes or options.typedArray is required.");if(S(e.typedArray)&&S(e.sizeInBytes))throw new D("Cannot pass in both options.sizeInBytes and options.typedArray.");S(e.typedArray)&&(K.typeOf.object("options.typedArray",e.typedArray),K.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),this._id=Mt(),e.context.webgpu?this._inner=new Dt(e):this._inner=new mt(e),this.vertexArrayDestroyable=!0}j.createVertexBuffer=function(e){return K.defined("options.context",e.context),new j({context:e.context,bufferTarget:x.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,owner:e.owner})};j.createIndexBuffer=function(e){if(K.defined("options.context",e.context),!Se.validate(e.indexDatatype))throw new D("Invalid indexDatatype.");if(e.indexDatatype===Se.UNSIGNED_INT&&!e.context.elementIndexUint)throw new D("IndexDatatype.UNSIGNED_INT requires OES_element_index_uint, which is not supported on this system.  Check context.elementIndexUint.");var r=e.context,a=e.indexDatatype,n=Se.getSizeInBytes(a),o=new j({context:r,bufferTarget:x.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,indexDatatype:a,owner:e.owner}),E=o.sizeInBytes/n;return Object.defineProperties(o,{indexDatatype:{get:function(){return a}},bytesPerIndex:{get:function(){return n}},numberOfIndices:{get:function(){return E}}}),o};Object.defineProperties(j.prototype,{sizeInBytes:{get:function(){return this._inner.sizeInBytes}},usage:{get:function(){return this._inner.usage}},bufferTarget:{get:function(){return this._inner._bufferTarget}},buffer:{get:function(){return this._inner._buffer}}});j.prototype._getBuffer=function(){return this._inner._getBuffer()};j.prototype.copyFromArrayView=function(e,r){this._inner.copyFromArrayView(e,r)};j.prototype.copyFromBuffer=function(e,r,a,n){this._inner.copyFromBuffer(e,r,a,n)};j.prototype.getBufferData=function(e,r,a,n){this._inner.getBufferData(e,r,a,n)};j.prototype.isDestroyed=function(){return!1};j.prototype.destroy=function(){return this._inner.destroy(),pe(this)};var At=j;function yt(){}yt.computeNeighbors=function(e,r){for(var a=e.length/3,n=new Uint32Array(r+1),o=new Uint32Array(r+1),E=function(N,v){N<v?n[N+1]++:o[v+1]++},t=0;t<a;t++){var s=e[3*t],A=e[3*t+1],u=e[3*t+2];E(s,A),E(A,u),E(u,s)}for(t=A=s=0;t<r;t++)u=n[t+1],E=o[t+1],n[t+1]=s,o[t+1]=A,s+=u,A+=E;for(var f=new Uint32Array(6*a),_=n[r],E=function(L,B,m){if(L<B){var U=n[L+1]++;f[2*U]=B,f[2*U+1]=m}else U=o[B+1]++,f[2*_+2*U]=L,f[2*_+2*U+1]=m},t=0;t<a;t++)s=e[3*t],A=e[3*t+1],u=e[3*t+2],E(s,A,t),E(A,u,t),E(u,s,t);for(s=function(N,v){var L=2*N;for(N=v-N,v=1;v<N;v++){var B=f[L+2*v],m=f[L+2*v+1],U=v-1;for(U;0<=U&&f[L+2*U]>B;U--)f[L+2*U+2]=f[L+2*U],f[L+2*U+3]=f[L+2*U+1];f[L+2*U+2]=B,f[L+2*U+3]=m}},t=0;t<r;t++)s(n[t],n[t+1]),s(_+o[t],_+o[t+1]);for(var T=new Int32Array(3*a),y=function(B,m){return B===e[3*m]?0:B===e[3*m+1]?1:B===e[3*m+2]?2:-1},a=function(B,m){B=y(B,m),T[3*m+B]=-1},s=function(B,m,U,M){B=y(B,m),T[3*m+B]=M,U=y(U,M),T[3*M+U]=m},t=0;t<r;t++){for(var A=n[t],u=n[t+1],E=o[t],l=o[t+1];A<u&&E<l;){var h=f[2*A],d=f[2*_+2*E];h===d?(s(t,f[2*A+1],d,f[2*_+2*E+1]),A++,E++):h<d?(a(t,f[2*A+1]),A++):(a(d,f[2*_+2*E+1]),E++)}for(;A<u;)a(t,f[2*A+1]),A++;for(;E<l;)d=f[2*_+2*E],a(d,f[2*_+2*E+1]),E++}return T};function tr(e){--e;for(var r=1;32>r;r<<=1)e|=e>>r;return e+1}var ce=null;yt.deduplicate=function(e,r,a,n,o){a===void 0&&(a=0),n===void 0&&(n=0),o===void 0&&(o=e.byteLength/(4*r)),e=new Uint32Array(e,n,o*r),n=new Uint32Array(o);var E=Math.floor(1.1*o)+1;(ce==null||ce.length<2*E)&&(ce=new Uint32Array(tr(2*E)));for(var t=0;t<2*E;t++)ce[t]=0;for(var s=0,A=a!==0?Math.ceil(7.84*1.96/(a*a)*a*(1-a)):o,t=0;t<o;t++){if(t===A){var u=1-s/t;if(u+1.96*Math.sqrt(u*(1-u)/t)<a)return null;A*=2}for(var u=t*r,f,_=f=0;_<r;_++)f=e[u+_]+f|0,f=f+(f<<11)+(f>>>2)|0;f>>>=0;for(var _=f%E,T=s;ce[2*_+1]!==0;){if(ce[2*_]===f){var y=ce[2*_+1]-1,l=y*r;e:{for(var h=0;h<r;h++)if(e[u+h]!==e[l+h]){l=!1;break e}l=!0}if(l){T=n[y];break}}_++,_>=E&&(_-=E)}T===s&&(ce[2*_]=f,ce[2*_+1]=t+1,s++),n[t]=T}if(a!==0&&1-s/o<a)return null;for(a=new Uint32Array(r*s),t=s=0;t<o;t++)if(n[t]===s){for(E=e,A=t*r,u=a,f=s*r,_=r,T=0;T<_;T++)u[f+T]=E[A+T];s++}return{buffer:a.buffer,indices:n,uniqueCount:s}};var nt=yt;function xt(){}function rr(e){return Math.acos(1<e?1:-1>e?-1:e)}function Ft(e){return e*Math.PI/180}var nr=4,ar=35,Gt=Ft(nr),ir=Ft(ar),or=Math.cos(ir),Er=Math.cos(Gt);function sr(e,r,a){var n=a.x-r.x,o=a.y-r.y;return r=a.z-r.z,a=n*n+o*o+r*r,a?(a=1/Math.sqrt(a),e.x=n*a,e.y=o*a,e.z=r*a,e):(e.x=0,e.y=0,e.z=0,e)}var ur={position0:new p,position1:new p,faceNormal0:new p,faceNormal1:new p,cosAngle:0},Ot=new p,Ct=new p;function _r(e,r){var a=rr(e.cosAngle);sr(Ct,e.position1,e.position0),p.cross(e.faceNormal0,e.faceNormal1,Ot);var n=0<p.dot(Ot,Ct)?-1:1;return a*n>r}function fr(e){var r=e.faces.length/3,a=e.faces,n=e.neighbors,o=0,E=0;for(E=0;E<r;E++){var t=n[3*E+0],s=n[3*E+1],A=n[3*E+2],u=a[3*E+0],f=a[3*E+1],_=a[3*E+2];o=o+(t===-1||u<f?1:0),o=o+(s===-1||f<_?1:0),o=o+(A===-1||_<u?1:0)}var T=new Int32Array(4*o),y=0;for(E=0;E<r;E++){var t=n[3*E+0],s=n[3*E+1],A=n[3*E+2],u=a[3*E+0],f=a[3*E+1],_=a[3*E+2];(t===-1||u<f)&&(T[y++]=u,T[y++]=f,T[y++]=E,T[y++]=t),(s===-1||f<_)&&(T[y++]=f,T[y++]=_,T[y++]=E,T[y++]=s),(A===-1||_<u)&&(T[y++]=_,T[y++]=u,T[y++]=E,T[y++]=A)}return T}var oe=new p,xe=new p,Fe=new p;function Tr(e){var r=e.x*e.x+e.y*e.y+e.z*e.z;r>0&&(r=1/Math.sqrt(r),e.x*=r,e.y*=r,e.z*=r)}function Ar(e){for(var r=e.faces.length/3,a=e.vertices,n=e.dim,o=e.faces,E=new Float32Array(3*r),t=0;t<r;t++){var s=o[3*t+0],A=o[3*t+1],u=o[3*t+2];oe.x=a[n*s],oe.y=a[n*s+1],oe.z=a[n*s+2],xe.x=a[n*A],xe.y=a[n*A+1],xe.z=a[n*A+2],Fe.x=a[n*u],Fe.y=a[n*u+1],Fe.z=a[n*u+2],p.subtract(xe,oe,xe),p.subtract(Fe,oe,Fe),p.cross(xe,Fe,oe),Tr(oe),E[3*t+0]=oe.x,E[3*t+1]=oe.y,E[3*t+2]=oe.z}return E}function yr(e,r){r===0&&(r=e,e=0);for(var a=Array(r-e),n=e;n<r;n++)a[n-e]=n;return a}xt.extractEdges=function(e){var r=e.vertices,a=e.dim,n=ur,o=n.position0,E=n.position1,t=n.faceNormal0,s=n.faceNormal1,A=Ar(e),u=fr(e),f=u.length/4,_=new Float32Array(9*f),T=0,y=new Float32Array(12*f),l=0,h=0,d=0,N=yr(0,f),v=new Float32Array(f);v.forEach(function(de,R,te){var Z=u[4*R+0],re=u[4*R+1];o.x=r[Z*a],o.y=r[Z*a+1],o.z=r[Z*a+2],E.x=r[re*a],E.y=r[re*a+1],E.z=r[re*a+2],te[R]=p.distance(o,E)}),N.sort(function(de,R){return v[R]-v[de]});for(var L=[],B=[],m=0;m<f;m++){var U=N[m],M=v[U],Q=u[4*U+0],C=u[4*U+1],q=u[4*U+2],X=u[4*U+3],k=X===-1;if(o.x=r[Q*a],o.y=r[Q*a+1],o.z=r[Q*a+2],E.x=r[C*a],E.y=r[C*a+1],E.z=r[C*a+2],k)t.x=A[3*q],t.y=A[3*q+1],t.z=A[3*q+2],s.x=t.x,s.y=t.y,s.z=t.z,n.cosAngle=p.dot(t,s);else if(t.x=A[3*q],t.y=A[3*q+1],t.z=A[3*q+2],s.x=A[3*X],s.y=A[3*X+1],s.z=A[3*X+2],n.cosAngle=p.dot(t,s),n.cosAngle>Er)continue;h+=M,d++,k||n.cosAngle<or?(_[T++]=n.position0.x,_[T++]=n.position0.y,_[T++]=n.position0.z,_[T++]=n.position1.x,_[T++]=n.position1.y,_[T++]=n.position1.z,_[T++]=n.faceNormal0.x,_[T++]=n.faceNormal0.y,_[T++]=n.faceNormal0.z,L.push(M)):_r(n,Gt)&&(y[l++]=n.position0.x,y[l++]=n.position0.y,y[l++]=n.position0.z,y[l++]=n.position1.x,y[l++]=n.position1.y,y[l++]=n.position1.z,y[l++]=n.faceNormal0.x,y[l++]=n.faceNormal0.y,y[l++]=n.faceNormal0.z,y[l++]=n.faceNormal1.x,y[l++]=n.faceNormal1.y,y[l++]=n.faceNormal1.z,B.push(M))}_=_.slice(0,T),y=y.slice(0,l);var P=h/d,ge=L.length,Pe=B.length;return{regular:{instancesData:_,instanceCount:ge,edgeLength:ge*P},silhouette:{instancesData:y,instanceCount:Pe,edgeLength:Pe*P},averageEdgeLength:P}};var wt=xt;var cr={SVC_Vertex:1,SVC_Normal:2,SVC_VertexColor:4,SVC_SecondColor:8,SVC_TexutreCoord:16,SVC_TexutreCoordIsW:32},We=Object.freeze(cr);function z(e){}z.RegularInstanceStride=12;z.SilhouetteInstanceStride=15;z.createEdgeData=function(e,r,a){if(r.length==0)return null;var n=r[0],o;n.indexType===0?o=new Uint16Array(n.indicesTypedArray.buffer,n.indicesTypedArray.byteOffset,n.indicesTypedArray.byteLength/2):o=new Uint32Array(n.indicesTypedArray.buffer,n.indicesTypedArray.byteOffset,n.indicesTypedArray.byteLength/4);var E=!1,t=z.extractEdgeInformation(e,E,o),s=wt.extractEdges(t);return S(a)&&(S(s.regular.instancesData)&&a.push(s.regular.instancesData.buffer),S(s.silhouette.instancesData)&&a.push(s.silhouette.instancesData.buffer)),s};z.createIndexBuffer=function(e,r){return e.createSidenessIndexBuffer()};z.createRegularEdgeAttributes=function(e,r,a,n){if(!(!S(r.instancesData)||r.instancesData.length==0)){var o={},E=[];r.attributeLocations=o,r.attributes=E;var t=At.createVertexBuffer({context:e,typedArray:r.instancesData,usage:ye.STATIC_DRAW,owner:n});r.instancesData=null;var s=I.getSizeInBytes(I.FLOAT),A=e.createSidenessVertexBuffer(),u=0;o.aSideness=u++,E.push({name:"aSideness",index:o.aSideness,vertexBuffer:A,componentsPerAttribute:2,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:I.getSizeInBytes(I.FLOAT)*2,normalize:!1});var f=a||z.RegularInstanceStride,_=0;o.aPosition0=u++,E.push({name:"aPosition0",index:o.aPosition0,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:s*_,strideInBytes:s*f,instanceDivisor:1}),_+=3,o.aPosition1=u++,E.push({name:"aPosition1",index:o.aPosition1,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:s*_,strideInBytes:s*f,instanceDivisor:1}),_+=3,o.aNormal=u++,E.push({name:"aNormal",index:o.aNormal,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!0,offsetInBytes:s*_,strideInBytes:s*f,instanceDivisor:1}),_+=3,o.batchId=u++,E.push({name:"batchId",index:o.batchId,vertexBuffer:t,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!0,offsetInBytes:s*_,strideInBytes:s*f,instanceDivisor:1}),_+=1,o.aVariantStroke=u++,E.push({name:"aVariantStroke",index:o.aVariantStroke,vertexBuffer:t,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!0,offsetInBytes:s*_,strideInBytes:s*f,instanceDivisor:1}),_+=1,o.aVariantExtension=u++,E.push({name:"aVariantExtension",index:o.aVariantExtension,vertexBuffer:t,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!0,offsetInBytes:s*_,strideInBytes:s*f,instanceDivisor:1}),_+=1}};z.createSilhouetteEdgeAttributes=function(e,r,a){if(!(!S(r.instancesData)||r.instancesData.length==0)){var n={},o=[];r.attributeLocations=n,r.attributes=o;var E=At.createVertexBuffer({context:e,typedArray:r.instancesData,usage:ye.STATIC_DRAW,owner:a});r.instancesData=null;var t=I.getSizeInBytes(I.FLOAT),s=0;n.aSideness=s++,o.push({name:"aSideness",index:n.aSideness,vertexBuffer:e.createSidenessVertexBuffer(),componentsPerAttribute:2,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:t*2,normalize:!1});var A=z.SilhouetteInstanceStride,u=0;n.aPosition0=s++,o.push({name:"aPosition0",index:n.aPosition0,vertexBuffer:E,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:t*u,strideInBytes:t*A,instanceDivisor:1}),u+=3,n.aPosition1=s++,o.push({name:"aPosition1",index:n.aPosition1,vertexBuffer:E,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:t*u,strideInBytes:t*A,instanceDivisor:1}),u+=3,n.aNormalA=s++,o.push({name:"aNormalA",index:n.aNormalA,vertexBuffer:E,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!0,offsetInBytes:t*u,strideInBytes:t*A,instanceDivisor:1}),u+=3,n.aNormalB=s++,o.push({name:"aNormalB",index:n.aNormalB,vertexBuffer:E,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!0,offsetInBytes:t*u,strideInBytes:t*A,instanceDivisor:1}),u+=3,n.batchId=s++,o.push({name:"batchId",index:n.batchId,vertexBuffer:E,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!0,offsetInBytes:t*u,strideInBytes:t*A,instanceDivisor:1}),u+=1,n.aVariantStroke=s++,o.push({name:"aVariantStroke",index:n.aVariantStroke,vertexBuffer:E,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!0,offsetInBytes:t*u,strideInBytes:t*A,instanceDivisor:1}),u+=1,n.aVariantExtension=s++,o.push({name:"aVariantExtension",index:n.aVariantExtension,vertexBuffer:E,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!0,offsetInBytes:t*u,strideInBytes:t*A,instanceDivisor:1}),u+=1}};function Yt(e,r){for(var a=r.componentsPerAttribute,n=e.vertCompressConstant,o=new p(e.minVerticesValue.x,e.minVerticesValue.y,e.minVerticesValue.z),E=new Uint16Array(r.typedArray.buffer,r.typedArray.byteOffset,r.typedArray.byteLength/2),t=new Float32Array(e.verticesCount*3),s,A,u,f=0;f<e.verticesCount;f++)s=E[a*f]*n+o.x,A=E[a*f+1]*n+o.y,u=E[a*f+2]*n+o.z,t[3*f]=s,t[3*f+1]=A,t[3*f+2]=u;return t}z.extractEdgeInformation=function(e,r,a){var n=e.attrLocation.aPosition,o=e.vertexAttributes[n],E=S(e.nCompressOptions)&&(e.nCompressOptions&We.SVC_Vertex)===We.SVC_Vertex,t=o.componentsPerAttribute,s;E?(t=3,s=Yt(e,o)):s=new Float32Array(o.typedArray.buffer,o.typedArray.byteOffset,o.typedArray.byteLength/4);var A=s.length/t;if(r&&a){var u=nt.computeNeighbors(a,A);return{faces:a,neighbors:u,vertices:s,dim:t}}var f=o.typedArray.buffer,_;E?_=s.buffer:_=f.slice(o.typedArray.byteOffset,o.typedArray.byteOffset+o.typedArray.byteLength);var T=nt.deduplicate(_,t),y=z.selectIndexData(T.indices,a),l=nt.computeNeighbors(y,T.uniqueCount),h=new Float32Array(T.buffer);return{faces:y,neighbors:l,vertices:h,dim:t}};z.selectIndexData=function(e,r){if(r){r=r.slice();for(var a=0;a<r.length;a++)r[a]=e[r[a]];return r}return e};var O=new p,F=new p,me=new p,Ge=new p,G=new p,at=new p,Re=new p,bt=new p;z.createEdgeDataByIndices=function(e,r){var a=e.attrLocation.aPosition,n=e.vertexAttributes[a],o=S(e.nCompressOptions)&&(e.nCompressOptions&We.SVC_Vertex)===We.SVC_Vertex,E=n.componentsPerAttribute,t;o?(E=3,t=Yt(e,n)):t=new Float32Array(n.typedArray.buffer,n.typedArray.byteOffset,n.typedArray.byteLength/4);var s;r.indexType===0?s=new Uint16Array(r.indicesTypedArray.buffer,r.indicesTypedArray.byteOffset,r.indicesTypedArray.byteLength/2):s=new Uint32Array(r.indicesTypedArray.buffer,r.indicesTypedArray.byteOffset,r.indicesTypedArray.byteLength/4);for(var A=[],u=[],f=s.length,_=0,T=0,y=Math.floor(f/4)*4;T<y;T+=4){var l=s[T],h=s[T+1],d=s[T+2],N=s[T+3];if(O.x=t[E*l],O.y=t[E*l+1],O.z=t[E*l+2],F.x=t[E*h],F.y=t[E*h+1],F.z=t[E*h+2],me.x=t[E*d],me.y=t[E*d+1],me.z=t[E*d+2],Ge.x=t[E*N],Ge.y=t[E*N+1],Ge.z=t[E*N+2],!(p.equals(F,me)||p.equals(F,Ge)||p.equals(F,O)||p.equals(me,O)||p.equals(Ge,O))){if(d===N){if(p.subtract(F,O,G),p.subtract(me,O,at),p.cross(G,at,G),p.equals(G,p.ZERO))continue;p.normalize(G,G),A.push(O.x),A.push(O.y),A.push(O.z),A.push(F.x),A.push(F.y),A.push(F.z),A.push(G.x),A.push(G.y),A.push(G.z),A.push(l);var v=zt(O,F),L=v.variantStroke,B=v.variantExtension;A.push(L),A.push(B)}else{if(p.subtract(F,O,G),p.subtract(me,O,at),p.cross(G,at,G),p.equals(G,p.ZERO)||(p.normalize(G,G),p.subtract(F,O,Re),p.subtract(Ge,O,bt),p.cross(bt,Re,Re),p.equals(Re,p.ZERO)))continue;p.normalize(Re,Re),u.push(O.x),u.push(O.y),u.push(O.z),u.push(F.x),u.push(F.y),u.push(F.z),u.push(G.x),u.push(G.y),u.push(G.z),u.push(Re.x),u.push(Re.y),u.push(Re.z),u.push(l);var v=zt(O,F),L=v.variantStroke,B=v.variantExtension;u.push(L),u.push(B)}var m=p.distance(O,F);_+=m}}var U=f/4,M=_/U,Q=A.length/z.RegularInstanceStride,C=u.length/z.SilhouetteInstanceStride;return{regular:{instancesData:new Float32Array(A),instanceCount:Q,edgeLength:Q*M},silhouette:{instancesData:new Float32Array(u),instanceCount:C,edgeLength:C},averageEdgeLength:M}};function zt(e,r){function a(y,l){var h=new Float32Array(6),d=new Uint32Array(h.buffer),N=new Uint32Array(1);h[0]=y.x,h[1]=y.y,h[2]=y.z,h[3]=l.x,h[4]=l.y,h[5]=l.z,N[0]=5381;for(var v=0;v<d.length;v++)N[0]=31*N[0]+d[v];return N[0]}function n(y,l,h){h-=l;var d=48217*y%2147483647,N=d/2147483647,v=l+N*h;return{seed:d,result:Math.round(v)}}function o(y){var l=48217*y%2147483647,h=l/(2147483647-1);return{seed:l,result:h}}var E=a(e,r);S(E)||(E=Math.random()*2147483647);var t=n(E,0,255);E=t.seed;var s=t.result;t=n(E,0,5),E=t.seed;var A=t.result;t=o(E),E=t.seed;var u=t.result;u=-(1-Math.min(u/.7,1))+Math.max(0,u-.7)/(1-.7),u=255*(Math.abs(u)**1.2*(0>u?-1:1)*.5+.5);var f=s,_=A,T=u;return{variantStroke:_,variantExtension:T}}var it=z;function Rr(e,r,a,n,o,E){this.left=e,this.bottom=r,this.right=a,this.top=n,this.minHeight=o,this.maxHeight=E,this.width=a-e,this.length=n-r,this.height=E-o}var _a=new vt;function lr(e,r,a,n,o,E,t,s){var A=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var u=0,f={},_=f.vertexAttributes=[],T=f.attrLocation={};f.instanceCount=0,f.instanceMode=0;var y=0,l=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var h=E.getUint16(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var d=h;h>4&&(d=h>>8,h=h&15);var N=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var v=void 0,L=void 0;if(N>0){var B=E.getUint16(t,!0);B=h*Float32Array.BYTES_PER_ELEMENT,t+=Uint32Array.BYTES_PER_ELEMENT,u=N*B;var m=o.subarray(t,t+u);if(n||a){var U=new p,M=new p,Q=new Float32Array(m.buffer,m.byteOffset,m.byteLength/4),C=new Xe;v=new Xe,L=new Xe;for(var q=4,X=new Float32Array(N*q),k=new Float64Array(N*2),P=0;P<N;P++)pt.multiplyByPoint(r,p.fromElements(Q[4*P],Q[4*P+1],Q[4*P+2],U),M),C=Xe.fromCartesian(M),k[2*P]=C.longitude,k[2*P+1]=C.latitude,P===0?(v.longitude=C.longitude,v.latitude=C.latitude,L.longitude=C.longitude,L.latitude=C.latitude):(v.longitude=Math.max(C.longitude,v.longitude),v.latitude=Math.max(C.latitude,v.latitude),L.longitude=Math.min(C.longitude,L.longitude),L.latitude=Math.min(C.latitude,L.latitude));for(var ge=a?v.longitude-L.longitude:1,Pe=a?v.latitude-L.latitude:1,P=0;P<N;P++)X[4*P]=k[2*P]-L.longitude,X[4*P+1]=k[2*P+1]-L.latitude,X[4*P+2]=(k[2*P]-L.longitude)/ge,X[4*P+3]=(k[2*P+1]-L.latitude)/Pe;T.aRelativeGeoCoord=y,_.push({index:T.aRelativeGeoCoord,typedArray:X,componentsPerAttribute:q,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:q*Float32Array.BYTES_PER_ELEMENT,normalize:!1}),y++}T.aPosition=y,_.push({index:T.aPosition,typedArray:m,componentsPerAttribute:h,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:B,normalize:!1}),y++,t+=u}var de=E.getUint32(t,!0);if(t+=Uint32Array.BYTES_PER_ELEMENT,de>0){var R=E.getUint16(t,!0);R=d*Float32Array.BYTES_PER_ELEMENT,t+=Uint32Array.BYTES_PER_ELEMENT,u=de*R;let Le=new Float32Array(o.buffer,t,3),ot=Le[0]===0&&Le[1]===0&&Le[2]===0;!e.ignoreNormal&&!ot&&(T.aNormal=y,_.push({index:T.aNormal,typedArray:o.subarray(t,t+u),componentsPerAttribute:d,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:R,normalize:!1}),y++),t+=u}var te=E.getUint32(t,!0);if(t+=Uint32Array.BYTES_PER_ELEMENT,te>0){var Z=new Uint8Array(4*te);s.push(Z.buffer);var re=E.getUint32(t,!0);re=4*Float32Array.BYTES_PER_ELEMENT,t+=Uint32Array.BYTES_PER_ELEMENT,u=te*re;for(var ee=new Float32Array(o.buffer,t,N*4),W=0;W<N;W++)Z[4*W]=ee[4*W]*255,Z[4*W+1]=ee[4*W+1]*255,Z[4*W+2]=ee[4*W+2]*255,Z[4*W+3]=ee[4*W+3]*255;t+=u,T.aColor=y,_.push({index:T.aColor,typedArray:Z,componentsPerAttribute:4,componentDatatype:I.UNSIGNED_BYTE,offsetInBytes:0,strideInBytes:4,normalize:!0}),y++}var g=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT,g>0&&(u=g*16,t+=u);var we=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;for(var De=-1,ne,Ie,J,Ee=0;Ee<we;Ee++){ne=E.getUint32(t,!0),t+=Uint32Array.BYTES_PER_ELEMENT,J=E.getUint16(t,!0),t+=Uint16Array.BYTES_PER_ELEMENT,Ie=E.getUint16(t,!0),t+=Uint16Array.BYTES_PER_ELEMENT,u=ne*J*Float32Array.BYTES_PER_ELEMENT;var b=o.subarray(t,t+u);if(De==-1&&(J==20||J==35)){De=Ee,f.instanceCount=ne,f.instanceMode=J,f.instanceBuffer=b;var se=J*ne,w;J===20?(w=Float32Array.BYTES_PER_ELEMENT*20,T.uv2=y++,_.push({index:T.uv2,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:w,instanceDivisor:1}),T.uv3=y++,_.push({index:T.uv3,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),T.uv4=y++,_.push({index:T.uv4,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),T.secondary_colour=y++,_.push({index:T.secondary_colour,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),T.uv6=y++,_.push({index:T.uv6,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1})):J===35&&(w=Float32Array.BYTES_PER_ELEMENT*35,T.uv1=y++,_.push({index:T.uv1,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:w,instanceDivisor:1,byteLength:u}),T.uv2=y++,_.push({index:T.uv2,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),T.uv3=y++,_.push({index:T.uv3,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),T.uv4=y++,_.push({index:T.uv4,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),T.uv5=y++,_.push({index:T.uv5,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),T.uv6=y++,_.push({index:T.uv6,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:20*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),T.uv7=y++,_.push({index:T.uv7,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:24*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),T.secondary_colour=y++,_.push({index:T.secondary_colour,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:27*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),T.uv9=y++,_.push({index:T.uv9,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:31*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}))}else if(De!==-1)f.instanceBounds=new Float32Array(o.buffer,t,ne*J);else{var Ke="aTexCoord"+Ee;T[Ke]=y++,_.push({index:T[Ke],typedArray:b,componentsPerAttribute:J,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:J*Float32Array.BYTES_PER_ELEMENT,normalize:!1})}t+=u}f.verticesCount=N,f.instanceIndex=De;var $=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;for(var ue=[],Ee=0;Ee<$;Ee++){var H={},Ne=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var _e=E.getUint8(t,!0);t+=Uint8Array.BYTES_PER_ELEMENT;var fe=E.getUint8(t,!0);t+=Uint8Array.BYTES_PER_ELEMENT;var Te=E.getUint8(t,!0);t+=Uint8Array.BYTES_PER_ELEMENT,t+=1,H.indicesCount=Ne,H.indexType=_e,H.primitiveType=Te;var ae=t;Ne>0&&(_e==0?(u=Ne*Uint16Array.BYTES_PER_ELEMENT,t+=u,Ne%2==1&&(t+=2)):(u=Ne*4,t+=u)),H.indicesTypedArray=o.subarray(ae,ae+u);var be=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var Ae=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT*be,H.materialCode=Ae,ue.push(H)}var le;ue.length===2&&ue[1].primitiveType===13&&ue[1].indicesCount>=3&&(le=it.createEdgeDataByIndices(f,ue[1],s));let Qe;return v!==void 0&&L!==void 0&&(Qe={max:v,min:L}),e[A]={vertexPackage:f,arrIndexPackage:ue,edgeGeometry:le,cartographicBounds:Qe},t}function Xt(e,r,a){var n=e.vertexAttributes,o=e.attrLocation,E=n.length,t=a===1?"instanceId":"batchId";o[t]=E,n.push({index:E,typedArray:r,componentsPerAttribute:1,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:0,instanceDivisor:a})}function pr(e,r){var a=e.buffer,n=e.supportCompressType,o=e.bVolume,E=null,t=null,s=null,A=e.isCoverImageryLayer,u=e.coveredMap,f=e.modelMatrix;if(o&&e.volbuffer.byteLength<8&&(o=!1),o){var _=e.volbuffer,re=new Uint8Array(_,8),T=ft.inflate(re).buffer,y=new Float64Array(T,0,1),l=new Uint32Array(T,48,1);if(y[0]===0||l[0]===3200||l[0]===3201){var h=0;y[0]===0&&(h=8),r.push(T);var d=new Float64Array(T,h,6),N=d[0],v=d[1],L=d[2],B=d[3],m=d[4]<d[5]?d[4]:d[5],U=d[4]>d[5]?d[4]:d[5];E=new Rr(N,B,L,v,m,U),t={left:N,top:v,right:L,bottom:B,minHeight:m,maxHeight:U,width:E.width,length:E.length,height:E.height};var M=new Uint32Array(T,48+h,7),Q=M[0],C=M[1],q=M[2],X=M[3],k=M[4],P=M[5],ge=M[6],Pe=X*X*4,de=new Uint8Array(T,76+h,Pe);s={nFormat:Q,nSideBlockCount:C,nBlockLength:q,nLength:X,nWidth:k,nHeight:P,nDepth:ge,imageArray:de}}}var R=0,te=new Uint8Array(a,0,4);if(te[0]!==115||te[1]!==51||te[2]!==109)return{result:!1};var Z=te[3],re=new Uint8Array(a,4),ee=ft.inflate(re).buffer,W=new Uint8Array(ee);r.push(W.buffer);var g=new DataView(ee),we=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var De=new Uint8Array(ee,R,we),ne=we%4;ne&&(ne=4-ne),R+=we+ne;var Ie=dt(De,void 0,void 0,"gbk");Ie=Ie.replace(new RegExp(`\r
`,"gm"),""),Ie=Ie.replace(new RegExp(":","gm"),"");var J=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var Ee=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var b={};b.ignoreNormal=e.ignoreNormal;for(var se=0;se<Ee;se++)R=lr(b,f,u,A,W,g,R,r);var w=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var Ke=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;for(var se=0;se<Ke;se++){var $=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ue=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var H={},Ne=b[$].vertexPackage.instanceIndex,Ze=b[$].edgeGeometry;if(Ne==-1){for(var _e=new Float32Array(b[$].vertexPackage.verticesCount),fe=0;fe<ue;fe++){var Te=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ae=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var be=0,Ae=0;H[Te]={batchId:fe};for(var le=0;le<ae;le++)if(Ae=g.getUint32(R,!0),R+=Uint32Array.BYTES_PER_ELEMENT,be=g.getUint32(R,!0),R+=Uint32Array.BYTES_PER_ELEMENT,_e.fill)_e.fill(fe,Ae,Ae+be);else for(var Qe=Ae+Ae,Le=Ae;Le<Qe;Le++)_e[Le]=fe;H[Te].vertexColorOffset=Ae,H[Te].vertexColorCount=be}Xt(b[$].vertexPackage,_e,void 0)}else{for(var ot=b[$].vertexPackage.instanceCount,hr=b[$].vertexPackage.instanceBuffer,vr=b[$].vertexPackage.instanceMode,ct=new Float32Array(ot),qe=0,fe=0;fe<ue;fe++){var Te=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ae=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;for(var le=0;le<ae;le++){var Ht=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT,ct[qe]=qe,H[Te]===void 0&&(H[Te]={vertexColorCount:1,instanceIds:[],vertexColorOffset:qe}),H[Te].instanceIds.push(Ht),qe++}}Xt(b[$].vertexPackage,ct,1)}b[$].pickInfo=H;var Ze=b[$].edgeGeometry;if(S(Ze)){var Je=Ze.regular.instancesData,Et=it.RegularInstanceStride,ie,$e;if(S(Je))for($e=Je.length,ie=0;ie<$e;ie+=Et){var st=Je[ie+9];Je[ie+9]=_e[st]}var je=Ze.silhouette.instancesData;if(Et=it.SilhouetteInstanceStride,S(je))for($e=je.length,ie=0;ie<$e;ie+=Et){var st=je[ie+12];je[ie+12]=_e[st]}}}var dr=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var Vt=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;for(var Rt={},se=0;se<Vt;se++){var lt=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ze=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var Ye=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ut=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ae=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ke=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var Me=null;if(ut===Bt.enrS3TCDXTN&&n!==1){var _t=null;ke>Oe.BGR||ke===Oe.LUMINANCE_ALPHA?(_t=new Uint8Array(ee,R,ze*Ye),Me=new Uint8Array(ze*Ye*4)):(_t=new Uint16Array(ee,R,ae/2),Me=new Uint16Array(ze*Ye)),Ut.decode(Me,ze,Ye,_t,ke),r.push(Me.buffer),ut=0}else Me=new Uint8Array(ee,R,ae);Rt[lt]={id:lt,width:ze,height:Ye,compressType:ut,nFormat:ke,imageBuffer:Me},R+=ae}return{result:!0,version:Z,xmlDoc:Ie,geoPackage:b,texturePackage:Rt,volImageBuffer:s,volBounds:t}}var fa=ht(pr);export{fa as default};
