import{a as gt}from"./chunk-H6N4J6TN.js";import{a as Oe}from"./chunk-W2PIDO6K.js";import{a as Tt}from"./chunk-77JEGE4I.js";import{a as Ut}from"./chunk-X2INLI3M.js";import{a as dt}from"./chunk-AMRCVYIA.js";import{a as Ne}from"./chunk-44AFRGCG.js";import{a as mt}from"./chunk-F5UB2CPM.js";import{a as I}from"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import"./chunk-KJYJTW2V.js";import"./chunk-6NA2GRXE.js";import{a as C}from"./chunk-EHDXVZQM.js";import"./chunk-ZVKIUA3Y.js";import{b as Xe}from"./chunk-3HZNWEV7.js";import{a as c}from"./chunk-LBR6REQR.js";import"./chunk-GXFCHGTA.js";import{a as V}from"./chunk-UBHQMGET.js";import{a as K}from"./chunk-EDZQSM3T.js";import{a as P}from"./chunk-PJGSCWXZ.js";import{a as N}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";//! Use DXT1 compression.
var et=1<<0;//! Use DXT3 compression.
var Bt=1<<1;//! Use DXT5 compression.
var At=1<<2;//! Use a very slow but very high quality colour compressor.
var zr=1<<8;//! Use a slow but high quality colour compressor (the default).
var Yr=1<<3;//! Use a fast but low quality colour compressor.
var br=1<<4;//! Weight the colour by alpha during cluster fit (disabled by default).
var Xr=1<<7,Pt=1<<5;function Dt(e,n,r,i){var a=e|n<<8,E=a>>11&31,t=a>>5&63,s=a&31;return r[i+0]=E<<3|E>>2,r[i+1]=t<<2|t>>4,r[i+2]=s<<3|s>>2,r[i+3]=255,a}function jt(e,n,r,i){for(var a=new Uint8Array(16),E=Dt(n[r+0],n[r+1],a,0),t=Dt(n[r+2],n[r+3],a,4),s=0;s<3;s++){var x=a[s],u=a[4+s];i&&E<=t?(a[8+s]=(x+u)/2,a[12+s]=0):(a[8+s]=(2*x+u)/3,a[12+s]=(x+2*u)/3)}a[8+3]=255,a[12+3]=i&&E<=t?0:255;for(var T=new Uint8Array(16),s=0;s<4;++s){var f=n[r+4+s];T[4*s+0]=f&3,T[4*s+1]=f>>2&3,T[4*s+2]=f>>4&3,T[4*s+3]=f>>6&3}for(var s=0;s<16;++s)for(var A=4*T[s],y=0;y<4;++y)e[4*s+y]=a[A+y]}function er(e,n,r){for(var i=0;i<8;++i){var a=bytes[r+i],E=a&15,t=a&240;e[8*i+3]=E|E<<4,e[8*i+7]=t|t>>4}}function tr(e,n,x){var i=n[x+0],a=n[x+1],E=new Uint8Array(8);if(E[0]=i,E[1]=a,i<=a){for(var t=1;t<5;++t)E[1+t]=((5-t)*i+t*a)/5;E[6]=0,E[7]=255}else for(var t=1;t<7;++t)E[1+t]=((7-t)*i+t*a)/7;for(var s=new Uint8Array(16),x=x+2,u=0,t=0;t<2;++t){for(var T=0,f=0;f<3;++f){var A=n[x++];T|=A<<8*f}for(var f=0;f<8;++f){var y=T>>3*f&7;s[u++]=y}}for(var t=0;t<16;++t)e[4*t+3]=E[s[t]]}function rr(e,n,r,i){var a=0;(i&(Bt|At))!=0&&(a=8),jt(e,n,r+a,(i&et)!=0),(i&Bt)!=0?er(e,n,r):(i&At)!=0&&tr(e,n,r)}function nr(e,n,r,i){for(var a=new Uint16Array(4),E=e,t=0,s=0,x=0,u=0,T=0,f=0,A=0,y=0,p=0,l=n/4,v=r/4,S=0;S<v;S++)for(var h=0;h<l;h++)x=4*((v-S)*l+h),a[0]=i[x],a[1]=i[x+1],u=a[0]&31,T=a[0]&2016,f=a[0]&63488,A=a[1]&31,y=a[1]&2016,p=a[1]&63488,a[2]=5*u+3*A>>3|5*T+3*y>>3&2016|5*f+3*p>>3&63488,a[3]=5*A+3*u>>3|5*y+3*T>>3&2016|5*p+3*f>>3&63488,t=i[x+2],s=S*4*n+h*4,E[s]=a[t&3],E[s+1]=a[t>>2&3],E[s+2]=a[t>>4&3],E[s+3]=a[t>>6&3],s+=n,E[s]=a[t>>8&3],E[s+1]=a[t>>10&3],E[s+2]=a[t>>12&3],E[s+3]=a[t>>14],t=i[x+3],s+=n,E[s]=a[t&3],E[s+1]=a[t>>2&3],E[s+2]=a[t>>4&3],E[s+3]=a[t>>6&3],s+=n,E[s]=a[t>>8&3],E[s+1]=a[t>>10&3],E[s+2]=a[t>>12&3],E[s+3]=a[t>>14];return E}/*! @brief Decompresses an image in memory.

 @param rgba		Storage for the decompressed pixels.
 @param width	The width of the source image.
 @param height	The height of the source image.
 @param blocks	The compressed DXT blocks.
 @param flags	Compression flags.

 The decompressed pixels will be written as a contiguous array of width*height
 16 rgba values, with each component as 1 byte each. In memory this is:

 { r1, g1, b1, a1, .... , rn, gn, bn, an } for n = width*height

 The flags parameter should specify either kDxt1, kDxt3 or kDxt5 compression,
 however, DXT1 will be used by default if none is specified. All other flags
 are ignored.

 Internally this function calls squish::Decompress for each block.
 */function ir(e,n,r,i,a){for(var E=(a&et)!=0?8:16,t=0,s=0;s<r;s+=4)for(var x=0;x<n;x+=4){var u=new Uint8Array(64);rr(u,i,t,a);for(var T=0,f=0;f<4;++f)for(var A=0;A<4;++A){var y=x+A,p=s+f;if(y<n&&p<r)for(var l=4*(n*(r-p)+y),v=0;v<4;++v)e[l++]=u[T++];else T+=4}t+=E}}function Ot(e){}Ot.decode=function(e,n,r,i,a){if(!(e==null||i==null||r==0||n==0)){var E=0;a>Oe.BGR||a===Oe.LUMINANCE_ALPHA?E=At:E=et|Pt,E&et&&E&Pt?nr(e,n,r,i):ir(e,n,r,i,E)}};var Mt=Ot;var ar=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),xt=ar(void 0,function(){return xt.toString().search("(((.+)+)+)+$").toString().constructor(xt).search("(((.+)+)+)+$")});xt();var or={encNONE:0,enrS3TCDXTN:14,enrPVRTPF_PVRTC2:19,enrPVRTPF_PVRTC:20,enrPVRTPF_PVRTC_4bpp:21,enrPVRTPF_ETC1:22},Ct=Object.freeze(or);function Er(){return!0}function sr(e,n){n=V(n,"This object was destroyed, i.e., destroy() was called.");function r(){throw new P(n)}for(var i in e)typeof e[i]=="function"&&(e[i]=r);e.isDestroyed=Er}var ce=sr;var tt={STREAM_DRAW:C.STREAM_DRAW,STATIC_DRAW:C.STATIC_DRAW,DYNAMIC_DRAW:C.DYNAMIC_DRAW,validate:function(e){return e===tt.STREAM_DRAW||e===tt.STATIC_DRAW||e===tt.DYNAMIC_DRAW}},ye=tt;var Me={Texture:0,Geometry:1};function He(){this._memoryByType={}}He.prototype.allocateGPUMemory=function(e,n){let r=this._memoryByType[e];r||(r=this._memoryByType[e]=0),r+=n,this._memoryByType[e]=r};He.prototype.releaseGPUMemory=function(e,n){let r=this._memoryByType[e];r==null&&(r=this._memoryByType[e]=0),r-=n,r<0&&(console.log("memory cant less than 0."),r=0),this._memoryByType[e]=r};He.prototype.reset=function(){this._memoryByType={}};function Ve(){this._owners={},this.show=!1}Ve.prototype.allocateGPUMemory=function(e,n,r){if(!this.show)return;let i=this._owners[n];i||(i=this._owners[n]=new He),i.allocateGPUMemory(e,r)};Ve.prototype.releaseGPUMemory=function(e,n,r){if(!this.show)return;let i=this._owners[n];i||(i=this._owners[n]=new He),i.releaseGPUMemory(e,r)};Ve.prototype.reset=function(){this._owners={}};Ve.prototype.isDestroyed=function(){return!1};Ve.prototype.destroy=function(){return ce(this)};function le(e){if(e=V(e,V.EMPTY_OBJECT),K.defined("options.context",e.context),!N(e.typedArray)&&!N(e.sizeInBytes))throw new P("Either options.sizeInBytes or options.typedArray is required.");if(N(e.typedArray)&&N(e.sizeInBytes))throw new P("Cannot pass in both options.sizeInBytes and options.typedArray.");if(N(e.typedArray)&&(K.typeOf.object("options.typedArray",e.typedArray),K.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),!ye.validate(e.usage))throw new P("usage is invalid.");var n=e.context._gl,r=e.bufferTarget,i=e.typedArray,a=e.sizeInBytes,E=e.usage,t=N(i);t&&(a=i.byteLength),K.typeOf.number.greaterThan("sizeInBytes",a,0);var s=n.createBuffer();n.bindBuffer(r,s),n.bufferData(r,t?i:a,E),n.bindBuffer(r,null),this._gl=n,this._webgl2=e.context._webgl2,this._bufferTarget=r,this._sizeInBytes=a,this._usage=E,this._buffer=s,this.context=e.context,e.context.memorySize+=a,this._ownerName=e.owner,this.context.memoryAnalyzer.allocateGPUMemory(Me.Geometry,e.owner,a)}Object.defineProperties(le.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}});le.prototype._getBuffer=function(){return this._buffer};le.prototype.copyFromArrayView=function(e,n){n=V(n,0),K.defined("arrayView",e),K.typeOf.number.lessThanOrEquals("offsetInBytes + arrayView.byteLength",n+e.byteLength,this._sizeInBytes);var r=this._gl,i=this._bufferTarget;r.bindBuffer(i,this._buffer),r.bufferSubData(i,n,e),r.bindBuffer(i,null)};le.prototype.copyFromBuffer=function(e,n,r,i){if(!this._webgl2)throw new P("A WebGL 2 context is required.");if(!N(e))throw new P("readBuffer must be defined.");if(!N(i)||i<=0)throw new P("sizeInBytes must be defined and be greater than zero.");if(!N(n)||n<0||n+i>e.sizeInBytes)throw new P("readOffset must be greater than or equal to zero and readOffset + sizeInBytes must be less than of equal to readBuffer.sizeInBytes.");if(!N(r)||r<0||r+i>this._sizeInBytes)throw new P("writeOffset must be greater than or equal to zero and writeOffset + sizeInBytes must be less than of equal to this.sizeInBytes.");if(this._buffer===e.buffer&&(r>=n&&r<n+i||n>r&&n<r+i))throw new P("When readBuffer is equal to this, the ranges [readOffset + sizeInBytes) and [writeOffset, writeOffset + sizeInBytes) must not overlap.");if(this._bufferTarget===C.ELEMENT_ARRAY_BUFFER&&e.bufferTarget!==C.ELEMENT_ARRAY_BUFFER||this._bufferTarget!==C.ELEMENT_ARRAY_BUFFER&&e.bufferTarget===C.ELEMENT_ARRAY_BUFFER)throw new P("Can not copy an index buffer into another buffer type.");var a=C.COPY_READ_BUFFER,E=C.COPY_WRITE_BUFFER,t=this._gl;t.bindBuffer(E,this._buffer),t.bindBuffer(a,e.buffer),t.copyBufferSubData(a,E,n,r,i),t.bindBuffer(E,null),t.bindBuffer(a,null)};le.prototype.getBufferData=function(e,n,r,i){if(n=V(n,0),r=V(r,0),!this._webgl2)throw new P("A WebGL 2 context is required.");if(!N(e))throw new P("arrayView is required.");var a,E,t=e.byteLength;if(N(i)?(a=i,N(t)?E=1:(t=e.length,E=e.BYTES_PER_ELEMENT)):N(t)?(a=t-r,E=1):(t=e.length,a=t-r,E=e.BYTES_PER_ELEMENT),r<0||r>t)throw new P("destinationOffset must be greater than zero and less than the arrayView length.");if(r+a>t)throw new P("destinationOffset + length must be less than or equal to the arrayViewLength.");if(n<0||n>this._sizeInBytes)throw new P("sourceOffset must be greater than zero and less than the buffers size.");if(n+a*E>this._sizeInBytes)throw new P("sourceOffset + length must be less than the buffers size.");var s=this._gl,x=C.COPY_READ_BUFFER;s.bindBuffer(x,this._buffer),s.getBufferSubData(x,n,e,r,i),s.bindBuffer(x,null)};le.prototype.isDestroyed=function(){return!1};le.prototype.destroy=function(){return!this.context._contextWasLost&&this._gl.deleteBuffer(this._buffer),this.context.memorySize-=this.sizeInBytes,this.context.memoryAnalyzer.releaseGPUMemory(Me.Geometry,this._ownerName,this.sizeInBytes),ce(this)};var Ft=le;var ur=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),yt=ur(void 0,function(){return yt.toString().search("(((.+)+)+)+$").toString().constructor(yt).search("(((.+)+)+)+$")});yt();function o(){}o.ALPHA_DISABLE=0,o.ALPHA_ADD=1,o.ALPHA_COMBINE=2,o.ALPHA_SUBTRACT=3,o.ALPHA_MULTIPLY=4,o.ALPHA_MAXIMIZED=5,o.ALPHA_ONEONE=6,o.ALPHA_PREMULTIPLIED=7,o.ALPHA_PREMULTIPLIED_PORTERDUFF=8,o.ALPHA_INTERPOLATE=9,o.ALPHA_SCREENMODE=10,o.ALPHA_ONEONE_ONEONE=11,o.ALPHA_ALPHATOCOLOR=12,o.ALPHA_REVERSEONEMINUS=13,o.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,o.ALPHA_ONEONE_ONEZERO=15,o.ALPHA_EXCLUSION=16,o.ALPHA_LAYER_ACCUMULATE=17,o.ALPHA_EQUATION_ADD=0,o.ALPHA_EQUATION_SUBSTRACT=1,o.ALPHA_EQUATION_REVERSE_SUBTRACT=2,o.ALPHA_EQUATION_MAX=3,o.ALPHA_EQUATION_MIN=4,o.ALPHA_EQUATION_DARKEN=5,o.DELAYLOADSTATE_NONE=0,o.DELAYLOADSTATE_LOADED=1,o.DELAYLOADSTATE_LOADING=2,o.DELAYLOADSTATE_NOTLOADED=4,o.NEVER=512,o.ALWAYS=519,o.LESS=513,o.EQUAL=514,o.LEQUAL=515,o.GREATER=516,o.GEQUAL=518,o.NOTEQUAL=517,o.KEEP=7680,o.ZERO=0,o.REPLACE=7681,o.INCR=7682,o.DECR=7683,o.INVERT=5386,o.INCR_WRAP=34055,o.DECR_WRAP=34056,o.FRONT=0,o.BACK=1,o.TEXTURE_CLAMP_ADDRESSMODE=0,o.TEXTURE_WRAP_ADDRESSMODE=1,o.TEXTURE_MIRROR_ADDRESSMODE=2,o.TEXTURE_CREATIONFLAG_STORAGE=1,o.TEXTUREFORMAT_ALPHA=0,o.TEXTUREFORMAT_LUMINANCE=1,o.TEXTUREFORMAT_LUMINANCE_ALPHA=2,o.TEXTUREFORMAT_RGB=4,o.TEXTUREFORMAT_RGBA=5,o.TEXTUREFORMAT_RED=6,o.TEXTUREFORMAT_R=6,o.TEXTUREFORMAT_RG=7,o.TEXTUREFORMAT_RED_INTEGER=8,o.TEXTUREFORMAT_R_INTEGER=8,o.TEXTUREFORMAT_RG_INTEGER=9,o.TEXTUREFORMAT_RGB_INTEGER=10,o.TEXTUREFORMAT_RGBA_INTEGER=11,o.TEXTUREFORMAT_BGRA=12,o.TEXTUREFORMAT_DEPTH24_STENCIL8=13,o.TEXTUREFORMAT_DEPTH32_FLOAT=14,o.TEXTUREFORMAT_DEPTH16=15,o.TEXTUREFORMAT_DEPTH24=16,o.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,o.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,o.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,o.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,o.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,o.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,o.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,o.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,o.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,o.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,o.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,o.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,o.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,o.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,o.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,o.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,o.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,o.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,o.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,o.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,o.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,o.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,o.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,o.TEXTURETYPE_UNSIGNED_BYTE=0,o.TEXTURETYPE_UNSIGNED_INT=0,o.TEXTURETYPE_FLOAT=1,o.TEXTURETYPE_HALF_FLOAT=2,o.TEXTURETYPE_BYTE=3,o.TEXTURETYPE_SHORT=4,o.TEXTURETYPE_UNSIGNED_SHORT=5,o.TEXTURETYPE_INT=6,o.TEXTURETYPE_UNSIGNED_INTEGER=7,o.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,o.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,o.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,o.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,o.TEXTURETYPE_UNSIGNED_INT_24_8=12,o.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,o.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,o.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,o.TEXTURETYPE_UNDEFINED=16,o.TEXTURE_NEAREST_SAMPLINGMODE=1,o.TEXTURE_NEAREST_NEAREST=1,o.TEXTURE_BILINEAR_SAMPLINGMODE=2,o.TEXTURE_LINEAR_LINEAR=2,o.TEXTURE_TRILINEAR_SAMPLINGMODE=3,o.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,o.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,o.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,o.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,o.TEXTURE_NEAREST_LINEAR=7,o.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,o.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,o.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,o.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,o.TEXTURE_LINEAR_NEAREST=12,o.TEXTURE_EXPLICIT_MODE=0,o.TEXTURE_SPHERICAL_MODE=1,o.TEXTURE_PLANAR_MODE=2,o.TEXTURE_CUBIC_MODE=3,o.TEXTURE_PROJECTION_MODE=4,o.TEXTURE_SKYBOX_MODE=5,o.TEXTURE_INVCUBIC_MODE=6,o.TEXTURE_EQUIRECTANGULAR_MODE=7,o.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,o.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,o.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,o.TEXTURE_FILTERING_QUALITY_HIGH=64,o.TEXTURE_FILTERING_QUALITY_MEDIUM=16,o.TEXTURE_FILTERING_QUALITY_LOW=8,o.SCALEMODE_FLOOR=1,o.SCALEMODE_NEAREST=2,o.SCALEMODE_CEILING=3,o.MATERIAL_TextureDirtyFlag=1,o.MATERIAL_LightDirtyFlag=2,o.MATERIAL_FresnelDirtyFlag=4,o.MATERIAL_AttributesDirtyFlag=8,o.MATERIAL_MiscDirtyFlag=16,o.MATERIAL_PrePassDirtyFlag=32,o.MATERIAL_AllDirtyFlag=63,o.MATERIAL_TriangleFillMode=0,o.MATERIAL_WireFrameFillMode=1,o.MATERIAL_PointFillMode=2,o.MATERIAL_PointListDrawMode=3,o.MATERIAL_LineListDrawMode=4,o.MATERIAL_LineLoopDrawMode=5,o.MATERIAL_LineStripDrawMode=6,o.MATERIAL_TriangleStripDrawMode=7,o.MATERIAL_TriangleFanDrawMode=8,o.MATERIAL_ClockWiseSideOrientation=0,o.MATERIAL_CounterClockWiseSideOrientation=1,o.ACTION_NothingTrigger=0,o.ACTION_OnPickTrigger=1,o.ACTION_OnLeftPickTrigger=2,o.ACTION_OnRightPickTrigger=3,o.ACTION_OnCenterPickTrigger=4,o.ACTION_OnPickDownTrigger=5,o.ACTION_OnDoublePickTrigger=6,o.ACTION_OnPickUpTrigger=7,o.ACTION_OnPickOutTrigger=16,o.ACTION_OnLongPressTrigger=8,o.ACTION_OnPointerOverTrigger=9,o.ACTION_OnPointerOutTrigger=10,o.ACTION_OnEveryFrameTrigger=11,o.ACTION_OnIntersectionEnterTrigger=12,o.ACTION_OnIntersectionExitTrigger=13,o.ACTION_OnKeyDownTrigger=14,o.ACTION_OnKeyUpTrigger=15,o.PARTICLES_BILLBOARDMODE_Y=2,o.PARTICLES_BILLBOARDMODE_ALL=7,o.PARTICLES_BILLBOARDMODE_STRETCHED=8,o.MESHES_CULLINGSTRATEGY_STANDARD=0,o.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,o.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,o.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,o.SCENELOADER_NO_LOGGING=0,o.SCENELOADER_MINIMAL_LOGGING=1,o.SCENELOADER_SUMMARY_LOGGING=2,o.SCENELOADER_DETAILED_LOGGING=3,o.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,o.PREPASS_POSITION_TEXTURE_TYPE=1,o.PREPASS_VELOCITY_TEXTURE_TYPE=2,o.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,o.PREPASS_COLOR_TEXTURE_TYPE=4,o.PREPASS_DEPTH_TEXTURE_TYPE=5,o.PREPASS_NORMAL_TEXTURE_TYPE=6,o.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,o.BUFFER_CREATIONFLAG_READ=1,o.BUFFER_CREATIONFLAG_WRITE=2,o.BUFFER_CREATIONFLAG_READWRITE=3,o.BUFFER_CREATIONFLAG_UNIFORM=4,o.BUFFER_CREATIONFLAG_VERTEX=8,o.BUFFER_CREATIONFLAG_INDEX=16,o.BUFFER_CREATIONFLAG_STORAGE=32,o.RENDERPASS_MAIN=0,o.INPUT_ALT_KEY=18,o.INPUT_CTRL_KEY=17,o.INPUT_META_KEY1=91,o.INPUT_META_KEY2=92,o.INPUT_META_KEY3=93,o.INPUT_SHIFT_KEY=16,o.SNAPSHOTRENDERING_STANDARD=0,o.SNAPSHOTRENDERING_FAST=1,o.PERSPECTIVE_CAMERA=0,o.ORTHOGRAPHIC_CAMERA=1,o.FOVMODE_VERTICAL_FIXED=0,o.FOVMODE_HORIZONTAL_FIXED=1,o.RIG_MODE_NONE=0,o.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,o.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,o.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,o.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,o.RIG_MODE_STEREOSCOPIC_INTERLACED=14,o.RIG_MODE_VR=20,o.RIG_MODE_WEBVR=21,o.RIG_MODE_CUSTOM=22,o.MAX_SUPPORTED_UV_SETS=6,o.GL_ALPHA_EQUATION_ADD=32774,o.GL_ALPHA_EQUATION_MIN=32775,o.GL_ALPHA_EQUATION_MAX=32776,o.GL_ALPHA_EQUATION_SUBTRACT=32778,o.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,o.GL_ALPHA_FUNCTION_SRC=768,o.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,o.GL_ALPHA_FUNCTION_SRC_ALPHA=770,o.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,o.GL_ALPHA_FUNCTION_DST_ALPHA=772,o.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,o.GL_ALPHA_FUNCTION_DST_COLOR=774,o.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,o.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,o.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,o.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,o.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,o.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,o.SnippetUrl="";var me=o;var fr=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),_t=fr(void 0,function(){return _t.toString().search("(((.+)+)+)+$").toString().constructor(_t).search("(((.+)+)+)+$")});_t();function rt(){this.references=0,this.capacity=0,this.is32Bits=![],this.uniqueId=rt._Counter++}Object.defineProperty(rt.prototype,"underlyingResource",{get:function(){return null},enumerable:![],configurable:!![]}),rt._Counter=0;var Gt=rt;var Tr=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),Rt=Tr(void 0,function(){return Rt.toString().search("(((.+)+)+)+$").toString().constructor(Rt).search("(((.+)+)+)+$")});Rt();function b(e,n,r,i,a,E,t,s){i===void 0&&(i=0),a===void 0&&(a=![]),E===void 0&&(E=![]),t===void 0&&(t=![]),this._isAlreadyOwned=![],e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=r,this._instanced=E,this._divisor=s||1,n instanceof Gt?(this._data=null,this._buffer=n):(this._data=n,this._buffer=null),this.byteStride=t?i:i*Float32Array.BYTES_PER_ELEMENT,!a&&this.create()}b.prototype.createVertexBuffer=function(e,n,r,i,a,E,t){E===void 0&&(E=![]);var s=E?n:n*Float32Array.BYTES_PER_ELEMENT,x=i?E?i:i*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new _(this._engine,this,e,this._updatable,!![],x,a===void 0?this._instanced:a,s,r,void 0,void 0,!![],this._divisor||t)},b.prototype.isUpdatable=function(){return this._updatable},b.prototype.getData=function(){return this._data},b.prototype.getBuffer=function(){return this._buffer},b.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},b.prototype.create=function(e){e===void 0&&(e=null),!(!e&&this._buffer)&&(e=e||this._data,e&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e)))},b.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},b.prototype.update=function(e){this.create(e)},b.prototype.updateDirectly=function(e,n,r,i){i===void 0&&(i=![]),!!this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,i?n:n*Float32Array.BYTES_PER_ELEMENT,r?r*this.byteStride:void 0),n===0&&r===void 0?this._data=e:this._data=null)},b.prototype._increaseReferences=function(){if(!!this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!![];return}this._buffer.references++}},b.prototype.dispose=function(){!this._buffer||this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)};function _(e,n,r,i,a,E,t,s,x,u,T,f,A,y){if(T===void 0&&(T=![]),f===void 0&&(f=![]),A===void 0&&(A=1),y===void 0&&(y=![]),n instanceof b?(this._buffer=n,this._ownsBuffer=y):(this._buffer=new b(e,n,i,E,a,t,f),this._ownsBuffer=!![]),this.uniqueId=_._Counter++,this._kind=r,u==null){var p=this.getData();this.type=_.FLOAT,p instanceof Int8Array?this.type=_.BYTE:p instanceof Uint8Array?this.type=_.UNSIGNED_BYTE:p instanceof Int16Array?this.type=_.SHORT:p instanceof Uint16Array?this.type=_.UNSIGNED_SHORT:p instanceof Int32Array?this.type=_.INT:p instanceof Uint32Array&&(this.type=_.UNSIGNED_INT)}else this.type=u;var l=_.GetTypeByteLength(this.type);f?(this._size=x||(E?E/l:_.DeduceStride(r)),this.byteStride=E||this._buffer.byteStride||this._size*l,this.byteOffset=s||0):(this._size=x||E||_.DeduceStride(r),this.byteStride=E?E*l:this._buffer.byteStride||this._size*l,this.byteOffset=(s||0)*l),this.normalized=T,this._instanced=t!==void 0?t:![],this._instanceDivisor=t?A:0,this._computeHashCode()}Object.defineProperty(_.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,e==0?this._instanced=![]:this._instanced=!![],this._computeHashCode()},enumerable:![],configurable:!![]}),_.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},_.prototype._rebuild=function(){!this._buffer||this._buffer._rebuild()},_.prototype.getKind=function(){return this._kind},_.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},_.prototype.getData=function(){return this._buffer.getData()},_.prototype.getFloatData=function(e,n){var r=this.getData();if(!r)return null;var i=this.getSize()*_.GetTypeByteLength(this.type),a=e*this.getSize();if(this.type!==_.FLOAT||this.byteStride!==i){var E=new Float32Array(a);return this.forEach(a,function(T,f){return E[f]=T}),E}if(!(r instanceof Array||r instanceof Float32Array)||this.byteOffset!==0||r.length!==a)if(r instanceof Array){var t=this.byteOffset/4;return r.slice(t,t+a)}else{if(r instanceof ArrayBuffer)return new Float32Array(r,this.byteOffset,a);var t=r.byteOffset+this.byteOffset;if(n){var s=new Float32Array(a),x=new Float32Array(r.buffer,t,a);return s.set(x),s}var u=t%4;return u&&(t=Math.max(0,t-u)),new Float32Array(r.buffer,t,a)}return n?r.slice():r},_.prototype.getBuffer=function(){return this._buffer.getBuffer()},_.prototype.getStrideSize=function(){return this.byteStride/_.GetTypeByteLength(this.type)},_.prototype.getOffset=function(){return this.byteOffset/_.GetTypeByteLength(this.type)},_.prototype.getSize=function(e){return e===void 0&&(e=![]),e?this._size*_.GetTypeByteLength(this.type):this._size},_.prototype.getIsInstanced=function(){return this._instanced},_.prototype.getInstanceDivisor=function(){return this._instanceDivisor},_.prototype.create=function(e){this._buffer.create(e)},_.prototype.update=function(e){this._buffer.update(e)},_.prototype.updateDirectly=function(e,n,r){r===void 0&&(r=![]),this._buffer.updateDirectly(e,n,void 0,r)},_.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},_.prototype.forEach=function(e,n){_.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,n)},_.DeduceStride=function(e){switch(e){case _.UVKind:case _.UV2Kind:case _.UV3Kind:case _.UV4Kind:case _.UV5Kind:case _.UV6Kind:return 2;case _.NormalKind:case _.PositionKind:return 3;case _.ColorKind:case _.MatricesIndicesKind:case _.MatricesIndicesExtraKind:case _.MatricesWeightsKind:case _.MatricesWeightsExtraKind:case _.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}},_.GetTypeByteLength=function(e){switch(e){case _.BYTE:case _.UNSIGNED_BYTE:return 1;case _.SHORT:case _.UNSIGNED_SHORT:return 2;case _.INT:case _.UNSIGNED_INT:case _.FLOAT:return 4;default:throw new Error("Invalid type '".concat(e,"'"))}},_.ForEach=function(e,n,r,i,a,E,t,s){if(e instanceof Array)for(var x=n/4,u=r/4,T=0;T<E;T+=i){for(var f=0;f<i;f++)s(e[x+f],T+f);x+=u}else for(var A=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),y=_.GetTypeByteLength(a),T=0;T<E;T+=i){for(var p=n,f=0;f<i;f++){var l=_._GetFloatValue(A,a,p,t);s(l,T+f),p+=y}n+=r}},_._GetFloatValue=function(e,n,r,i){switch(n){case _.BYTE:{var a=e.getInt8(r);return i&&(a=Math.max(a/127,-1)),a}case _.UNSIGNED_BYTE:{var a=e.getUint8(r);return i&&(a=a/255),a}case _.SHORT:{var a=e.getInt16(r,!![]);return i&&(a=Math.max(a/32767,-1)),a}case _.UNSIGNED_SHORT:{var a=e.getUint16(r,!![]);return i&&(a=a/65535),a}case _.INT:return e.getInt32(r,!![]);case _.UNSIGNED_INT:return e.getUint32(r,!![]);case _.FLOAT:return e.getFloat32(r,!![]);default:throw new Error("Invalid component type ".concat(n))}},_._Counter=0,_.BYTE=5120,_.UNSIGNED_BYTE=5121,_.SHORT=5122,_.UNSIGNED_SHORT=5123,_.INT=5124,_.UNSIGNED_INT=5125,_.FLOAT=5126,_.PositionKind="position",_.NormalKind="normal",_.TangentKind="tangent",_.UVKind="uv",_.UV2Kind="uv2",_.UV3Kind="uv3",_.UV4Kind="uv4",_.UV5Kind="uv5",_.UV6Kind="uv6",_.ColorKind="color",_.ColorInstanceKind="instanceColor",_.MatricesIndicesKind="matricesIndices",_.MatricesWeightsKind="matricesWeights",_.MatricesIndicesExtraKind="matricesIndicesExtra",_.MatricesWeightsExtraKind="matricesWeightsExtra";var Ar=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),pt=Ar(void 0,function(){return pt.toString().search("(((.+)+)+)+$").toString().constructor(pt).search("(((.+)+)+)+$")});pt();function de(e,n,r){r===void 0&&(r=me.BUFFER_CREATIONFLAG_READWRITE),this._engine=e,this._engine._storageBuffers.push(this),this._create(n,r)}de.prototype._create=function(e,n){this._bufferSize=e,this._creationFlags=n,this._buffer=this._engine.createStorageBuffer(e,n)},de.prototype._rebuild=function(){this._create(this._bufferSize,this._creationFlags)},de.prototype.getBuffer=function(){return this._buffer},de.prototype.update=function(e,n,r){!this._buffer||this._engine.updateStorageBuffer(this._buffer,e,n,r)},de.prototype.read=function(e,n,r){return this._engine.readFromStorageBuffer(this._buffer,e,n,r)},de.prototype.dispose=function(){var e=this._engine._storageBuffers,n=e.indexOf(this);n!==-1&&(e[n]=e[e.length-1],e.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null};var wt=de;function he(e){e=V(e,V.EMPTY_OBJECT);var n=e.context,r=e.bufferTarget,i=e.typedArray,a=e.sizeInBytes,E=e.usage,t=N(i);t?a=i.byteLength:i=new Uint8Array(a);var s=me.BUFFER_CREATIONFLAG_STORAGE;N(E)&&(E==ye.STREAM_DRAW?s|=me.BUFFER_CREATIONFLAG_WRITE:E==ye.STATIC_DRAW?s|=me.BUFFER_CREATIONFLAG_WRITE:E==ye.DYNAMIC_DRAW&&(s|=me.BUFFER_CREATIONFLAG_READWRITE)),N(r)?r==C.ELEMENT_ARRAY_BUFFER?(i instanceof Uint8Array&&(e.indexDatatype==Ne.UNSIGNED_INT?i=new Uint32Array(i.buffer,i.byteOffset,i.byteLength/4):e.indexDatatype==Ne.UNSIGNED_SHORT&&(i=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2))),this._dataBuffer=n.engine.createIndexBuffer(i)):r==C.ARRAY_BUFFER?(this._dataBuffer=new b(n.engine,i,!0),this._dataBuffer._data=null):console.log("BufferGPU not supported bufferTarget"):(this._dataBuffer=new wt(n.engine,a,s),t&&this._dataBuffer.update(i,0,a)),this._bufferTarget=r,this._sizeInBytes=a,this._usage=E,this.context=e.context,e.context.memorySize+=a,this._ownerName=e.owner,this.context.memoryAnalyzer.allocateGPUMemory(Me.Geometry,e.owner,a)}Object.defineProperties(he.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}},dataBuffer:{get:function(){return this._dataBuffer}}});he.prototype._getBuffer=function(){return console.log("BufferGPU.prototype._getBuffer"),this._dataBuffer};he.prototype.copyFromArrayView=function(e,n){this._bufferTarget===C.ELEMENT_ARRAY_BUFFER?this.context.engine.updateDynamicIndexBuffer(this._dataBuffer,e):this._dataBuffer.updateDirectly(e,n,null,!0)};he.prototype.copyFromBuffer=function(e,n,r,i){console.log("BufferGPU.prototype.copyFromBuffer")};he.prototype.getBufferData=function(e,n,r,i){console.log("BufferGPU.prototype.getBufferData")};he.prototype.isDestroyed=function(){return!1};he.prototype.destroy=function(){return this._bufferTarget!==C.ELEMENT_ARRAY_BUFFER?this._dataBuffer.dispose():this.context._engine._releaseBuffer(this._dataBuffer),this.context.memorySize-=this.sizeInBytes,this.context.memoryAnalyzer.releaseGPUMemory(Me.Geometry,this._ownerName,this.sizeInBytes),ce(this)};var zt=he;function xr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Math.random()*16|0,r=e==="x"?n:n&3|8;return r.toString(16)})}var Yt=xr;function J(e){if(e=V(e,V.EMPTY_OBJECT),K.defined("options.context",e.context),!N(e.typedArray)&&!N(e.sizeInBytes))throw new P("Either options.sizeInBytes or options.typedArray is required.");if(N(e.typedArray)&&N(e.sizeInBytes))throw new P("Cannot pass in both options.sizeInBytes and options.typedArray.");N(e.typedArray)&&(K.typeOf.object("options.typedArray",e.typedArray),K.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),this._id=Yt(),e.context.webgpu?this._inner=new zt(e):this._inner=new Ft(e),this.vertexArrayDestroyable=!0}J.createVertexBuffer=function(e){return K.defined("options.context",e.context),new J({context:e.context,bufferTarget:C.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,owner:e.owner})};J.createIndexBuffer=function(e){if(K.defined("options.context",e.context),!Ne.validate(e.indexDatatype))throw new P("Invalid indexDatatype.");if(e.indexDatatype===Ne.UNSIGNED_INT&&!e.context.elementIndexUint)throw new P("IndexDatatype.UNSIGNED_INT requires OES_element_index_uint, which is not supported on this system.  Check context.elementIndexUint.");var n=e.context,r=e.indexDatatype,i=Ne.getSizeInBytes(r),a=new J({context:n,bufferTarget:C.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,indexDatatype:r,owner:e.owner}),E=a.sizeInBytes/i;return Object.defineProperties(a,{indexDatatype:{get:function(){return r}},bytesPerIndex:{get:function(){return i}},numberOfIndices:{get:function(){return E}}}),a};Object.defineProperties(J.prototype,{sizeInBytes:{get:function(){return this._inner.sizeInBytes}},usage:{get:function(){return this._inner.usage}},bufferTarget:{get:function(){return this._inner._bufferTarget}},buffer:{get:function(){return this._inner._buffer}}});J.prototype._getBuffer=function(){return this._inner._getBuffer()};J.prototype.copyFromArrayView=function(e,n){this._inner.copyFromArrayView(e,n)};J.prototype.copyFromBuffer=function(e,n,r,i){this._inner.copyFromBuffer(e,n,r,i)};J.prototype.getBufferData=function(e,n,r,i){this._inner.getBufferData(e,n,r,i)};J.prototype.isDestroyed=function(){return!1};J.prototype.destroy=function(){return this._inner.destroy(),ce(this)};var ct=J;var yr=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),lt=yr(void 0,function(){return lt.toString().search("(((.+)+)+)+$").toString().constructor(lt).search("(((.+)+)+)+$")});lt();function ht(){}ht.computeNeighbors=function(e,n){for(var r=e.length/3,i=new Uint32Array(n+1),a=new Uint32Array(n+1),E=function(S,h){S<h?i[S+1]++:a[h+1]++},t=0;t<r;t++){var s=e[3*t],x=e[3*t+1],u=e[3*t+2];E(s,x),E(x,u),E(u,s)}for(t=x=s=0;t<n;t++)u=i[t+1],E=a[t+1],i[t+1]=s,a[t+1]=x,s+=u,x+=E;for(var T=new Uint32Array(6*r),f=i[n],E=function(L,d,U){if(L<d){var m=i[L+1]++;T[2*m]=d,T[2*m+1]=U}else m=a[d+1]++,T[2*f+2*m]=L,T[2*f+2*m+1]=U},t=0;t<r;t++)s=e[3*t],x=e[3*t+1],u=e[3*t+2],E(s,x,t),E(x,u,t),E(u,s,t);for(s=function(S,h){var L=2*S;for(S=h-S,h=1;h<S;h++){var d=T[L+2*h],U=T[L+2*h+1],m=h-1;for(m;0<=m&&T[L+2*m]>d;m--)T[L+2*m+2]=T[L+2*m],T[L+2*m+3]=T[L+2*m+1];T[L+2*m+2]=d,T[L+2*m+3]=U}},t=0;t<n;t++)s(i[t],i[t+1]),s(f+a[t],f+a[t+1]);for(var A=new Int32Array(3*r),y=function(d,U){return d===e[3*U]?0:d===e[3*U+1]?1:d===e[3*U+2]?2:-1},r=function(d,U){d=y(d,U),A[3*U+d]=-1},s=function(d,U,m,D){d=y(d,U),A[3*U+d]=D,m=y(m,D),A[3*D+m]=U},t=0;t<n;t++){for(var x=i[t],u=i[t+1],E=a[t],p=a[t+1];x<u&&E<p;){var l=T[2*x],v=T[2*f+2*E];l===v?(s(t,T[2*x+1],v,T[2*f+2*E+1]),x++,E++):l<v?(r(t,T[2*x+1]),x++):(r(v,T[2*f+2*E+1]),E++)}for(;x<u;)r(t,T[2*x+1]),x++;for(;E<p;)v=T[2*f+2*E],r(v,T[2*f+2*E+1]),E++}return A};function _r(e){--e;for(var n=1;32>n;n<<=1)e|=e>>n;return e+1}var _e=null;ht.deduplicate=function(e,n,r,i,a){r===void 0&&(r=0),i===void 0&&(i=0),a===void 0&&(a=e.byteLength/(4*n)),e=new Uint32Array(e,i,a*n),i=new Uint32Array(a);var E=Math.floor(1.1*a)+1;(_e==null||_e.length<2*E)&&(_e=new Uint32Array(_r(2*E)));for(var t=0;t<2*E;t++)_e[t]=0;for(var s=0,x=r!==0?Math.ceil(7.84*1.96/(r*r)*r*(1-r)):a,t=0;t<a;t++){if(t===x){var u=1-s/t;if(u+1.96*Math.sqrt(u*(1-u)/t)<r)return null;x*=2}for(var u=t*n,T,f=T=0;f<n;f++)T=e[u+f]+T|0,T=T+(T<<11)+(T>>>2)|0;T>>>=0;for(var f=T%E,A=s;_e[2*f+1]!==0;){if(_e[2*f]===T){var y=_e[2*f+1]-1,p=y*n;e:{for(var l=0;l<n;l++)if(e[u+l]!==e[p+l]){p=!1;break e}p=!0}if(p){A=i[y];break}}f++,f>=E&&(f-=E)}A===s&&(_e[2*f]=T,_e[2*f+1]=t+1,s++),i[t]=A}if(r!==0&&1-s/a<r)return null;for(r=new Uint32Array(n*s),t=s=0;t<a;t++)if(i[t]===s){for(E=e,x=t*n,u=r,T=s*n,f=n,A=0;A<f;A++)u[T+A]=E[x+A];s++}return{buffer:r.buffer,indices:i,uniqueCount:s}};var nt=ht;function Ht(){}function Rr(e){return Math.acos(1<e?1:-1>e?-1:e)}function Vt(e){var n=function(){var i=!![];return function(a,E){var t=i?function(){if(E){var s=E.apply(a,arguments);return E=null,s}}:function(){};return i=![],t}}(),r=n(this,function(){return r.toString().search("(((.+)+)+)+$").toString().constructor(r).search("(((.+)+)+)+$")});return r(),e*Math.PI/180}var pr=4,cr=35,Wt=Vt(pr),lr=Vt(cr),hr=Math.cos(lr),vr=Math.cos(Wt);function Ir(e,n,r){var i=r.x-n.x,a=r.y-n.y;return n=r.z-n.z,r=i*i+a*a+n*n,r?(r=1/Math.sqrt(r),e.x=i*r,e.y=a*r,e.z=n*r,e):(e.x=0,e.y=0,e.z=0,e)}var Sr={position0:new c,position1:new c,faceNormal0:new c,faceNormal1:new c,cosAngle:0},bt=new c,Xt=new c;function Lr(e,n){var r=Rr(e.cosAngle);Ir(Xt,e.position1,e.position0),c.cross(e.faceNormal0,e.faceNormal1,bt);var i=0<c.dot(bt,Xt)?-1:1;return r*i>n}function Nr(e){var n=e.faces.length/3,r=e.faces,i=e.neighbors,a=0,E=0;for(E=0;E<n;E++){var t=i[3*E+0],s=i[3*E+1],x=i[3*E+2],u=r[3*E+0],T=r[3*E+1],f=r[3*E+2];a=a+(t===-1||u<T?1:0),a=a+(s===-1||T<f?1:0),a=a+(x===-1||f<u?1:0)}var A=new Int32Array(4*a),y=0;for(E=0;E<n;E++){var t=i[3*E+0],s=i[3*E+1],x=i[3*E+2],u=r[3*E+0],T=r[3*E+1],f=r[3*E+2];(t===-1||u<T)&&(A[y++]=u,A[y++]=T,A[y++]=E,A[y++]=t),(s===-1||T<f)&&(A[y++]=T,A[y++]=f,A[y++]=E,A[y++]=s),(x===-1||f<u)&&(A[y++]=f,A[y++]=u,A[y++]=E,A[y++]=x)}return A}var oe=new c,Ce=new c,Fe=new c;function mr(e){var n=e.x*e.x+e.y*e.y+e.z*e.z;n>0&&(n=1/Math.sqrt(n),e.x*=n,e.y*=n,e.z*=n)}function dr(e){for(var n=e.faces.length/3,r=e.vertices,i=e.dim,a=e.faces,E=new Float32Array(3*n),t=0;t<n;t++){var s=a[3*t+0],x=a[3*t+1],u=a[3*t+2];oe.x=r[i*s],oe.y=r[i*s+1],oe.z=r[i*s+2],Ce.x=r[i*x],Ce.y=r[i*x+1],Ce.z=r[i*x+2],Fe.x=r[i*u],Fe.y=r[i*u+1],Fe.z=r[i*u+2],c.subtract(Ce,oe,Ce),c.subtract(Fe,oe,Fe),c.cross(Ce,Fe,oe),mr(oe),E[3*t+0]=oe.x,E[3*t+1]=oe.y,E[3*t+2]=oe.z}return E}function Ur(e,n){n===0&&(n=e,e=0);for(var r=Array(n-e),i=e;i<n;i++)r[i-e]=i;return r}Ht.extractEdges=function(e){var n=e.vertices,r=e.dim,i=Sr,a=i.position0,E=i.position1,t=i.faceNormal0,s=i.faceNormal1,x=dr(e),u=Nr(e),T=u.length/4,f=new Float32Array(9*T),A=0,y=new Float32Array(12*T),p=0,l=0,v=0,S=Ur(0,T),h=new Float32Array(T);h.forEach(function(ve,R,te){var Q=u[4*R+0],re=u[4*R+1];a.x=n[Q*r],a.y=n[Q*r+1],a.z=n[Q*r+2],E.x=n[re*r],E.y=n[re*r+1],E.z=n[re*r+2],te[R]=c.distance(a,E)}),S.sort(function(ve,R){return h[R]-h[ve]});for(var L=[],d=[],U=0;U<T;U++){var m=S[U],D=h[m],k=u[4*m+0],M=u[4*m+1],q=u[4*m+2],X=u[4*m+3],j=X===-1;if(a.x=n[k*r],a.y=n[k*r+1],a.z=n[k*r+2],E.x=n[M*r],E.y=n[M*r+1],E.z=n[M*r+2],j)t.x=x[3*q],t.y=x[3*q+1],t.z=x[3*q+2],s.x=t.x,s.y=t.y,s.z=t.z,i.cosAngle=c.dot(t,s);else if(t.x=x[3*q],t.y=x[3*q+1],t.z=x[3*q+2],s.x=x[3*X],s.y=x[3*X+1],s.z=x[3*X+2],i.cosAngle=c.dot(t,s),i.cosAngle>vr)continue;l+=D,v++,j||i.cosAngle<hr?(f[A++]=i.position0.x,f[A++]=i.position0.y,f[A++]=i.position0.z,f[A++]=i.position1.x,f[A++]=i.position1.y,f[A++]=i.position1.z,f[A++]=i.faceNormal0.x,f[A++]=i.faceNormal0.y,f[A++]=i.faceNormal0.z,L.push(D)):Lr(i,Wt)&&(y[p++]=i.position0.x,y[p++]=i.position0.y,y[p++]=i.position0.z,y[p++]=i.position1.x,y[p++]=i.position1.y,y[p++]=i.position1.z,y[p++]=i.faceNormal0.x,y[p++]=i.faceNormal0.y,y[p++]=i.faceNormal0.z,y[p++]=i.faceNormal1.x,y[p++]=i.faceNormal1.y,y[p++]=i.faceNormal1.z,d.push(D))}f=f.slice(0,A),y=y.slice(0,p);var B=l/v,ge=L.length,Be=d.length;return{regular:{instancesData:f,instanceCount:ge,edgeLength:ge*B},silhouette:{instancesData:y,instanceCount:Be,edgeLength:Be*B},averageEdgeLength:B}};var Kt=Ht;var gr=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),vt=gr(void 0,function(){return vt.toString().search("(((.+)+)+)+$").toString().constructor(vt).search("(((.+)+)+)+$")});vt();var Br={SVC_Vertex:1,SVC_Normal:2,SVC_VertexColor:4,SVC_SecondColor:8,SVC_TexutreCoord:16,SVC_TexutreCoordIsW:32},We=Object.freeze(Br);var Pr=function(){var e=!![];return function(n,r){var i=e?function(){if(r){var a=r.apply(n,arguments);return r=null,a}}:function(){};return e=![],i}}(),It=Pr(void 0,function(){return It.toString().search("(((.+)+)+)+$").toString().constructor(It).search("(((.+)+)+)+$")});It();function Y(e){}Y.RegularInstanceStride=12,Y.SilhouetteInstanceStride=15,Y.createEdgeData=function(e,n,r){if(n.length==0)return null;var i=n[0],a;i.indexType===0?a=new Uint16Array(i.indicesTypedArray.buffer,i.indicesTypedArray.byteOffset,i.indicesTypedArray.byteLength/2):a=new Uint32Array(i.indicesTypedArray.buffer,i.indicesTypedArray.byteOffset,i.indicesTypedArray.byteLength/4);var E=![],t=Y.extractEdgeInformation(e,E,a),s=Kt.extractEdges(t);return N(r)&&(N(s.regular.instancesData)&&r.push(s.regular.instancesData.buffer),N(s.silhouette.instancesData)&&r.push(s.silhouette.instancesData.buffer)),s},Y.createIndexBuffer=function(e,n){return e.createSidenessIndexBuffer()},Y.createRegularEdgeAttributes=function(e,n,r,i){if(!(!N(n.instancesData)||n.instancesData.length==0)){var a={},E=[];n.attributeLocations=a,n.attributes=E;var t=ct.createVertexBuffer({context:e,typedArray:n.instancesData,usage:ye.STATIC_DRAW,owner:i});n.instancesData=null;var s=I.getSizeInBytes(I.FLOAT),x=e.createSidenessVertexBuffer(),u=0;a.aSideness=u++,E.push({name:"aSideness",index:a.aSideness,vertexBuffer:x,componentsPerAttribute:2,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:I.getSizeInBytes(I.FLOAT)*2,normalize:![]});var T=r||Y.RegularInstanceStride,f=0;a.aPosition0=u++,E.push({name:"aPosition0",index:a.aPosition0,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:![],offsetInBytes:s*f,strideInBytes:s*T,instanceDivisor:1}),f+=3,a.aPosition1=u++,E.push({name:"aPosition1",index:a.aPosition1,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:![],offsetInBytes:s*f,strideInBytes:s*T,instanceDivisor:1}),f+=3,a.aNormal=u++,E.push({name:"aNormal",index:a.aNormal,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:s*f,strideInBytes:s*T,instanceDivisor:1}),f+=3,a.batchId=u++,E.push({name:"batchId",index:a.batchId,vertexBuffer:t,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:s*f,strideInBytes:s*T,instanceDivisor:1}),f+=1,a.aVariantStroke=u++,E.push({name:"aVariantStroke",index:a.aVariantStroke,vertexBuffer:t,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:s*f,strideInBytes:s*T,instanceDivisor:1}),f+=1,a.aVariantExtension=u++,E.push({name:"aVariantExtension",index:a.aVariantExtension,vertexBuffer:t,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:s*f,strideInBytes:s*T,instanceDivisor:1}),f+=1}},Y.createSilhouetteEdgeAttributes=function(e,n,r){if(!(!N(n.instancesData)||n.instancesData.length==0)){var i={},a=[];n.attributeLocations=i,n.attributes=a;var E=ct.createVertexBuffer({context:e,typedArray:n.instancesData,usage:ye.STATIC_DRAW,owner:r});n.instancesData=null;var t=I.getSizeInBytes(I.FLOAT),s=0;i.aSideness=s++,a.push({name:"aSideness",index:i.aSideness,vertexBuffer:e.createSidenessVertexBuffer(),componentsPerAttribute:2,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:t*2,normalize:![]});var x=Y.SilhouetteInstanceStride,u=0;i.aPosition0=s++,a.push({name:"aPosition0",index:i.aPosition0,vertexBuffer:E,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=3,i.aPosition1=s++,a.push({name:"aPosition1",index:i.aPosition1,vertexBuffer:E,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=3,i.aNormalA=s++,a.push({name:"aNormalA",index:i.aNormalA,vertexBuffer:E,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=3,i.aNormalB=s++,a.push({name:"aNormalB",index:i.aNormalB,vertexBuffer:E,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=3,i.batchId=s++,a.push({name:"batchId",index:i.batchId,vertexBuffer:E,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=1,i.aVariantStroke=s++,a.push({name:"aVariantStroke",index:i.aVariantStroke,vertexBuffer:E,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=1,i.aVariantExtension=s++,a.push({name:"aVariantExtension",index:i.aVariantExtension,vertexBuffer:E,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:t*u,strideInBytes:t*x,instanceDivisor:1}),u+=1}};function Qt(e,n){for(var r=n.componentsPerAttribute,i=e.vertCompressConstant,a=new c(e.minVerticesValue.x,e.minVerticesValue.y,e.minVerticesValue.z),E=new Uint16Array(n.typedArray.buffer,n.typedArray.byteOffset,n.typedArray.byteLength/2),t=new Float32Array(e.verticesCount*3),s,x,u,T=0;T<e.verticesCount;T++)s=E[r*T]*i+a.x,x=E[r*T+1]*i+a.y,u=E[r*T+2]*i+a.z,t[3*T]=s,t[3*T+1]=x,t[3*T+2]=u;return t}Y.extractEdgeInformation=function(e,n,r){var i=e.attrLocation.aPosition,a=e.vertexAttributes[i],E=N(e.nCompressOptions)&&(e.nCompressOptions&We.SVC_Vertex)===We.SVC_Vertex,t=a.componentsPerAttribute,s;E?(t=3,s=Qt(e,a)):s=new Float32Array(a.typedArray.buffer,a.typedArray.byteOffset,a.typedArray.byteLength/4);var x=s.length/t;if(n&&r){var u=nt.computeNeighbors(r,x);return{faces:r,neighbors:u,vertices:s,dim:t}}var T=a.typedArray.buffer,f;E?f=s.buffer:f=T.slice(a.typedArray.byteOffset,a.typedArray.byteOffset+a.typedArray.byteLength);var A=nt.deduplicate(f,t),y=Y.selectIndexData(A.indices,r),p=nt.computeNeighbors(y,A.uniqueCount),l=new Float32Array(A.buffer);return{faces:y,neighbors:p,vertices:l,dim:t}},Y.selectIndexData=function(e,n){if(n){n=n.slice();for(var r=0;r<n.length;r++)n[r]=e[n[r]];return n}return e};var O=new c,F=new c,Ue=new c,Ge=new c,G=new c,it=new c,Re=new c,kt=new c;Y.createEdgeDataByIndices=function(e,n){var r=e.attrLocation.aPosition,i=e.vertexAttributes[r],a=N(e.nCompressOptions)&&(e.nCompressOptions&We.SVC_Vertex)===We.SVC_Vertex,E=i.componentsPerAttribute,t;a?(E=3,t=Qt(e,i)):t=new Float32Array(i.typedArray.buffer,i.typedArray.byteOffset,i.typedArray.byteLength/4);var s;n.indexType===0?s=new Uint16Array(n.indicesTypedArray.buffer,n.indicesTypedArray.byteOffset,n.indicesTypedArray.byteLength/2):s=new Uint32Array(n.indicesTypedArray.buffer,n.indicesTypedArray.byteOffset,n.indicesTypedArray.byteLength/4);for(var x=[],u=[],T=s.length,f=0,A=0,y=Math.floor(T/4)*4;A<y;A+=4){var p=s[A],l=s[A+1],v=s[A+2],S=s[A+3];if(O.x=t[E*p],O.y=t[E*p+1],O.z=t[E*p+2],F.x=t[E*l],F.y=t[E*l+1],F.z=t[E*l+2],Ue.x=t[E*v],Ue.y=t[E*v+1],Ue.z=t[E*v+2],Ge.x=t[E*S],Ge.y=t[E*S+1],Ge.z=t[E*S+2],!(c.equals(F,Ue)||c.equals(F,Ge)||c.equals(F,O)||c.equals(Ue,O)||c.equals(Ge,O))){if(v===S){if(c.subtract(F,O,G),c.subtract(Ue,O,it),c.cross(G,it,G),c.equals(G,c.ZERO))continue;c.normalize(G,G),x.push(O.x),x.push(O.y),x.push(O.z),x.push(F.x),x.push(F.y),x.push(F.z),x.push(G.x),x.push(G.y),x.push(G.z),x.push(p);var h=qt(O,F),L=h.variantStroke,d=h.variantExtension;x.push(L),x.push(d)}else{if(c.subtract(F,O,G),c.subtract(Ue,O,it),c.cross(G,it,G),c.equals(G,c.ZERO)||(c.normalize(G,G),c.subtract(F,O,Re),c.subtract(Ge,O,kt),c.cross(kt,Re,Re),c.equals(Re,c.ZERO)))continue;c.normalize(Re,Re),u.push(O.x),u.push(O.y),u.push(O.z),u.push(F.x),u.push(F.y),u.push(F.z),u.push(G.x),u.push(G.y),u.push(G.z),u.push(Re.x),u.push(Re.y),u.push(Re.z),u.push(p);var h=qt(O,F),L=h.variantStroke,d=h.variantExtension;u.push(L),u.push(d)}var U=c.distance(O,F);f+=U}}var m=T/4,D=f/m,k=x.length/Y.RegularInstanceStride,M=u.length/Y.SilhouetteInstanceStride;return{regular:{instancesData:new Float32Array(x),instanceCount:k,edgeLength:k*D},silhouette:{instancesData:new Float32Array(u),instanceCount:M,edgeLength:M},averageEdgeLength:D}};function qt(e,n){function r(y,p){var l=new Float32Array(6),v=new Uint32Array(l.buffer),S=new Uint32Array(1);l[0]=y.x,l[1]=y.y,l[2]=y.z,l[3]=p.x,l[4]=p.y,l[5]=p.z,S[0]=5381;for(var h=0;h<v.length;h++)S[0]=31*S[0]+v[h];return S[0]}function i(y,p,l){l-=p;var v=48217*y%2147483647,S=v/2147483647,h=p+S*l;return{seed:v,result:Math.round(h)}}function a(y){var p=48217*y%2147483647,l=p/(2147483647-1);return{seed:p,result:l}}var E=r(e,n);!N(E)&&(E=Math.random()*2147483647);var t=i(E,0,255);E=t.seed;var s=t.result;t=i(E,0,5),E=t.seed;var x=t.result;t=a(E),E=t.seed;var u=t.result;u=-(1-Math.min(u/.7,1))+Math.max(0,u-.7)/(1-.7),u=255*(Math.abs(u)**1.2*(0>u?-1:1)*.5+.5);var T=s,f=x,A=u;return{variantStroke:f,variantExtension:A}}var at=Y;function Dr(e,n,r,i,a,E){this.left=e,this.bottom=n,this.right=r,this.top=i,this.minHeight=a,this.maxHeight=E,this.width=r-e,this.length=i-n,this.height=E-a}var mi=new Ut;function Or(e,n,r,i,a,E,t,s){var x=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var u=0,T={},f=T.vertexAttributes=[],A=T.attrLocation={};T.instanceCount=0,T.instanceMode=0;var y=0,p=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var l=E.getUint16(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var v=l;l>4&&(v=l>>8,l=l&15);var S=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var h=void 0,L=void 0;if(S>0){var d=E.getUint16(t,!0);d=l*Float32Array.BYTES_PER_ELEMENT,t+=Uint32Array.BYTES_PER_ELEMENT,u=S*d;var U=a.subarray(t,t+u);if(i||r){var m=new c,D=new c,k=new Float32Array(U.buffer,U.byteOffset,U.byteLength/4),M=new Xe;h=new Xe,L=new Xe;for(var q=4,X=new Float32Array(S*q),j=new Float64Array(S*2),B=0;B<S;B++)mt.multiplyByPoint(n,c.fromElements(k[4*B],k[4*B+1],k[4*B+2],m),D),M=Xe.fromCartesian(D),j[2*B]=M.longitude,j[2*B+1]=M.latitude,B===0?(h.longitude=M.longitude,h.latitude=M.latitude,L.longitude=M.longitude,L.latitude=M.latitude):(h.longitude=Math.max(M.longitude,h.longitude),h.latitude=Math.max(M.latitude,h.latitude),L.longitude=Math.min(M.longitude,L.longitude),L.latitude=Math.min(M.latitude,L.latitude));for(var ge=r?h.longitude-L.longitude:1,Be=r?h.latitude-L.latitude:1,B=0;B<S;B++)X[4*B]=j[2*B]-L.longitude,X[4*B+1]=j[2*B+1]-L.latitude,X[4*B+2]=(j[2*B]-L.longitude)/ge,X[4*B+3]=(j[2*B+1]-L.latitude)/Be;A.aRelativeGeoCoord=y,f.push({index:A.aRelativeGeoCoord,typedArray:X,componentsPerAttribute:q,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:q*Float32Array.BYTES_PER_ELEMENT,normalize:!1}),y++}A.aPosition=y,f.push({index:A.aPosition,typedArray:U,componentsPerAttribute:l,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:d,normalize:!1}),y++,t+=u}var ve=E.getUint32(t,!0);if(t+=Uint32Array.BYTES_PER_ELEMENT,ve>0){var R=E.getUint16(t,!0);R=v*Float32Array.BYTES_PER_ELEMENT,t+=Uint32Array.BYTES_PER_ELEMENT,u=ve*R;let Le=new Float32Array(a.buffer,t,3),ot=Le[0]===0&&Le[1]===0&&Le[2]===0;!e.ignoreNormal&&!ot&&(A.aNormal=y,f.push({index:A.aNormal,typedArray:a.subarray(t,t+u),componentsPerAttribute:v,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:R,normalize:!1}),y++),t+=u}var te=E.getUint32(t,!0);if(t+=Uint32Array.BYTES_PER_ELEMENT,te>0){var Q=new Uint8Array(4*te);s.push(Q.buffer);var re=E.getUint32(t,!0);re=4*Float32Array.BYTES_PER_ELEMENT,t+=Uint32Array.BYTES_PER_ELEMENT,u=te*re;for(var ee=new Float32Array(a.buffer,t,S*4),W=0;W<S;W++)Q[4*W]=ee[4*W]*255,Q[4*W+1]=ee[4*W+1]*255,Q[4*W+2]=ee[4*W+2]*255,Q[4*W+3]=ee[4*W+3]*255;t+=u,A.aColor=y,f.push({index:A.aColor,typedArray:Q,componentsPerAttribute:4,componentDatatype:I.UNSIGNED_BYTE,offsetInBytes:0,strideInBytes:4,normalize:!0}),y++}var g=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT,g>0&&(u=g*16,t+=u);var we=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;for(var Pe=-1,ne,Ie,$,Ee=0;Ee<we;Ee++){ne=E.getUint32(t,!0),t+=Uint32Array.BYTES_PER_ELEMENT,$=E.getUint16(t,!0),t+=Uint16Array.BYTES_PER_ELEMENT,Ie=E.getUint16(t,!0),t+=Uint16Array.BYTES_PER_ELEMENT,u=ne*$*Float32Array.BYTES_PER_ELEMENT;var z=a.subarray(t,t+u);if(Pe==-1&&($==20||$==35)){Pe=Ee,T.instanceCount=ne,T.instanceMode=$,T.instanceBuffer=z;var se=$*ne,w;$===20?(w=Float32Array.BYTES_PER_ELEMENT*20,A.uv2=y++,f.push({index:A.uv2,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:w,instanceDivisor:1}),A.uv3=y++,f.push({index:A.uv3,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv4=y++,f.push({index:A.uv4,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.secondary_colour=y++,f.push({index:A.secondary_colour,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv6=y++,f.push({index:A.uv6,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1})):$===35&&(w=Float32Array.BYTES_PER_ELEMENT*35,A.uv1=y++,f.push({index:A.uv1,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:w,instanceDivisor:1,byteLength:u}),A.uv2=y++,f.push({index:A.uv2,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv3=y++,f.push({index:A.uv3,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv4=y++,f.push({index:A.uv4,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv5=y++,f.push({index:A.uv5,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv6=y++,f.push({index:A.uv6,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:20*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv7=y++,f.push({index:A.uv7,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:24*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.secondary_colour=y++,f.push({index:A.secondary_colour,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:27*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}),A.uv9=y++,f.push({index:A.uv9,componentsPerAttribute:4,componentDatatype:I.FLOAT,normalize:!1,offsetInBytes:31*Float32Array.BYTES_PER_ELEMENT,strideInBytes:w,instanceDivisor:1}))}else if(Pe!==-1)T.instanceBounds=new Float32Array(a.buffer,t,ne*$);else{var Ke="aTexCoord"+Ee;A[Ke]=y++,f.push({index:A[Ke],typedArray:z,componentsPerAttribute:$,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:$*Float32Array.BYTES_PER_ELEMENT,normalize:!1})}t+=u}T.verticesCount=S,T.instanceIndex=Pe;var Z=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;for(var ue=[],Ee=0;Ee<Z;Ee++){var H={},Se=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var fe=E.getUint8(t,!0);t+=Uint8Array.BYTES_PER_ELEMENT;var Te=E.getUint8(t,!0);t+=Uint8Array.BYTES_PER_ELEMENT;var Ae=E.getUint8(t,!0);t+=Uint8Array.BYTES_PER_ELEMENT,t+=1,H.indicesCount=Se,H.indexType=fe,H.primitiveType=Ae;var ie=t;Se>0&&(fe==0?(u=Se*Uint16Array.BYTES_PER_ELEMENT,t+=u,Se%2==1&&(t+=2)):(u=Se*4,t+=u)),H.indicesTypedArray=a.subarray(ie,ie+u);var ze=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT;var xe=E.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT*ze,H.materialCode=xe,ue.push(H)}var pe;ue.length===2&&ue[1].primitiveType===13&&ue[1].indicesCount>=3&&(pe=at.createEdgeDataByIndices(T,ue[1],s));let ke;return h!==void 0&&L!==void 0&&(ke={max:h,min:L}),e[x]={vertexPackage:T,arrIndexPackage:ue,edgeGeometry:pe,cartographicBounds:ke},t}function $t(e,n,r){var i=e.vertexAttributes,a=e.attrLocation,E=i.length,t=r===1?"instanceId":"batchId";a[t]=E,i.push({index:E,typedArray:n,componentsPerAttribute:1,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:0,instanceDivisor:r})}function Mr(e,n){var r=e.buffer,i=e.supportCompressType,a=e.bVolume,E=null,t=null,s=null,x=e.isCoverImageryLayer,u=e.coveredMap,T=e.modelMatrix;if(a&&e.volbuffer.byteLength<8&&(a=!1),a){var f=e.volbuffer,re=new Uint8Array(f,8),A=Tt.inflate(re).buffer,y=new Float64Array(A,0,1),p=new Uint32Array(A,48,1);if(y[0]===0||p[0]===3200||p[0]===3201){var l=0;y[0]===0&&(l=8),n.push(A);var v=new Float64Array(A,l,6),S=v[0],h=v[1],L=v[2],d=v[3],U=v[4]<v[5]?v[4]:v[5],m=v[4]>v[5]?v[4]:v[5];E=new Dr(S,d,L,h,U,m),t={left:S,top:h,right:L,bottom:d,minHeight:U,maxHeight:m,width:E.width,length:E.length,height:E.height};var D=new Uint32Array(A,48+l,7),k=D[0],M=D[1],q=D[2],X=D[3],j=D[4],B=D[5],ge=D[6],Be=X*X*4,ve=new Uint8Array(A,76+l,Be);s={nFormat:k,nSideBlockCount:M,nBlockLength:q,nLength:X,nWidth:j,nHeight:B,nDepth:ge,imageArray:ve}}}var R=0,te=new Uint8Array(r,0,4);if(te[0]!==115||te[1]!==51||te[2]!==109)return{result:!1};var Q=te[3],re=new Uint8Array(r,4),ee=Tt.inflate(re).buffer,W=new Uint8Array(ee);n.push(W.buffer);var g=new DataView(ee),we=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var Pe=new Uint8Array(ee,R,we),ne=we%4;ne&&(ne=4-ne),R+=we+ne;var Ie=gt(Pe,void 0,void 0,"gbk");Ie=Ie.replace(new RegExp(`\r
`,"gm"),""),Ie=Ie.replace(new RegExp(":","gm"),"");var $=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var Ee=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var z={};z.ignoreNormal=e.ignoreNormal;for(var se=0;se<Ee;se++)R=Or(z,T,u,x,W,g,R,n);var w=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var Ke=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;for(var se=0;se<Ke;se++){var Z=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ue=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var H={},Se=z[Z].vertexPackage.instanceIndex,Qe=z[Z].edgeGeometry;if(Se==-1){for(var fe=new Float32Array(z[Z].vertexPackage.verticesCount),Te=0;Te<ue;Te++){var Ae=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ie=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ze=0,xe=0;H[Ae]={batchId:Te};for(var pe=0;pe<ie;pe++)if(xe=g.getUint32(R,!0),R+=Uint32Array.BYTES_PER_ELEMENT,ze=g.getUint32(R,!0),R+=Uint32Array.BYTES_PER_ELEMENT,fe.fill)fe.fill(Te,xe,xe+ze);else for(var ke=xe+xe,Le=xe;Le<ke;Le++)fe[Le]=Te;H[Ae].vertexColorOffset=xe,H[Ae].vertexColorCount=ze}$t(z[Z].vertexPackage,fe,void 0)}else{for(var ot=z[Z].vertexPackage.instanceCount,Cr=z[Z].vertexPackage.instanceBuffer,Fr=z[Z].vertexPackage.instanceMode,St=new Float32Array(ot),qe=0,Te=0;Te<ue;Te++){var Ae=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ie=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;for(var pe=0;pe<ie;pe++){var Zt=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT,St[qe]=qe,H[Ae]===void 0&&(H[Ae]={vertexColorCount:1,instanceIds:[],vertexColorOffset:qe}),H[Ae].instanceIds.push(Zt),qe++}}$t(z[Z].vertexPackage,St,1)}z[Z].pickInfo=H;var Qe=z[Z].edgeGeometry;if(N(Qe)){var $e=Qe.regular.instancesData,Et=at.RegularInstanceStride,ae,Ze;if(N($e))for(Ze=$e.length,ae=0;ae<Ze;ae+=Et){var st=$e[ae+9];$e[ae+9]=fe[st]}var Je=Qe.silhouette.instancesData;if(Et=at.SilhouetteInstanceStride,N(Je))for(Ze=Je.length,ae=0;ae<Ze;ae+=Et){var st=Je[ae+12];Je[ae+12]=fe[st]}}}var Gr=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var Jt=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;for(var Lt={},se=0;se<Jt;se++){var Nt=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var Ye=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var be=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ut=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var ie=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var je=g.getUint32(R,!0);R+=Uint32Array.BYTES_PER_ELEMENT;var De=null;if(ut===Ct.enrS3TCDXTN&&i!==1){var ft=null;je>Oe.BGR||je===Oe.LUMINANCE_ALPHA?(ft=new Uint8Array(ee,R,Ye*be),De=new Uint8Array(Ye*be*4)):(ft=new Uint16Array(ee,R,ie/2),De=new Uint16Array(Ye*be)),Mt.decode(De,Ye,be,ft,je),n.push(De.buffer),ut=0}else De=new Uint8Array(ee,R,ie);Lt[Nt]={id:Nt,width:Ye,height:be,compressType:ut,nFormat:je,imageBuffer:De},R+=ie}return{result:!0,version:Q,xmlDoc:Ie,geoPackage:z,texturePackage:Lt,volImageBuffer:s,volBounds:t}}var di=dt(Mr);export{di as default};
