define(["exports","./AttributeCompression-cd5a3a25","./Cartesian2-54f49cd5","./Cartographic-9ee1f1bd","./Check-737bd4ec","./when-7d8885d2","./Math-4ffce144","./buildModuleUrl-91a0d359","./Cartesian4-6d2e270a","./ComponentDatatype-c2578c27","./EncodedCartesian3-8b0babb6","./Intersect-3d22ecf4","./GeometryAttribute-84124076","./IndexDatatype-6f66284e","./IntersectionTests-aa971a96","./Matrix4-52faaaf8","./Plane-b5076158","./PrimitiveType-3a37fdd9"],(function(e,t,r,a,i,n,s,o,u,p,d,l,v,f,y,c,m,C){"use strict";var h=new a.Cartesian3,b=new a.Cartesian3,g=new a.Cartesian3;var A={calculateACMR:function(e){var t=(e=n.defaultValue(e,n.defaultValue.EMPTY_OBJECT)).indices,r=e.maximumIndex,a=n.defaultValue(e.cacheSize,24),i=t.length;if(!n.defined(r)){r=0;for(var s=0,o=t[s];s<i;)o>r&&(r=o),o=t[++s]}for(var u=[],p=0;p<r+1;p++)u[p]=0;for(var d=a+1,l=0;l<i;++l)d-u[t[l]]>a&&(u[t[l]]=d,++d);return(d-a+1)/(i/3)}};A.tipsify=function(e){var t,r=(e=n.defaultValue(e,n.defaultValue.EMPTY_OBJECT)).indices,a=e.maximumIndex,i=n.defaultValue(e.cacheSize,24);function s(e,r,a,i,n,s,o){for(var u,p=-1,d=-1,l=0;l<a.length;){var v=a[l];i[v].numLiveTriangles&&(u=0,n-i[v].timeStamp+2*i[v].numLiveTriangles<=r&&(u=n-i[v].timeStamp),(u>d||-1===d)&&(d=u,p=v)),++l}return-1===p?function(e,r,a,i){for(;r.length>=1;){var n=r[r.length-1];if(r.splice(r.length-1,1),e[n].numLiveTriangles>0)return n}for(;t<i;){if(e[t].numLiveTriangles>0)return++t-1;++t}return-1}(i,s,0,o):p}var o=r.length,u=0,p=0,d=r[p],l=o;if(n.defined(a))u=a+1;else{for(;p<l;)d>u&&(u=d),d=r[++p];if(-1===u)return 0;++u}var v,f=[];for(v=0;v<u;v++)f[v]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};p=0;for(var y=0;p<l;)f[r[p]].vertexTriangles.push(y),++f[r[p]].numLiveTriangles,f[r[p+1]].vertexTriangles.push(y),++f[r[p+1]].numLiveTriangles,f[r[p+2]].vertexTriangles.push(y),++f[r[p+2]].numLiveTriangles,++y,p+=3;var c=0,m=i+1;t=1;var C,h,b,g,A=[],T=[],x=0,P=[],w=o/3,I=[];for(v=0;v<w;v++)I[v]=!1;for(;-1!==c;){A=[],g=(h=f[c]).vertexTriangles.length;for(var S=0;S<g;++S)if(!I[y=h.vertexTriangles[S]]){I[y]=!0,p=y+y+y;for(var O=0;O<3;++O)b=r[p],A.push(b),T.push(b),P[x]=b,++x,--(C=f[b]).numLiveTriangles,m-C.timeStamp>i&&(C.timeStamp=m,++m),++p}c=s(0,i,A,f,m,T,u)}return P};var T={};function x(e,t,r,a,i){e[t++]=r,e[t++]=a,e[t++]=a,e[t++]=i,e[t++]=i,e[t]=r}function P(e){var t={};for(var r in e)if(e.hasOwnProperty(r)&&n.defined(e[r])&&n.defined(e[r].values)){var a=e[r];t[r]=new v.GeometryAttribute({componentDatatype:a.componentDatatype,componentsPerAttribute:a.componentsPerAttribute,normalize:a.normalize,values:[]})}return t}function w(e,t,r){for(var a in t)if(t.hasOwnProperty(a)&&n.defined(t[a])&&n.defined(t[a].values))for(var i=t[a],s=0;s<i.componentsPerAttribute;++s)e[a].values.push(i.values[r*i.componentsPerAttribute+s])}T.toWireframe=function(e){var t=e.indices;if(n.defined(t)){switch(e.primitiveType){case C.PrimitiveType.TRIANGLES:e.indices=function(e){for(var t=e.length,r=t/3*6,a=f.IndexDatatype.createTypedArray(t,r),i=0,n=0;n<t;n+=3,i+=6)x(a,i,e[n],e[n+1],e[n+2]);return a}(t);break;case C.PrimitiveType.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(t>=3){var r=6*(t-2),a=f.IndexDatatype.createTypedArray(t,r);x(a,0,e[0],e[1],e[2]);for(var i=6,n=3;n<t;++n,i+=6)x(a,i,e[n-1],e[n],e[n-2]);return a}return new Uint16Array}(t);break;case C.PrimitiveType.TRIANGLE_FAN:e.indices=function(e){if(e.length>0){for(var t=e.length-1,r=6*(t-1),a=f.IndexDatatype.createTypedArray(t,r),i=e[0],n=0,s=1;s<t;++s,n+=6)x(a,n,i,e[s],e[s+1]);return a}return new Uint16Array}(t)}e.primitiveType=C.PrimitiveType.LINES}return e},T.createLineSegmentsForVectors=function(e,t,r){t=n.defaultValue(t,"normal"),r=n.defaultValue(r,1e4);for(var a,i=e.attributes.position.values,s=e.attributes[t].values,u=i.length,d=new Float64Array(2*u),l=0,f=0;f<u;f+=3)d[l++]=i[f],d[l++]=i[f+1],d[l++]=i[f+2],d[l++]=i[f]+s[f]*r,d[l++]=i[f+1]+s[f+1]*r,d[l++]=i[f+2]+s[f+2]*r;var y=e.boundingSphere;return n.defined(y)&&(a=new o.BoundingSphere(y.center,y.radius+r)),new v.Geometry({attributes:{position:new v.GeometryAttribute({componentDatatype:p.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},primitiveType:C.PrimitiveType.LINES,boundingSphere:a})},T.createAttributeLocations=function(e){var t,r=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],a=e.attributes,i={},s=0,o=r.length;for(t=0;t<o;++t){var u=r[t];n.defined(a[u])&&(i[u]=s++)}for(var p in a)a.hasOwnProperty(p)&&!n.defined(i[p])&&(i[p]=s++);return i},T.reorderForPreVertexCache=function(e){var t=v.Geometry.computeNumberOfVertices(e),r=e.indices;if(n.defined(r)){for(var a=new Int32Array(t),i=0;i<t;i++)a[i]=-1;for(var s,o=r,u=o.length,d=f.IndexDatatype.createTypedArray(t,u),l=0,y=0,c=0;l<u;)-1!==(s=a[o[l]])?d[y]=s:(a[s=o[l]]=c,d[y]=c,++c),++l,++y;e.indices=d;var m=e.attributes;for(var C in m)if(m.hasOwnProperty(C)&&n.defined(m[C])&&n.defined(m[C].values)){for(var h=m[C],b=h.values,g=0,A=h.componentsPerAttribute,T=p.ComponentDatatype.createTypedArray(h.componentDatatype,c*A);g<t;){var x=a[g];if(-1!==x)for(var P=0;P<A;P++)T[A*x+P]=b[A*g+P];++g}h.values=T}}return e},T.reorderForPostVertexCache=function(e,t){var r=e.indices;if(e.primitiveType===C.PrimitiveType.TRIANGLES&&n.defined(r)){for(var a=r.length,i=0,s=0;s<a;s++)r[s]>i&&(i=r[s]);e.indices=A.tipsify({indices:r,maximumIndex:i,cacheSize:t})}return e},T.fitToUnsignedShortIndices=function(e){var t=[],r=v.Geometry.computeNumberOfVertices(e);if(n.defined(e.indices)&&r>=s.CesiumMath.SIXTY_FOUR_KILOBYTES){var a,i=[],o=[],u=0,p=P(e.attributes),d=e.indices,l=d.length;e.primitiveType===C.PrimitiveType.TRIANGLES?a=3:e.primitiveType===C.PrimitiveType.LINES?a=2:e.primitiveType===C.PrimitiveType.POINTS&&(a=1);for(var f=0;f<l;f+=a){for(var y=0;y<a;++y){var c=d[f+y],m=i[c];n.defined(m)||(m=u++,i[c]=m,w(p,e.attributes,c)),o.push(m)}u+a>=s.CesiumMath.SIXTY_FOUR_KILOBYTES&&(t.push(new v.Geometry({attributes:p,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),i=[],o=[],u=0,p=P(e.attributes))}0!==o.length&&t.push(new v.Geometry({attributes:p,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};var I=new a.Cartesian3,S=new a.Cartographic;T.projectTo2D=function(e,t,r,i,s){for(var o=e.attributes[t],u=(s=n.defined(s)?s:new l.GeographicProjection).ellipsoid,d=o.values,f=new Float64Array(d.length),y=0,c=0;c<d.length;c+=3){var m=a.Cartesian3.fromArray(d,c,I),C=u.cartesianToCartographic(m,S),h=s.project(C,I);f[y++]=h.x,f[y++]=h.y,f[y++]=h.z}return e.attributes[r]=o,e.attributes[i]=new v.GeometryAttribute({componentDatatype:p.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f}),delete e.attributes[t],e};var O={high:0,low:0};T.encodeAttribute=function(e,t,r,a){for(var i=e.attributes[t],n=i.values,s=n.length,o=new Float32Array(s),u=new Float32Array(s),l=0;l<s;++l)d.EncodedCartesian3.encode(n[l],O),o[l]=O.high,u[l]=O.low;var f=i.componentsPerAttribute;return e.attributes[r]=new v.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:f,values:o}),e.attributes[a]=new v.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:f,values:u}),delete e.attributes[t],e};var E=new a.Cartesian3;function N(e,t){if(n.defined(t))for(var r=t.values,i=r.length,s=0;s<i;s+=3)a.Cartesian3.unpack(r,s,E),c.Matrix4.multiplyByPoint(e,E,E),a.Cartesian3.pack(E,r,s)}function L(e,t){if(n.defined(t))for(var r=t.values,i=r.length,s=0;s<i;s+=3)a.Cartesian3.unpack(r,s,E),c.Matrix3.multiplyByVector(e,E,E),E=a.Cartesian3.normalize(E,E),a.Cartesian3.pack(E,r,s)}var z=new c.Matrix4,M=new c.Matrix3;T.transformToWorldCoordinates=function(e){var t=e.modelMatrix;if(c.Matrix4.equals(t,c.Matrix4.IDENTITY))return e;var r=e.geometry.attributes;N(t,r.position),N(t,r.prevPosition),N(t,r.nextPosition),(n.defined(r.normal)||n.defined(r.tangent)||n.defined(r.bitangent))&&(c.Matrix4.inverse(t,z),c.Matrix4.transpose(z,z),c.Matrix4.getRotation(z,M),L(M,r.normal),L(M,r.tangent),L(M,r.bitangent));var a=e.geometry.boundingSphere;return n.defined(a)&&(e.geometry.boundingSphere=o.BoundingSphere.transform(a,t,a)),e.modelMatrix=c.Matrix4.clone(c.Matrix4.IDENTITY),e};var D=new a.Cartesian3;function G(e,t){var r,i,s,u,d=e.length;e[0].modelMatrix;var l,y,c,m,h=n.defined(e[0][t].indices),b=e[0][t].primitiveType,g=function(e,t){var r,a=e.length,i={},s=e[0][t].attributes;for(r in s)if(s.hasOwnProperty(r)&&n.defined(s[r])&&n.defined(s[r].values)){for(var o=s[r],u=o.values.length,d=!0,l=1;l<a;++l){var f=e[l][t].attributes[r];if(!n.defined(f)||o.componentDatatype!==f.componentDatatype||o.componentsPerAttribute!==f.componentsPerAttribute||o.normalize!==f.normalize){d=!1;break}u+=f.values.length}d&&(i[r]=new v.GeometryAttribute({componentDatatype:o.componentDatatype,componentsPerAttribute:o.componentsPerAttribute,normalize:o.normalize,values:p.ComponentDatatype.createTypedArray(o.componentDatatype,u)}),o.isInstanceAttribute&&(i[r].isInstanceAttribute=!0))}return i}(e,t);for(r in g)if(g.hasOwnProperty(r))for(l=g[r].values,u=0,i=0;i<d;++i)for(c=(y=e[i][t].attributes[r].values).length,s=0;s<c;++s)l[u++]=y[s];if(h){var A=0;for(i=0;i<d;++i)A+=e[i][t].indices.length;var T=v.Geometry.computeNumberOfVertices(new v.Geometry({attributes:g,primitiveType:C.PrimitiveType.POINTS})),x=f.IndexDatatype.createTypedArray(T,A),P=0,w=0;for(i=0;i<d;++i){var I=e[i][t].indices,S=I.length;for(u=0;u<S;++u)x[P++]=w+I[u];w+=v.Geometry.computeNumberOfVertices(e[i][t])}m=x}var O,E=new a.Cartesian3,N=0;for(i=0;i<d;++i){if(O=e[i][t].boundingSphere,!n.defined(O)){E=void 0;break}a.Cartesian3.add(O.center,E,E)}if(n.defined(E))for(a.Cartesian3.divideByScalar(E,d,E),i=0;i<d;++i){O=e[i][t].boundingSphere;var L=a.Cartesian3.magnitude(a.Cartesian3.subtract(O.center,E,D))+O.radius;L>N&&(N=L)}return new v.Geometry({attributes:g,indices:m,primitiveType:b,boundingSphere:n.defined(E)?new o.BoundingSphere(E,N):void 0})}T.combineInstances=function(e){for(var t=[],r=[],a=e.length,i=0;i<a;++i){var s=e[i];n.defined(s.geometry)?t.push(s):n.defined(s.westHemisphereGeometry)&&n.defined(s.eastHemisphereGeometry)&&r.push(s)}var o=[];return t.length>0&&o.push(G(t,"geometry")),r.length>0&&(o.push(G(r,"westHemisphereGeometry")),o.push(G(r,"eastHemisphereGeometry"))),o};var R=new a.Cartesian3,V=new a.Cartesian3,F=new a.Cartesian3,B=new a.Cartesian3;T.computeNormal=function(e){var t,r=e.indices,i=e.attributes,n=i.position.values,o=i.position.values.length/3,u=r.length,d=new Array(o),l=new Array(u/3),f=new Array(u);for(t=0;t<o;t++)d[t]={indexOffset:0,count:0,currentCount:0};var y=0;for(t=0;t<u;t+=3){var c=r[t],m=r[t+1],C=r[t+2],h=3*c,b=3*m,g=3*C;V.x=n[h],V.y=n[h+1],V.z=n[h+2],F.x=n[b],F.y=n[b+1],F.z=n[b+2],B.x=n[g],B.y=n[g+1],B.z=n[g+2],d[c].count++,d[m].count++,d[C].count++,a.Cartesian3.subtract(F,V,F),a.Cartesian3.subtract(B,V,B),l[y]=a.Cartesian3.cross(F,B,new a.Cartesian3),y++}var A,T=0;for(t=0;t<o;t++)d[t].indexOffset+=T,T+=d[t].count;for(y=0,t=0;t<u;t+=3){var x=(A=d[r[t]]).indexOffset+A.currentCount;f[x]=y,A.currentCount++,f[x=(A=d[r[t+1]]).indexOffset+A.currentCount]=y,A.currentCount++,f[x=(A=d[r[t+2]]).indexOffset+A.currentCount]=y,A.currentCount++,y++}var P=new Float32Array(3*o);for(t=0;t<o;t++){var w=3*t;if(A=d[t],a.Cartesian3.clone(a.Cartesian3.ZERO,R),A.count>0){for(y=0;y<A.count;y++)a.Cartesian3.add(R,l[f[A.indexOffset+y]],R);a.Cartesian3.equalsEpsilon(a.Cartesian3.ZERO,R,s.CesiumMath.EPSILON10)&&a.Cartesian3.clone(l[f[A.indexOffset]],R)}a.Cartesian3.equalsEpsilon(a.Cartesian3.ZERO,R,s.CesiumMath.EPSILON10)&&(R.z=1),a.Cartesian3.normalize(R,R),P[w]=R.x,P[w+1]=R.y,P[w+2]=R.z}return e.attributes.normal=new v.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P}),e};var k=new a.Cartesian3,_=new a.Cartesian3,U=new a.Cartesian3;T.computeTangentAndBitangent=function(e){e.attributes;var t,r,i,n,s=e.indices,o=e.attributes.position.values,u=e.attributes.normal.values,d=e.attributes.st.values,l=e.attributes.position.values.length/3,f=s.length,y=new Array(3*l);for(t=0;t<y.length;t++)y[t]=0;for(t=0;t<f;t+=3){var c=s[t],m=s[t+1],C=s[t+2];i=3*m,n=3*C;var h=2*c,b=2*m,g=2*C,A=o[r=3*c],T=o[r+1],x=o[r+2],P=d[h],w=d[h+1],I=d[b+1]-w,S=d[g+1]-w,O=1/((d[b]-P)*S-(d[g]-P)*I),E=(S*(o[i]-A)-I*(o[n]-A))*O,N=(S*(o[i+1]-T)-I*(o[n+1]-T))*O,L=(S*(o[i+2]-x)-I*(o[n+2]-x))*O;y[r]+=E,y[r+1]+=N,y[r+2]+=L,y[i]+=E,y[i+1]+=N,y[i+2]+=L,y[n]+=E,y[n+1]+=N,y[n+2]+=L}var z=new Float32Array(3*l),M=new Float32Array(3*l);for(t=0;t<l;t++){i=(r=3*t)+1,n=r+2;var D=a.Cartesian3.fromArray(u,r,k),G=a.Cartesian3.fromArray(y,r,U),R=a.Cartesian3.dot(D,G);a.Cartesian3.multiplyByScalar(D,R,_),a.Cartesian3.normalize(a.Cartesian3.subtract(G,_,G),G),z[r]=G.x,z[i]=G.y,z[n]=G.z,a.Cartesian3.normalize(a.Cartesian3.cross(D,G,G),G),M[r]=G.x,M[i]=G.y,M[n]=G.z}return e.attributes.tangent=new v.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z}),e.attributes.bitangent=new v.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:M}),e};var q=new r.Cartesian2,Y=new a.Cartesian3,Z=new a.Cartesian3,H=new a.Cartesian3,W=new r.Cartesian2;function X(e){switch(e.primitiveType){case C.PrimitiveType.TRIANGLE_FAN:return function(e){var t=v.Geometry.computeNumberOfVertices(e),r=f.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=1,r[1]=0,r[2]=2;for(var a=3,i=3;i<t;++i)r[a++]=i-1,r[a++]=0,r[a++]=i;return e.indices=r,e.primitiveType=C.PrimitiveType.TRIANGLES,e}(e);case C.PrimitiveType.TRIANGLE_STRIP:return function(e){var t=v.Geometry.computeNumberOfVertices(e),r=f.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=0,r[1]=1,r[2]=2,t>3&&(r[3]=0,r[4]=2,r[5]=3);for(var a=6,i=3;i<t-1;i+=2)r[a++]=i,r[a++]=i-1,r[a++]=i+1,i+2<t&&(r[a++]=i,r[a++]=i+1,r[a++]=i+2);return e.indices=r,e.primitiveType=C.PrimitiveType.TRIANGLES,e}(e);case C.PrimitiveType.TRIANGLES:return function(e){if(n.defined(e.indices))return e;for(var t=v.Geometry.computeNumberOfVertices(e),r=f.IndexDatatype.createTypedArray(t,t),a=0;a<t;++a)r[a]=a;return e.indices=r,e}(e);case C.PrimitiveType.LINE_STRIP:return function(e){var t=v.Geometry.computeNumberOfVertices(e),r=f.IndexDatatype.createTypedArray(t,2*(t-1));r[0]=0,r[1]=1;for(var a=2,i=2;i<t;++i)r[a++]=i-1,r[a++]=i;return e.indices=r,e.primitiveType=C.PrimitiveType.LINES,e}(e);case C.PrimitiveType.LINE_LOOP:return function(e){var t=v.Geometry.computeNumberOfVertices(e),r=f.IndexDatatype.createTypedArray(t,2*t);r[0]=0,r[1]=1;for(var a=2,i=2;i<t;++i)r[a++]=i-1,r[a++]=i;return r[a++]=t-1,r[a]=0,e.indices=r,e.primitiveType=C.PrimitiveType.LINES,e}(e);case C.PrimitiveType.LINES:return function(e){if(n.defined(e.indices))return e;for(var t=v.Geometry.computeNumberOfVertices(e),r=f.IndexDatatype.createTypedArray(t,t),a=0;a<t;++a)r[a]=a;return e.indices=r,e}(e)}return e}function j(e,t){Math.abs(e.y)<s.CesiumMath.EPSILON6&&(e.y=t?-s.CesiumMath.EPSILON6:s.CesiumMath.EPSILON6)}T.compressVertices=function(e){var i,s,o=e.attributes.extrudeDirection;if(n.defined(o)){var u=o.values;s=u.length/3;var d=new Float32Array(2*s),l=0;for(i=0;i<s;++i)a.Cartesian3.fromArray(u,3*i,Y),a.Cartesian3.equals(Y,a.Cartesian3.ZERO)?l+=2:(W=t.AttributeCompression.octEncodeInRange(Y,65535,W),d[l++]=W.x,d[l++]=W.y);return e.attributes.compressedAttributes=new v.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:d}),delete e.attributes.extrudeDirection,e}var f=e.attributes.normal,y=e.attributes.st,c=n.defined(f),m=n.defined(y);if(!c&&!m)return e;var C,h,b,g,A=e.attributes.tangent,T=e.attributes.bitangent,x=n.defined(A),P=n.defined(T);c&&(C=f.values),m&&(h=y.values),x&&(b=A.values),P&&(g=T.values);var w=s=(c?C.length:h.length)/(c?3:2),I=m&&c?2:1;I+=x||P?1:0;var S=new Float32Array(w*=I),O=0;for(i=0;i<s;++i){m&&(r.Cartesian2.fromArray(h,2*i,q),S[O++]=t.AttributeCompression.compressTextureCoordinates(q));var E=3*i;c&&n.defined(b)&&n.defined(g)?(a.Cartesian3.fromArray(C,E,Y),a.Cartesian3.fromArray(b,E,Z),a.Cartesian3.fromArray(g,E,H),t.AttributeCompression.octPack(Y,Z,H,q),S[O++]=q.x,S[O++]=q.y):(c&&(a.Cartesian3.fromArray(C,E,Y),S[O++]=t.AttributeCompression.octEncodeFloat(Y)),x&&(a.Cartesian3.fromArray(b,E,Y),S[O++]=t.AttributeCompression.octEncodeFloat(Y)),P&&(a.Cartesian3.fromArray(g,E,Y),S[O++]=t.AttributeCompression.octEncodeFloat(Y)))}return e.attributes.compressedAttributes=new v.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:I,values:S}),c&&delete e.attributes.normal,m&&delete e.attributes.st,P&&delete e.attributes.bitangent,x&&delete e.attributes.tangent,e};var J=new a.Cartesian3;function K(e,t,r,i){a.Cartesian3.add(e,a.Cartesian3.multiplyByScalar(a.Cartesian3.subtract(t,e,J),e.y/(e.y-t.y),J),r),a.Cartesian3.clone(r,i),j(r,!0),j(i,!1)}var Q=new a.Cartesian3,$=new a.Cartesian3,ee=new a.Cartesian3,te=new a.Cartesian3,re={positions:new Array(7),indices:new Array(9)};function ae(e,t,r){if(!(e.x>=0||t.x>=0||r.x>=0)){!function(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return j(e,e.y<0),j(t,t.y<0),void j(r,r.y<0);var a=Math.abs(e.y),i=Math.abs(t.y),n=Math.abs(r.y),o=(a>i?a>n?s.CesiumMath.sign(e.y):s.CesiumMath.sign(r.y):i>n?s.CesiumMath.sign(t.y):s.CesiumMath.sign(r.y))<0;j(e,o),j(t,o),j(r,o)}(e,t,r);var a=e.y<0,i=t.y<0,n=r.y<0,o=0;o+=a?1:0,o+=i?1:0;var u=re.indices;1===(o+=n?1:0)?(u[1]=3,u[2]=4,u[5]=6,u[7]=6,u[8]=5,a?(K(e,t,Q,ee),K(e,r,$,te),u[0]=0,u[3]=1,u[4]=2,u[6]=1):i?(K(t,r,Q,ee),K(t,e,$,te),u[0]=1,u[3]=2,u[4]=0,u[6]=2):n&&(K(r,e,Q,ee),K(r,t,$,te),u[0]=2,u[3]=0,u[4]=1,u[6]=0)):2===o&&(u[2]=4,u[4]=4,u[5]=3,u[7]=5,u[8]=6,a?i?n||(K(r,e,Q,ee),K(r,t,$,te),u[0]=0,u[1]=1,u[3]=0,u[6]=2):(K(t,r,Q,ee),K(t,e,$,te),u[0]=2,u[1]=0,u[3]=2,u[6]=1):(K(e,t,Q,ee),K(e,r,$,te),u[0]=1,u[1]=2,u[3]=1,u[6]=0));var p=re.positions;return p[0]=e,p[1]=t,p[2]=r,p.length=3,1!==o&&2!==o||(p[3]=Q,p[4]=$,p[5]=ee,p[6]=te,p.length=7),re}}function ie(e,t){var r=e.attributes;if(0!==r.position.values.length){for(var a in r)if(r.hasOwnProperty(a)&&n.defined(r[a])&&n.defined(r[a].values)){var i=r[a];i.values=p.ComponentDatatype.createTypedArray(i.componentDatatype,i.values)}var s=v.Geometry.computeNumberOfVertices(e);return e.indices=f.IndexDatatype.createTypedArray(s,e.indices),t&&(e.boundingSphere=o.BoundingSphere.fromVertices(r.position.values)),e}}function ne(e){var t=e.attributes,r={};for(var a in t)if(t.hasOwnProperty(a)&&n.defined(t[a])&&n.defined(t[a].values)){var i=t[a];r[a]=new v.GeometryAttribute({componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,values:[]})}return new v.Geometry({attributes:r,indices:[],primitiveType:e.primitiveType})}function se(e,t,r){var a=n.defined(e.geometry.boundingSphere);t=ie(t,a),r=ie(r,a),n.defined(r)&&!n.defined(t)?e.geometry=r:!n.defined(r)&&n.defined(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=r,e.geometry=void 0)}function oe(e,t){var r=new e,a=new e,i=new e;return function(n,s,o,u,p,d,l,v){var f=e.fromArray(p,n*t,r),y=e.fromArray(p,s*t,a),c=e.fromArray(p,o*t,i);e.multiplyByScalar(f,u.x,f),e.multiplyByScalar(y,u.y,y),e.multiplyByScalar(c,u.z,c);var m=e.add(f,y,f);e.add(m,c,m),v&&e.normalize(m,m),e.pack(m,d,l*t)}}var ue=oe(u.Cartesian4,4),pe=oe(a.Cartesian3,3),de=oe(r.Cartesian2,2),le=new a.Cartesian3,ve=new a.Cartesian3,fe=new a.Cartesian3,ye=new a.Cartesian3;function ce(e,t,i,o,u,p,d,l,v,f,y,c,m,C,A,T){if(n.defined(p)||n.defined(d)||n.defined(l)||n.defined(v)||n.defined(f)||0!==C){var x=function(e,t,i,o,u){var p,d,l,v,f,y,c,m;if(n.defined(u)||(u=new a.Cartesian3),n.defined(t.z)){if(a.Cartesian3.equalsEpsilon(e,t,s.CesiumMath.EPSILON14))return a.Cartesian3.clone(a.Cartesian3.UNIT_X,u);if(a.Cartesian3.equalsEpsilon(e,i,s.CesiumMath.EPSILON14))return a.Cartesian3.clone(a.Cartesian3.UNIT_Y,u);if(a.Cartesian3.equalsEpsilon(e,o,s.CesiumMath.EPSILON14))return a.Cartesian3.clone(a.Cartesian3.UNIT_Z,u);p=a.Cartesian3.subtract(i,t,h),d=a.Cartesian3.subtract(o,t,b),l=a.Cartesian3.subtract(e,t,g),v=a.Cartesian3.dot(p,p),f=a.Cartesian3.dot(p,d),y=a.Cartesian3.dot(p,l),c=a.Cartesian3.dot(d,d),m=a.Cartesian3.dot(d,l)}else{if(r.Cartesian2.equalsEpsilon(e,t,s.CesiumMath.EPSILON14))return a.Cartesian3.clone(a.Cartesian3.UNIT_X,u);if(r.Cartesian2.equalsEpsilon(e,i,s.CesiumMath.EPSILON14))return a.Cartesian3.clone(a.Cartesian3.UNIT_Y,u);if(r.Cartesian2.equalsEpsilon(e,o,s.CesiumMath.EPSILON14))return a.Cartesian3.clone(a.Cartesian3.UNIT_Z,u);p=r.Cartesian2.subtract(i,t,h),d=r.Cartesian2.subtract(o,t,b),l=r.Cartesian2.subtract(e,t,g),v=r.Cartesian2.dot(p,p),f=r.Cartesian2.dot(p,d),y=r.Cartesian2.dot(p,l),c=r.Cartesian2.dot(d,d),m=r.Cartesian2.dot(d,l)}u.y=c*y-f*m,u.z=v*m-f*y;var C=v*c-f*f;return 0!==u.y&&(u.y/=C),0!==u.z&&(u.z/=C),u.x=1-u.y-u.z,u}(o,a.Cartesian3.fromArray(u,3*e,le),a.Cartesian3.fromArray(u,3*t,ve),a.Cartesian3.fromArray(u,3*i,fe),ye);if(n.defined(p)&&pe(e,t,i,x,p,c.normal.values,T,!0),n.defined(f)){var P,w=a.Cartesian3.fromArray(f,3*e,le),I=a.Cartesian3.fromArray(f,3*t,ve),S=a.Cartesian3.fromArray(f,3*i,fe);a.Cartesian3.multiplyByScalar(w,x.x,w),a.Cartesian3.multiplyByScalar(I,x.y,I),a.Cartesian3.multiplyByScalar(S,x.z,S),a.Cartesian3.equals(w,a.Cartesian3.ZERO)&&a.Cartesian3.equals(I,a.Cartesian3.ZERO)&&a.Cartesian3.equals(S,a.Cartesian3.ZERO)?((P=le).x=0,P.y=0,P.z=0):(P=a.Cartesian3.add(w,I,w),a.Cartesian3.add(P,S,P),a.Cartesian3.normalize(P,P)),a.Cartesian3.pack(P,c.extrudeDirection.values,3*T)}if(n.defined(y)&&function(e,t,r,a,i,n,o){var u=i[e]*a.x,p=i[t]*a.y,d=i[r]*a.z;n[o]=u+p+d>s.CesiumMath.EPSILON6?1:0}(e,t,i,x,y,c.applyOffset.values,T),n.defined(d)&&pe(e,t,i,x,d,c.tangent.values,T,!0),n.defined(l)&&pe(e,t,i,x,l,c.bitangent.values,T,!0),n.defined(v)&&de(e,t,i,x,v,c.st.values,T),C>0)for(var O=0;O<C;O++){var E=m[O];me(e,t,i,x,T,A[E],c[E])}}}function me(e,t,r,a,i,n,s){var o=n.componentsPerAttribute,u=n.values,p=s.values;switch(o){case 4:ue(e,t,r,a,u,p,i,!1);break;case 3:pe(e,t,r,a,u,p,i,!1);break;case 2:de(e,t,r,a,u,p,i,!1);break;default:p[i]=u[e]*a.x+u[t]*a.y+u[r]*a.z}}function Ce(e,t,r,a,i,n){var s=e.position.values.length/3;if(-1!==i){var o=a[i],u=r[o];return-1===u?(r[o]=s,e.position.values.push(n.x,n.y,n.z),t.push(s),s):(t.push(u),u)}return e.position.values.push(n.x,n.y,n.z),t.push(s),s}var he={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function be(e){var t=e.geometry,r=t.attributes,i=r.position.values,s=n.defined(r.normal)?r.normal.values:void 0,o=n.defined(r.bitangent)?r.bitangent.values:void 0,u=n.defined(r.tangent)?r.tangent.values:void 0,p=n.defined(r.st)?r.st.values:void 0,d=n.defined(r.extrudeDirection)?r.extrudeDirection.values:void 0,l=n.defined(r.applyOffset)?r.applyOffset.values:void 0,v=t.indices,f=[];for(var y in r)r.hasOwnProperty(y)&&!he[y]&&n.defined(r[y])&&f.push(y);var c,m,C,h,b=f.length,g=ne(t),A=ne(t),T=[];T.length=i.length/3;var x=[];for(x.length=i.length/3,h=0;h<T.length;++h)T[h]=-1,x[h]=-1;var P=v.length;for(h=0;h<P;h+=3){var w=v[h],I=v[h+1],S=v[h+2],O=a.Cartesian3.fromArray(i,3*w),E=a.Cartesian3.fromArray(i,3*I),N=a.Cartesian3.fromArray(i,3*S),L=ae(O,E,N);if(n.defined(L)&&L.positions.length>3)for(var z=L.positions,M=L.indices,D=M.length,G=0;G<D;++G){var R=M[G],V=z[R];V.y<0?(c=A.attributes,m=A.indices,C=T):(c=g.attributes,m=g.indices,C=x),ce(w,I,S,V,i,s,u,o,p,d,l,c,f,b,r,Ce(c,m,C,v,R<3?h+R:-1,V))}else n.defined(L)&&(O=L.positions[0],E=L.positions[1],N=L.positions[2]),O.y<0?(c=A.attributes,m=A.indices,C=T):(c=g.attributes,m=g.indices,C=x),ce(w,I,S,O,i,s,u,o,p,d,l,c,f,b,r,Ce(c,m,C,v,h,O)),ce(w,I,S,E,i,s,u,o,p,d,l,c,f,b,r,Ce(c,m,C,v,h+1,E)),ce(w,I,S,N,i,s,u,o,p,d,l,c,f,b,r,Ce(c,m,C,v,h+2,N))}se(e,A,g)}var ge=m.Plane.fromPointNormal(a.Cartesian3.ZERO,a.Cartesian3.UNIT_Y),Ae=new a.Cartesian3,Te=new a.Cartesian3;function xe(e,t,r,i,o,u,p){if(n.defined(p)){var d=a.Cartesian3.fromArray(i,3*e,le);a.Cartesian3.equalsEpsilon(d,r,s.CesiumMath.EPSILON10)?u.applyOffset.values[o]=p[e]:u.applyOffset.values[o]=p[t]}}function Pe(e){var t,r=e.geometry,i=r.attributes,o=i.position.values,u=n.defined(i.applyOffset)?i.applyOffset.values:void 0,p=r.indices,d=ne(r),l=ne(r),v=p.length,f=[];f.length=o.length/3;var c=[];for(c.length=o.length/3,t=0;t<f.length;++t)f[t]=-1,c[t]=-1;for(t=0;t<v;t+=2){var m=p[t],C=p[t+1],h=a.Cartesian3.fromArray(o,3*m,le),b=a.Cartesian3.fromArray(o,3*C,ve);Math.abs(h.y)<s.CesiumMath.EPSILON6&&(h.y<0?h.y=-s.CesiumMath.EPSILON6:h.y=s.CesiumMath.EPSILON6),Math.abs(b.y)<s.CesiumMath.EPSILON6&&(b.y<0?b.y=-s.CesiumMath.EPSILON6:b.y=s.CesiumMath.EPSILON6);var g=d.attributes,A=d.indices,T=c,x=l.attributes,P=l.indices,w=f,I=y.IntersectionTests.lineSegmentPlane(h,b,ge,fe);if(n.defined(I)){var S=a.Cartesian3.multiplyByScalar(a.Cartesian3.UNIT_Y,5*s.CesiumMath.EPSILON9,Ae);h.y<0&&(a.Cartesian3.negate(S,S),g=l.attributes,A=l.indices,T=f,x=d.attributes,P=d.indices,w=c);var O=a.Cartesian3.add(I,S,Te);xe(m,C,h,o,Ce(g,A,T,p,t,h),g,u),xe(m,C,O,o,Ce(g,A,T,p,-1,O),g,u),a.Cartesian3.negate(S,S),a.Cartesian3.add(I,S,O),xe(m,C,O,o,Ce(x,P,w,p,-1,O),x,u),xe(m,C,b,o,Ce(x,P,w,p,t+1,b),x,u)}else{var E,N,L;h.y<0?(E=l.attributes,N=l.indices,L=f):(E=d.attributes,N=d.indices,L=c),xe(m,C,h,o,Ce(E,N,L,p,t,h),E,u),xe(m,C,b,o,Ce(E,N,L,p,t+1,b),E,u)}}se(e,l,d)}var we=new r.Cartesian2,Ie=new r.Cartesian2,Se=new a.Cartesian3,Oe=new a.Cartesian3,Ee=new a.Cartesian3,Ne=new a.Cartesian3,Le=new a.Cartesian3,ze=new a.Cartesian3,Me=new a.Cartesian3,De=new u.Cartesian4;function Ge(e){for(var t=e.attributes,r=t.position.values,i=t.prevPosition.values,n=t.nextPosition.values,s=r.length,o=0;o<s;o+=3){var u=a.Cartesian3.unpack(r,o,Se);if(!(u.x>0)){var p=a.Cartesian3.unpack(i,o,Oe);(u.y<0&&p.y>0||u.y>0&&p.y<0)&&(o-3>0?(i[o]=r[o-3],i[o+1]=r[o-2],i[o+2]=r[o-1]):a.Cartesian3.pack(u,i,o));var d=a.Cartesian3.unpack(n,o,Ee);(u.y<0&&d.y>0||u.y>0&&d.y<0)&&(o+3<s?(n[o]=r[o+3],n[o+1]=r[o+4],n[o+2]=r[o+5]):a.Cartesian3.pack(u,n,o))}}}var Re=5*s.CesiumMath.EPSILON9,Ve=s.CesiumMath.EPSILON6;T.splitLongitude=function(e){var t=e.geometry,i=t.boundingSphere;if(n.defined(i)&&(i.center.x-i.radius>0||o.BoundingSphere.intersectPlane(i,m.Plane.ORIGIN_ZX_PLANE)!==l.Intersect.INTERSECTING))return e;if(t.geometryType!==v.GeometryType.NONE)switch(t.geometryType){case v.GeometryType.POLYLINES:!function(e){var t,i,o,p=e.geometry,d=p.attributes,l=d.position.values,v=d.prevPosition.values,f=d.nextPosition.values,c=d.expandAndWidth.values,m=n.defined(d.st)?d.st.values:void 0,C=n.defined(d.color)?d.color.values:void 0,h=n.defined(d.dist)?d.dist.values:void 0,b=ne(p),g=ne(p),A=!1,T=l.length/3;for(t=0;t<T;t+=4){var x=t,P=t+2,w=a.Cartesian3.fromArray(l,3*x,Se),I=a.Cartesian3.fromArray(l,3*P,Oe);if(Math.abs(w.y)<Ve)for(w.y=Ve*(I.y<0?-1:1),l[3*t+1]=w.y,l[3*(t+1)+1]=w.y,i=3*x;i<3*x+12;i+=3)v[i]=l[3*t],v[i+1]=l[3*t+1],v[i+2]=l[3*t+2];if(Math.abs(I.y)<Ve)for(I.y=Ve*(w.y<0?-1:1),l[3*(t+2)+1]=I.y,l[3*(t+3)+1]=I.y,i=3*x;i<3*x+12;i+=3)f[i]=l[3*(t+2)],f[i+1]=l[3*(t+2)+1],f[i+2]=l[3*(t+2)+2];var S=b.attributes,O=b.indices,E=g.attributes,N=g.indices,L=y.IntersectionTests.lineSegmentPlane(w,I,ge,Ne);if(n.defined(L)){A=!0;var z=a.Cartesian3.multiplyByScalar(a.Cartesian3.UNIT_Y,Re,Le);w.y<0&&(a.Cartesian3.negate(z,z),S=g.attributes,O=g.indices,E=b.attributes,N=b.indices);var M=a.Cartesian3.add(L,z,ze);S.position.values.push(w.x,w.y,w.z,w.x,w.y,w.z),S.position.values.push(M.x,M.y,M.z),S.position.values.push(M.x,M.y,M.z),S.prevPosition.values.push(v[3*x],v[3*x+1],v[3*x+2]),S.prevPosition.values.push(v[3*x+3],v[3*x+4],v[3*x+5]),S.prevPosition.values.push(w.x,w.y,w.z,w.x,w.y,w.z),S.nextPosition.values.push(M.x,M.y,M.z),S.nextPosition.values.push(M.x,M.y,M.z),S.nextPosition.values.push(M.x,M.y,M.z),S.nextPosition.values.push(M.x,M.y,M.z),a.Cartesian3.negate(z,z),a.Cartesian3.add(L,z,M),E.position.values.push(M.x,M.y,M.z),E.position.values.push(M.x,M.y,M.z),E.position.values.push(I.x,I.y,I.z,I.x,I.y,I.z),E.prevPosition.values.push(M.x,M.y,M.z),E.prevPosition.values.push(M.x,M.y,M.z),E.prevPosition.values.push(M.x,M.y,M.z),E.prevPosition.values.push(M.x,M.y,M.z),E.nextPosition.values.push(I.x,I.y,I.z,I.x,I.y,I.z),E.nextPosition.values.push(f[3*P],f[3*P+1],f[3*P+2]),E.nextPosition.values.push(f[3*P+3],f[3*P+4],f[3*P+5]);var D=r.Cartesian2.fromArray(c,2*x,we),G=Math.abs(D.y);S.expandAndWidth.values.push(-1,G,1,G),S.expandAndWidth.values.push(-1,-G,1,-G),E.expandAndWidth.values.push(-1,G,1,G),E.expandAndWidth.values.push(-1,-G,1,-G);var R=a.Cartesian3.magnitudeSquared(a.Cartesian3.subtract(L,w,Ee));if(R/=a.Cartesian3.magnitudeSquared(a.Cartesian3.subtract(I,w,Ee)),n.defined(C)){var V=u.Cartesian4.fromArray(C,4*x,De),F=u.Cartesian4.fromArray(C,4*P,De),B=s.CesiumMath.lerp(V.x,F.x,R),k=s.CesiumMath.lerp(V.y,F.y,R),_=s.CesiumMath.lerp(V.z,F.z,R),U=s.CesiumMath.lerp(V.w,F.w,R);for(i=4*x;i<4*x+8;++i)S.color.values.push(C[i]);for(S.color.values.push(B,k,_,U),S.color.values.push(B,k,_,U),E.color.values.push(B,k,_,U),E.color.values.push(B,k,_,U),i=4*P;i<4*P+8;++i)E.color.values.push(C[i])}if(n.defined(m)){var q=r.Cartesian2.fromArray(m,2*x,we),Y=r.Cartesian2.fromArray(m,2*(t+3),Ie),Z=s.CesiumMath.lerp(q.x,Y.x,R);for(i=2*x;i<2*x+4;++i)S.st.values.push(m[i]);for(S.st.values.push(Z,q.y),S.st.values.push(Z,Y.y),E.st.values.push(Z,q.y),E.st.values.push(Z,Y.y),i=2*P;i<2*P+4;++i)E.st.values.push(m[i])}if(n.defined(h)){var H=a.Cartesian3.fromArray(h,3*x,Me),W=a.Cartesian3.fromArray(h,3*P,Me),X=s.CesiumMath.lerp(H.x,W.x,R);for(i=3*x;i<3*x+6;++i)S.dist.values.push(h[i]);for(S.dist.values.push(X,H.y,H.z),S.dist.values.push(X,H.y,H.z),E.dist.values.push(X,W.y,W.z),E.dist.values.push(X,W.y,W.z),i=3*P;i<3*P+6;++i)E.dist.values.push(h[i])}o=S.position.values.length/3-4,O.push(o,o+2,o+1),O.push(o+1,o+2,o+3),o=E.position.values.length/3-4,N.push(o,o+2,o+1),N.push(o+1,o+2,o+3)}else{var j,J;for(w.y<0?(j=g.attributes,J=g.indices):(j=b.attributes,J=b.indices),j.position.values.push(w.x,w.y,w.z),j.position.values.push(w.x,w.y,w.z),j.position.values.push(I.x,I.y,I.z),j.position.values.push(I.x,I.y,I.z),i=3*t;i<3*t+12;++i)j.prevPosition.values.push(v[i]),j.nextPosition.values.push(f[i]);for(i=2*t;i<2*t+8;++i)j.expandAndWidth.values.push(c[i]),n.defined(m)&&j.st.values.push(m[i]);if(n.defined(C))for(i=4*t;i<4*t+16;++i)j.color.values.push(C[i]);if(n.defined(h))for(i=3*t;i<3*t+12;++i)j.dist.values.push(h[i]);o=j.position.values.length/3-4,J.push(o,o+2,o+1),J.push(o+1,o+2,o+3)}}A&&(Ge(g),Ge(b)),se(e,g,b)}(e);break;case v.GeometryType.TRIANGLES:be(e);break;case v.GeometryType.LINES:Pe(e)}else X(t),t.primitiveType===C.PrimitiveType.TRIANGLES?be(e):t.primitiveType===C.PrimitiveType.LINES&&Pe(e);return e},e.GeometryPipeline=T}));
