define(["exports","./Check-737bd4ec","./when-7d8885d2","./IndexDatatype-6f66284e","./WebGLConstants-615fbe7f"],(function(e,t,_,E,r){"use strict";var i={STREAM_DRAW:r.WebGLConstants.STREAM_DRAW,STATIC_DRAW:r.WebGLConstants.STATIC_DRAW,DYNAMIC_DRAW:r.WebGLConstants.DYNAMIC_DRAW,validate:function(e){return e===i.STREAM_DRAW||e===i.STATIC_DRAW||e===i.DYNAMIC_DRAW}};function n(){return!0}function T(e,t){function _(){}for(var E in e)"function"==typeof e[E]&&(e[E]=_);e.isDestroyed=n}function A(e){var t=(e=_.defaultValue(e,_.defaultValue.EMPTY_OBJECT)).context._gl,E=e.bufferTarget,r=e.typedArray,i=e.sizeInBytes,n=e.usage,T=_.defined(r);T&&(i=r.byteLength);var A=t.createBuffer();t.bindBuffer(E,A),t.bufferData(E,T?r:i,n),t.bindBuffer(E,null),this._gl=t,this._webgl2=e.context._webgl2,this._bufferTarget=E,this._sizeInBytes=i,this._usage=n,this._buffer=A,this.context=e.context,e.context.memorySize+=i}function R(){}function s(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=s._Counter++}function o(e,t,_,E,r,i,n,T){void 0===E&&(E=0),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===n&&(n=!1),this._isAlreadyOwned=!1,e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=_,this._instanced=i,this._divisor=T||1,t instanceof s?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=n?E:E*Float32Array.BYTES_PER_ELEMENT,r||this.create()}function f(e,t,_,E,r,i,n,T,A,R,s,a,u,I){if(void 0===s&&(s=!1),void 0===a&&(a=!1),void 0===u&&(u=1),void 0===I&&(I=!1),t instanceof o?(this._buffer=t,this._ownsBuffer=I):(this._buffer=new o(e,t,E,i,r,n,a),this._ownsBuffer=!0),this.uniqueId=f._Counter++,this._kind=_,null==R){var O=this.getData();this.type=f.FLOAT,O instanceof Int8Array?this.type=f.BYTE:O instanceof Uint8Array?this.type=f.UNSIGNED_BYTE:O instanceof Int16Array?this.type=f.SHORT:O instanceof Uint16Array?this.type=f.UNSIGNED_SHORT:O instanceof Int32Array?this.type=f.INT:O instanceof Uint32Array&&(this.type=f.UNSIGNED_INT)}else this.type=R;var N=f.GetTypeByteLength(this.type);a?(this._size=A||(i?i/N:f.DeduceStride(_)),this.byteStride=i||this._buffer.byteStride||this._size*N,this.byteOffset=T||0):(this._size=A||i||f.DeduceStride(_),this.byteStride=i?i*N:this._buffer.byteStride||this._size*N,this.byteOffset=(T||0)*N),this.normalized=s,this._instanced=void 0!==n&&n,this._instanceDivisor=n?u:0,this._computeHashCode()}function a(e,t,_){void 0===_&&(_=R.BUFFER_CREATIONFLAG_READWRITE),this._engine=e,this._engine._storageBuffers.push(this),this._create(t,_)}function u(e){var t=(e=_.defaultValue(e,_.defaultValue.EMPTY_OBJECT)).context,n=e.bufferTarget,T=e.typedArray,A=e.sizeInBytes,s=e.usage,f=_.defined(T);f?A=T.byteLength:T=new Uint8Array(A);var u=R.BUFFER_CREATIONFLAG_STORAGE;_.defined(s)&&(s==i.STREAM_DRAW||s==i.STATIC_DRAW?u|=R.BUFFER_CREATIONFLAG_WRITE:s==i.DYNAMIC_DRAW&&(u|=R.BUFFER_CREATIONFLAG_READWRITE)),_.defined(n)?n==r.WebGLConstants.ELEMENT_ARRAY_BUFFER?(T instanceof Uint8Array&&(e.indexDatatype==E.IndexDatatype.UNSIGNED_INT?T=new Uint32Array(T.buffer,T.byteOffset,T.byteLength/4):e.indexDatatype==E.IndexDatatype.UNSIGNED_SHORT&&(T=new Uint16Array(T.buffer,T.byteOffset,T.byteLength/2))),this._dataBuffer=t.engine.createIndexBuffer(T)):n==r.WebGLConstants.ARRAY_BUFFER?(this._dataBuffer=new o(t.engine,T,!0),this._dataBuffer._data=null):console.log("BufferGPU not supported bufferTarget"):(this._dataBuffer=new a(t.engine,A,u),f&&this._dataBuffer.update(T,0,A)),this._bufferTarget=n,this._sizeInBytes=A,this._usage=s,this.context=e.context,e.context.memorySize+=A}function I(e){return new I({context:(e=_.defaultValue(e,_.defaultValue.EMPTY_OBJECT)).context,bufferTarget:r.WebGLConstants.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage})}Object.defineProperties(A.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}}),A.prototype._getBuffer=function(){return this._buffer},A.prototype.copyFromArrayView=function(e,t){t=_.defaultValue(t,0);var E=this._gl,r=this._bufferTarget;E.bindBuffer(r,this._buffer),E.bufferSubData(r,t,e),E.bindBuffer(r,null)},A.prototype.copyFromBuffer=function(e,t,_,E){var i=r.WebGLConstants.COPY_READ_BUFFER,n=r.WebGLConstants.COPY_WRITE_BUFFER,T=this._gl;T.bindBuffer(n,this._buffer),T.bindBuffer(i,e._buffer),T.copyBufferSubData(i,n,t,_,E),T.bindBuffer(n,null),T.bindBuffer(i,null)},A.prototype.getBufferData=function(e,t,E,i){t=_.defaultValue(t,0),E=_.defaultValue(E,0);var n=this._gl,T=r.WebGLConstants.COPY_READ_BUFFER;n.bindBuffer(T,this._buffer),n.getBufferSubData(T,t,e,E,i),n.bindBuffer(T,null)},A.prototype.isDestroyed=function(){return!1},A.prototype.destroy=function(){return this._gl.deleteBuffer(this._buffer),this.context.memorySize-=this.sizeInBytes,T(this)},R.ALPHA_DISABLE=0,R.ALPHA_ADD=1,R.ALPHA_COMBINE=2,R.ALPHA_SUBTRACT=3,R.ALPHA_MULTIPLY=4,R.ALPHA_MAXIMIZED=5,R.ALPHA_ONEONE=6,R.ALPHA_PREMULTIPLIED=7,R.ALPHA_PREMULTIPLIED_PORTERDUFF=8,R.ALPHA_INTERPOLATE=9,R.ALPHA_SCREENMODE=10,R.ALPHA_ONEONE_ONEONE=11,R.ALPHA_ALPHATOCOLOR=12,R.ALPHA_REVERSEONEMINUS=13,R.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,R.ALPHA_ONEONE_ONEZERO=15,R.ALPHA_EXCLUSION=16,R.ALPHA_LAYER_ACCUMULATE=17,R.ALPHA_EQUATION_ADD=0,R.ALPHA_EQUATION_SUBSTRACT=1,R.ALPHA_EQUATION_REVERSE_SUBTRACT=2,R.ALPHA_EQUATION_MAX=3,R.ALPHA_EQUATION_MIN=4,R.ALPHA_EQUATION_DARKEN=5,R.DELAYLOADSTATE_NONE=0,R.DELAYLOADSTATE_LOADED=1,R.DELAYLOADSTATE_LOADING=2,R.DELAYLOADSTATE_NOTLOADED=4,R.NEVER=512,R.ALWAYS=519,R.LESS=513,R.EQUAL=514,R.LEQUAL=515,R.GREATER=516,R.GEQUAL=518,R.NOTEQUAL=517,R.KEEP=7680,R.ZERO=0,R.REPLACE=7681,R.INCR=7682,R.DECR=7683,R.INVERT=5386,R.INCR_WRAP=34055,R.DECR_WRAP=34056,R.FRONT=0,R.BACK=1,R.TEXTURE_CLAMP_ADDRESSMODE=0,R.TEXTURE_WRAP_ADDRESSMODE=1,R.TEXTURE_MIRROR_ADDRESSMODE=2,R.TEXTURE_CREATIONFLAG_STORAGE=1,R.TEXTUREFORMAT_ALPHA=0,R.TEXTUREFORMAT_LUMINANCE=1,R.TEXTUREFORMAT_LUMINANCE_ALPHA=2,R.TEXTUREFORMAT_RGB=4,R.TEXTUREFORMAT_RGBA=5,R.TEXTUREFORMAT_RED=6,R.TEXTUREFORMAT_R=6,R.TEXTUREFORMAT_RG=7,R.TEXTUREFORMAT_RED_INTEGER=8,R.TEXTUREFORMAT_R_INTEGER=8,R.TEXTUREFORMAT_RG_INTEGER=9,R.TEXTUREFORMAT_RGB_INTEGER=10,R.TEXTUREFORMAT_RGBA_INTEGER=11,R.TEXTUREFORMAT_BGRA=12,R.TEXTUREFORMAT_DEPTH24_STENCIL8=13,R.TEXTUREFORMAT_DEPTH32_FLOAT=14,R.TEXTUREFORMAT_DEPTH16=15,R.TEXTUREFORMAT_DEPTH24=16,R.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,R.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,R.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,R.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,R.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,R.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,R.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,R.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,R.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,R.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,R.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,R.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,R.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,R.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,R.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,R.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,R.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,R.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,R.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,R.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,R.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,R.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,R.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,R.TEXTURETYPE_UNSIGNED_BYTE=0,R.TEXTURETYPE_UNSIGNED_INT=0,R.TEXTURETYPE_FLOAT=1,R.TEXTURETYPE_HALF_FLOAT=2,R.TEXTURETYPE_BYTE=3,R.TEXTURETYPE_SHORT=4,R.TEXTURETYPE_UNSIGNED_SHORT=5,R.TEXTURETYPE_INT=6,R.TEXTURETYPE_UNSIGNED_INTEGER=7,R.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,R.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,R.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,R.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,R.TEXTURETYPE_UNSIGNED_INT_24_8=12,R.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,R.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,R.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,R.TEXTURETYPE_UNDEFINED=16,R.TEXTURE_NEAREST_SAMPLINGMODE=1,R.TEXTURE_NEAREST_NEAREST=1,R.TEXTURE_BILINEAR_SAMPLINGMODE=2,R.TEXTURE_LINEAR_LINEAR=2,R.TEXTURE_TRILINEAR_SAMPLINGMODE=3,R.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,R.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,R.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,R.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,R.TEXTURE_NEAREST_LINEAR=7,R.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,R.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,R.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,R.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,R.TEXTURE_LINEAR_NEAREST=12,R.TEXTURE_EXPLICIT_MODE=0,R.TEXTURE_SPHERICAL_MODE=1,R.TEXTURE_PLANAR_MODE=2,R.TEXTURE_CUBIC_MODE=3,R.TEXTURE_PROJECTION_MODE=4,R.TEXTURE_SKYBOX_MODE=5,R.TEXTURE_INVCUBIC_MODE=6,R.TEXTURE_EQUIRECTANGULAR_MODE=7,R.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,R.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,R.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,R.TEXTURE_FILTERING_QUALITY_HIGH=64,R.TEXTURE_FILTERING_QUALITY_MEDIUM=16,R.TEXTURE_FILTERING_QUALITY_LOW=8,R.SCALEMODE_FLOOR=1,R.SCALEMODE_NEAREST=2,R.SCALEMODE_CEILING=3,R.MATERIAL_TextureDirtyFlag=1,R.MATERIAL_LightDirtyFlag=2,R.MATERIAL_FresnelDirtyFlag=4,R.MATERIAL_AttributesDirtyFlag=8,R.MATERIAL_MiscDirtyFlag=16,R.MATERIAL_PrePassDirtyFlag=32,R.MATERIAL_AllDirtyFlag=63,R.MATERIAL_TriangleFillMode=0,R.MATERIAL_WireFrameFillMode=1,R.MATERIAL_PointFillMode=2,R.MATERIAL_PointListDrawMode=3,R.MATERIAL_LineListDrawMode=4,R.MATERIAL_LineLoopDrawMode=5,R.MATERIAL_LineStripDrawMode=6,R.MATERIAL_TriangleStripDrawMode=7,R.MATERIAL_TriangleFanDrawMode=8,R.MATERIAL_ClockWiseSideOrientation=0,R.MATERIAL_CounterClockWiseSideOrientation=1,R.ACTION_NothingTrigger=0,R.ACTION_OnPickTrigger=1,R.ACTION_OnLeftPickTrigger=2,R.ACTION_OnRightPickTrigger=3,R.ACTION_OnCenterPickTrigger=4,R.ACTION_OnPickDownTrigger=5,R.ACTION_OnDoublePickTrigger=6,R.ACTION_OnPickUpTrigger=7,R.ACTION_OnPickOutTrigger=16,R.ACTION_OnLongPressTrigger=8,R.ACTION_OnPointerOverTrigger=9,R.ACTION_OnPointerOutTrigger=10,R.ACTION_OnEveryFrameTrigger=11,R.ACTION_OnIntersectionEnterTrigger=12,R.ACTION_OnIntersectionExitTrigger=13,R.ACTION_OnKeyDownTrigger=14,R.ACTION_OnKeyUpTrigger=15,R.PARTICLES_BILLBOARDMODE_Y=2,R.PARTICLES_BILLBOARDMODE_ALL=7,R.PARTICLES_BILLBOARDMODE_STRETCHED=8,R.MESHES_CULLINGSTRATEGY_STANDARD=0,R.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,R.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,R.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,R.SCENELOADER_NO_LOGGING=0,R.SCENELOADER_MINIMAL_LOGGING=1,R.SCENELOADER_SUMMARY_LOGGING=2,R.SCENELOADER_DETAILED_LOGGING=3,R.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,R.PREPASS_POSITION_TEXTURE_TYPE=1,R.PREPASS_VELOCITY_TEXTURE_TYPE=2,R.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,R.PREPASS_COLOR_TEXTURE_TYPE=4,R.PREPASS_DEPTH_TEXTURE_TYPE=5,R.PREPASS_NORMAL_TEXTURE_TYPE=6,R.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,R.BUFFER_CREATIONFLAG_READ=1,R.BUFFER_CREATIONFLAG_WRITE=2,R.BUFFER_CREATIONFLAG_READWRITE=3,R.BUFFER_CREATIONFLAG_UNIFORM=4,R.BUFFER_CREATIONFLAG_VERTEX=8,R.BUFFER_CREATIONFLAG_INDEX=16,R.BUFFER_CREATIONFLAG_STORAGE=32,R.RENDERPASS_MAIN=0,R.INPUT_ALT_KEY=18,R.INPUT_CTRL_KEY=17,R.INPUT_META_KEY1=91,R.INPUT_META_KEY2=92,R.INPUT_META_KEY3=93,R.INPUT_SHIFT_KEY=16,R.SNAPSHOTRENDERING_STANDARD=0,R.SNAPSHOTRENDERING_FAST=1,R.PERSPECTIVE_CAMERA=0,R.ORTHOGRAPHIC_CAMERA=1,R.FOVMODE_VERTICAL_FIXED=0,R.FOVMODE_HORIZONTAL_FIXED=1,R.RIG_MODE_NONE=0,R.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,R.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,R.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,R.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,R.RIG_MODE_STEREOSCOPIC_INTERLACED=14,R.RIG_MODE_VR=20,R.RIG_MODE_WEBVR=21,R.RIG_MODE_CUSTOM=22,R.MAX_SUPPORTED_UV_SETS=6,R.GL_ALPHA_EQUATION_ADD=32774,R.GL_ALPHA_EQUATION_MIN=32775,R.GL_ALPHA_EQUATION_MAX=32776,R.GL_ALPHA_EQUATION_SUBTRACT=32778,R.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,R.GL_ALPHA_FUNCTION_SRC=768,R.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,R.GL_ALPHA_FUNCTION_SRC_ALPHA=770,R.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,R.GL_ALPHA_FUNCTION_DST_ALPHA=772,R.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,R.GL_ALPHA_FUNCTION_DST_COLOR=774,R.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,R.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,R.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,R.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,R.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,R.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,R.SnippetUrl="https://snippet.babylonjs.com",Object.defineProperty(s.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),s._Counter=0,o.prototype.createVertexBuffer=function(e,t,_,E,r,i,n){void 0===i&&(i=!1);var T=i?t:t*Float32Array.BYTES_PER_ELEMENT,A=E?i?E:E*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new f(this._engine,this,e,this._updatable,!0,A,void 0===r?this._instanced:r,T,_,void 0,void 0,!0,this._divisor||n)},o.prototype.isUpdatable=function(){return this._updatable},o.prototype.getData=function(){return this._data},o.prototype.getBuffer=function(){return this._buffer},o.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},o.prototype.create=function(e){void 0===e&&(e=null),!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},o.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},o.prototype.update=function(e){this.create(e)},o.prototype.updateDirectly=function(e,t,_,E){void 0===E&&(E=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,E?t:t*Float32Array.BYTES_PER_ELEMENT,_?_*this.byteStride:void 0),this._data=0===t&&void 0===_?e:null)},o.prototype._increaseReferences=function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)},o.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)},Object.defineProperty(f.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e,this._computeHashCode()},enumerable:!1,configurable:!0}),f.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},f.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},f.prototype.getKind=function(){return this._kind},f.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},f.prototype.getData=function(){return this._buffer.getData()},f.prototype.getFloatData=function(e,t){var _=this.getData();if(!_)return null;var E=this.getSize()*f.GetTypeByteLength(this.type),r=e*this.getSize();if(this.type!==f.FLOAT||this.byteStride!==E){var i=new Float32Array(r);return this.forEach(r,(function(e,t){return i[t]=e})),i}if(!(_ instanceof Array||_ instanceof Float32Array)||0!==this.byteOffset||_.length!==r){if(_ instanceof Array){var n=this.byteOffset/4;return _.slice(n,n+r)}if(_ instanceof ArrayBuffer)return new Float32Array(_,this.byteOffset,r);n=_.byteOffset+this.byteOffset;if(t){var T=new Float32Array(r),A=new Float32Array(_.buffer,n,r);return T.set(A),T}var R=n%4;return R&&(n=Math.max(0,n-R)),new Float32Array(_.buffer,n,r)}return t?_.slice():_},f.prototype.getBuffer=function(){return this._buffer.getBuffer()},f.prototype.getStrideSize=function(){return this.byteStride/f.GetTypeByteLength(this.type)},f.prototype.getOffset=function(){return this.byteOffset/f.GetTypeByteLength(this.type)},f.prototype.getSize=function(e){return void 0===e&&(e=!1),e?this._size*f.GetTypeByteLength(this.type):this._size},f.prototype.getIsInstanced=function(){return this._instanced},f.prototype.getInstanceDivisor=function(){return this._instanceDivisor},f.prototype.create=function(e){this._buffer.create(e)},f.prototype.update=function(e){this._buffer.update(e)},f.prototype.updateDirectly=function(e,t,_){void 0===_&&(_=!1),this._buffer.updateDirectly(e,t,void 0,_)},f.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},f.prototype.forEach=function(e,t){f.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,t)},f.DeduceStride=function(e){switch(e){case f.UVKind:case f.UV2Kind:case f.UV3Kind:case f.UV4Kind:case f.UV5Kind:case f.UV6Kind:return 2;case f.NormalKind:case f.PositionKind:return 3;case f.ColorKind:case f.MatricesIndicesKind:case f.MatricesIndicesExtraKind:case f.MatricesWeightsKind:case f.MatricesWeightsExtraKind:case f.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}},f.GetTypeByteLength=function(e){switch(e){case f.BYTE:case f.UNSIGNED_BYTE:return 1;case f.SHORT:case f.UNSIGNED_SHORT:return 2;case f.INT:case f.UNSIGNED_INT:case f.FLOAT:return 4;default:throw new Error("Invalid type '".concat(e,"'"))}},f.ForEach=function(e,t,_,E,r,i,n,T){if(e instanceof Array)for(var A=t/4,R=_/4,s=0;s<i;s+=E){for(var o=0;o<E;o++)T(e[A+o],s+o);A+=R}else{var a=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),u=f.GetTypeByteLength(r);for(s=0;s<i;s+=E){var I=t;for(o=0;o<E;o++){T(f._GetFloatValue(a,r,I,n),s+o),I+=u}t+=_}}},f._GetFloatValue=function(e,t,_,E){switch(t){case f.BYTE:var r=e.getInt8(_);return E&&(r=Math.max(r/127,-1)),r;case f.UNSIGNED_BYTE:r=e.getUint8(_);return E&&(r/=255),r;case f.SHORT:r=e.getInt16(_,!0);return E&&(r=Math.max(r/32767,-1)),r;case f.UNSIGNED_SHORT:r=e.getUint16(_,!0);return E&&(r/=65535),r;case f.INT:return e.getInt32(_,!0);case f.UNSIGNED_INT:return e.getUint32(_,!0);case f.FLOAT:return e.getFloat32(_,!0);default:throw new Error("Invalid component type ".concat(t))}},f._Counter=0,f.BYTE=5120,f.UNSIGNED_BYTE=5121,f.SHORT=5122,f.UNSIGNED_SHORT=5123,f.INT=5124,f.UNSIGNED_INT=5125,f.FLOAT=5126,f.PositionKind="position",f.NormalKind="normal",f.TangentKind="tangent",f.UVKind="uv",f.UV2Kind="uv2",f.UV3Kind="uv3",f.UV4Kind="uv4",f.UV5Kind="uv5",f.UV6Kind="uv6",f.ColorKind="color",f.ColorInstanceKind="instanceColor",f.MatricesIndicesKind="matricesIndices",f.MatricesWeightsKind="matricesWeights",f.MatricesIndicesExtraKind="matricesIndicesExtra",f.MatricesWeightsExtraKind="matricesWeightsExtra",a.prototype._create=function(e,t){this._bufferSize=e,this._creationFlags=t,this._buffer=this._engine.createStorageBuffer(e,t)},a.prototype._rebuild=function(){this._create(this._bufferSize,this._creationFlags)},a.prototype.getBuffer=function(){return this._buffer},a.prototype.update=function(e,t,_){this._buffer&&this._engine.updateStorageBuffer(this._buffer,e,t,_)},a.prototype.read=function(e,t,_){return this._engine.readFromStorageBuffer(this._buffer,e,t,_)},a.prototype.dispose=function(){var e=this._engine._storageBuffers,t=e.indexOf(this);-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null},Object.defineProperties(u.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}},dataBuffer:{get:function(){return this._dataBuffer}}}),u.prototype._getBuffer=function(){return console.log("BufferGPU.prototype._getBuffer"),this._dataBuffer},u.prototype.copyFromArrayView=function(e,t){this._dataBuffer.updateDirectly(e,t,null,!0)},u.prototype.copyFromBuffer=function(e,t,_,E){console.log("BufferGPU.prototype.copyFromBuffer")},u.prototype.getBufferData=function(e,t,_,E){console.log("BufferGPU.prototype.getBufferData")},u.prototype.updateBufferData=function(e,t,_){this._dataBuffer.update(e,t,_)},u.prototype.isDestroyed=function(){return!1},u.prototype.destroy=function(){return this._bufferTarget!==r.WebGLConstants.ELEMENT_ARRAY_BUFFER?this._dataBuffer.dispose():this.context._engine._releaseBuffer(this._dataBuffer),this.context.memorySize-=this.sizeInBytes,T(this)},I.createIndexBuffer=function(e){var t=e.context,_=e.indexDatatype,i=E.IndexDatatype.getSizeInBytes(_),n=new I({context:t,bufferTarget:r.WebGLConstants.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,indexDatatype:_}),T=n.sizeInBytes/i;return Object.defineProperties(n,{indexDatatype:{get:function(){return _}},bytesPerIndex:{get:function(){return i}},numberOfIndices:{get:function(){return T}}}),n},Object.defineProperties(I.prototype,{sizeInBytes:{get:function(){return this._inner.sizeInBytes}},usage:{get:function(){return this._inner.usage}}}),I.prototype._getBuffer=function(){return this._inner._getBuffer()},I.prototype.copyFromArrayView=function(e,t){this._inner.copyFromArrayView(e,t)},I.prototype.copyFromBuffer=function(e,t,_,E){this._inner.copyFromBuffer(e,t,_,E)},I.prototype.getBufferData=function(e,t,_,E){this._inner.getBufferData(e,t,_,E)},I.prototype.updateBufferData=function(e,t,_){this._inner.updateBufferData(e,t,_)},I.prototype.isDestroyed=function(){return!1},I.prototype.destroy=function(){return this._inner.destroy(),T(this)},e.Buffer=I,e.BufferUsage=i,e.Constants=R,e.VertexBuffer=f}));
