define(["exports","./Cartographic-bd336518","./Math-09b0b739","./Matrix4-9a0bfd77","./GeometryAttribute-b4292e3e"],(function(a,r,e,t,i){"use strict";var n={},s=new r.Cartesian3,o=new r.Cartesian3,l=new i.Quaternion,C=new t.Matrix3;function y(a,e,n,y,u,m,h,c,x,M){var z=a+e;r.Cartesian3.multiplyByScalar(y,Math.cos(z),s),r.Cartesian3.multiplyByScalar(n,Math.sin(z),o),r.Cartesian3.add(s,o,s);var f=Math.cos(a);f*=f;var d=Math.sin(a);d*=d;var _=m/Math.sqrt(h*f+u*d)/c;return i.Quaternion.fromAxisAngle(s,_,l),t.Matrix3.fromQuaternion(l,C),t.Matrix3.multiplyByVector(C,x,M),r.Cartesian3.normalize(M,M),r.Cartesian3.multiplyByScalar(M,c,M),M}var u=new r.Cartesian3,m=new r.Cartesian3,h=new r.Cartesian3,c=new r.Cartesian3;n.raisePositionsToHeight=function(a,e,t){for(var i=e.ellipsoid,n=e.height,s=e.extrudedHeight,o=t?a.length/3*2:a.length/3,l=new Float64Array(3*o),C=a.length,y=t?C:0,x=0;x<C;x+=3){var M=x+1,z=x+2,f=r.Cartesian3.fromArray(a,x,u);i.scaleToGeodeticSurface(f,f);var d=r.Cartesian3.clone(f,m),_=i.geodeticSurfaceNormal(f,c),v=r.Cartesian3.multiplyByScalar(_,n,h);r.Cartesian3.add(f,v,f),t&&(r.Cartesian3.multiplyByScalar(_,s,v),r.Cartesian3.add(d,v,d),l[x+y]=d.x,l[M+y]=d.y,l[z+y]=d.z),l[x]=f.x,l[M]=f.y,l[z]=f.z}return l};var x=new r.Cartesian3,M=new r.Cartesian3,z=new r.Cartesian3;n.computeEllipsePositions=function(a,t,i){var n=a.semiMinorAxis,s=a.semiMajorAxis,o=a.rotation,l=a.center,C=8*a.granularity,c=n*n,f=s*s,d=s*n,_=r.Cartesian3.magnitude(l),v=r.Cartesian3.normalize(l,x),O=r.Cartesian3.cross(r.Cartesian3.UNIT_Z,l,M);O=r.Cartesian3.normalize(O,O);var p=r.Cartesian3.cross(v,O,z),w=1+Math.ceil(e.CesiumMath.PI_OVER_TWO/C),P=e.CesiumMath.PI_OVER_TWO/(w-1),g=e.CesiumMath.PI_OVER_TWO-w*P;g<0&&(w-=Math.ceil(Math.abs(g)/P));var I,T,E,A,V,b=t?new Array(3*(w*(w+2)*2)):void 0,R=0,W=u,S=m,B=4*w*3,G=B-1,Q=0,H=i?new Array(B):void 0;for(W=y(g=e.CesiumMath.PI_OVER_TWO,o,p,O,c,d,f,_,v,W),t&&(b[R++]=W.x,b[R++]=W.y,b[R++]=W.z),i&&(H[G--]=W.z,H[G--]=W.y,H[G--]=W.x),g=e.CesiumMath.PI_OVER_TWO-P,I=1;I<w+1;++I){if(W=y(g,o,p,O,c,d,f,_,v,W),S=y(Math.PI-g,o,p,O,c,d,f,_,v,S),t){for(b[R++]=W.x,b[R++]=W.y,b[R++]=W.z,E=2*I+2,T=1;T<E-1;++T)A=T/(E-1),V=r.Cartesian3.lerp(W,S,A,h),b[R++]=V.x,b[R++]=V.y,b[R++]=V.z;b[R++]=S.x,b[R++]=S.y,b[R++]=S.z}i&&(H[G--]=W.z,H[G--]=W.y,H[G--]=W.x,H[Q++]=S.x,H[Q++]=S.y,H[Q++]=S.z),g=e.CesiumMath.PI_OVER_TWO-(I+1)*P}for(I=w;I>1;--I){if(W=y(-(g=e.CesiumMath.PI_OVER_TWO-(I-1)*P),o,p,O,c,d,f,_,v,W),S=y(g+Math.PI,o,p,O,c,d,f,_,v,S),t){for(b[R++]=W.x,b[R++]=W.y,b[R++]=W.z,E=2*(I-1)+2,T=1;T<E-1;++T)A=T/(E-1),V=r.Cartesian3.lerp(W,S,A,h),b[R++]=V.x,b[R++]=V.y,b[R++]=V.z;b[R++]=S.x,b[R++]=S.y,b[R++]=S.z}i&&(H[G--]=W.z,H[G--]=W.y,H[G--]=W.x,H[Q++]=S.x,H[Q++]=S.y,H[Q++]=S.z)}W=y(-(g=e.CesiumMath.PI_OVER_TWO),o,p,O,c,d,f,_,v,W);var N={};return t&&(b[R++]=W.x,b[R++]=W.y,b[R++]=W.z,N.positions=b,N.numPts=w),i&&(H[G--]=W.z,H[G--]=W.y,H[G--]=W.x,N.outerPositions=H),N},a.EllipseGeometryLibrary=n}));
