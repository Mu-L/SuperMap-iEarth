define(["exports","./Cartographic-bd336518","./when-b60132fc","./Check-7b2a090c","./Cartesian2-b18a5d2b","./EllipsoidGeodesic-66ad3a5d","./EllipsoidRhumbLine-a4eddede","./IntersectionTests-fbb9c631","./Math-09b0b739","./Matrix4-9a0bfd77","./Plane-99083984"],(function(a,e,r,t,i,n,o,s,c,l,u){"use strict";var h={numberOfPoints:function(a,r,t){var i=e.Cartesian3.distance(a,r);return Math.ceil(i/t)},numberOfPointsRhumbLine:function(a,e,r){var t=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.ceil(Math.sqrt(t/(r*r)))}},f=new e.Cartographic;h.extractHeights=function(a,e){for(var r=a.length,t=new Array(r),i=0;i<r;i++){var n=a[i];t[i]=e.cartesianToCartographic(n,f).height}return t};var d=new l.Matrix4,g=new e.Cartesian3,C=new e.Cartesian3,p=new u.Plane(e.Cartesian3.UNIT_X,0),v=new e.Cartesian3,m=new u.Plane(e.Cartesian3.UNIT_X,0),w=new e.Cartesian3,P=new e.Cartesian3,T=[];function y(a,e,r){var t,i=T;if(i.length=a,e===r){for(t=0;t<a;t++)i[t]=e;return i}var n=(r-e)/a;for(t=0;t<a;t++){var o=e+t*n;i[t]=o}return i}var b=new e.Cartographic,A=new e.Cartographic,E=new e.Cartesian3,M=new e.Cartesian3,S=new e.Cartesian3,R=new n.EllipsoidGeodesic,x=new o.EllipsoidRhumbLine;function D(a,r,t,i,n,o,s,c,l){var u=i.scaleToGeodeticSurface(a,M),f=i.scaleToGeodeticSurface(r,S),d=h.numberOfPoints(a,r,t),g=i.cartesianToCartographic(u,b),C=i.cartesianToCartographic(f,A),p=y(d,n,o);l>0&&(p=function(a,e){var r=T;r.length=a;for(var t=0;t<a;t++)r[t]+=e*Math.sin(Math.PI*t/a);return r}(d,l)),R.setEndPoints(g,C);var v=R.surfaceDistance/d,m=c;g.height=n;var w=i.cartographicToCartesian(g,E);e.Cartesian3.pack(w,s,m),m+=3;for(var P=1;P<d;P++){var x=R.interpolateUsingSurfaceDistance(P*v,A);x.height=p[P],w=i.cartographicToCartesian(x,E),e.Cartesian3.pack(w,s,m),m+=3}return m}function G(a,r,t,i,n,s,c,l){var u=i.scaleToGeodeticSurface(a,M),f=i.scaleToGeodeticSurface(r,S),d=i.cartesianToCartographic(u,b),g=i.cartesianToCartographic(f,A),C=h.numberOfPointsRhumbLine(d,g,t),p=y(C,n,s);x.ellipsoid.equals(i)||(x=new o.EllipsoidRhumbLine(void 0,void 0,i)),x.setEndPoints(d,g);var v=x.surfaceDistance/C,m=l;d.height=n;var w=i.cartographicToCartesian(d,E);e.Cartesian3.pack(w,c,m),m+=3;for(var P=1;P<C;P++){var T=x.interpolateUsingSurfaceDistance(P*v,A);T.height=p[P],w=i.cartographicToCartesian(T,E),e.Cartesian3.pack(w,c,m),m+=3}return m}h.wrapLongitude=function(a,t){var i=[],n=[];if(r.defined(a)&&a.length>0){t=r.defaultValue(t,l.Matrix4.IDENTITY);var o=l.Matrix4.inverseTransformation(t,d),c=l.Matrix4.multiplyByPoint(o,e.Cartesian3.ZERO,g),h=e.Cartesian3.normalize(l.Matrix4.multiplyByPointAsVector(o,e.Cartesian3.UNIT_Y,C),C),f=u.Plane.fromPointNormal(c,h,p),T=e.Cartesian3.normalize(l.Matrix4.multiplyByPointAsVector(o,e.Cartesian3.UNIT_X,v),v),y=u.Plane.fromPointNormal(c,T,m),b=1;i.push(e.Cartesian3.clone(a[0]));for(var A=i[0],E=a.length,M=1;M<E;++M){var S=a[M];if(u.Plane.getPointDistance(y,A)<0||u.Plane.getPointDistance(y,S)<0){var R=s.IntersectionTests.lineSegmentPlane(A,S,f,w);if(r.defined(R)){var x=e.Cartesian3.multiplyByScalar(h,5e-9,P);u.Plane.getPointDistance(f,A)<0&&e.Cartesian3.negate(x,x),i.push(e.Cartesian3.add(R,x,new e.Cartesian3)),n.push(b+1),e.Cartesian3.negate(x,x),i.push(e.Cartesian3.add(R,x,new e.Cartesian3)),b=1}}i.push(e.Cartesian3.clone(a[M])),b++,A=S}n.push(b)}return{positions:i,lengths:n}},h.generateArc=function(a){r.defined(a)||(a={});var t=a.positions,n=t.length,o=r.defaultValue(a.ellipsoid,i.Ellipsoid.WGS84),s=r.defaultValue(a.height,0),l=Array.isArray(s);if(n<1)return[];if(1===n){var u=o.scaleToGeodeticSurface(t[0],M);if(0!==(s=l?s[0]:s)){var f=o.geodeticSurfaceNormal(u,E);e.Cartesian3.multiplyByScalar(f,s,f),e.Cartesian3.add(u,f,u)}return[u.x,u.y,u.z]}var d=a.minDistance;if(!r.defined(d)){var g=r.defaultValue(a.granularity,c.CesiumMath.RADIANS_PER_DEGREE);d=c.CesiumMath.chordLength(g,o.maximumRadius)}var C,p=0;for(C=0;C<n-1;C++)p+=h.numberOfPoints(t[C],t[C+1],d);var v=a.hMax,m=3*(p+1),w=new Array(m),P=0;for(C=0;C<n-1;C++){P=D(t[C],t[C+1],d,o,l?s[C]:s,l?s[C+1]:s,w,P,v)}T.length=0;var y=t[n-1],A=o.cartesianToCartographic(y,b);A.height=l?s[n-1]:s;var S=o.cartographicToCartesian(A,E);return e.Cartesian3.pack(S,w,m-3),w};var I=new e.Cartographic,N=new e.Cartographic;h.generateRhumbArc=function(a){r.defined(a)||(a={});var t=a.positions,n=t.length,o=r.defaultValue(a.ellipsoid,i.Ellipsoid.WGS84),s=r.defaultValue(a.height,0),l=Array.isArray(s);if(n<1)return[];if(1===n){var u=o.scaleToGeodeticSurface(t[0],M);if(0!==(s=l?s[0]:s)){var f=o.geodeticSurfaceNormal(u,E);e.Cartesian3.multiplyByScalar(f,s,f),e.Cartesian3.add(u,f,u)}return[u.x,u.y,u.z]}var d,g,C=r.defaultValue(a.granularity,c.CesiumMath.RADIANS_PER_DEGREE),p=0,v=o.cartesianToCartographic(t[0],I);for(d=0;d<n-1;d++)g=o.cartesianToCartographic(t[d+1],N),p+=h.numberOfPointsRhumbLine(v,g,C),v=e.Cartographic.clone(g,I);var m=3*(p+1),w=new Array(m),P=0;for(d=0;d<n-1;d++){P=G(t[d],t[d+1],C,o,l?s[d]:s,l?s[d+1]:s,w,P)}T.length=0;var y=t[n-1],A=o.cartesianToCartographic(y,b);A.height=l?s[n-1]:s;var S=o.cartographicToCartesian(A,E);return e.Cartesian3.pack(S,w,m-3),w},h.generateCartesianArc=function(a){for(var r=h.generateArc(a),t=r.length/3,i=new Array(t),n=0;n<t;n++)i[n]=e.Cartesian3.unpack(r,3*n);return i},h.generateCartesianRhumbArc=function(a){for(var r=h.generateRhumbArc(a),t=r.length/3,i=new Array(t),n=0;n<t;n++)i[n]=e.Cartesian3.unpack(r,3*n);return i},a.PolylinePipeline=h}));
